(()=>{var e={};e.id=543,e.ids=[543],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},5511:e=>{"use strict";e.exports=require("crypto")},8232:(e,t,r)=>{"use strict";let s,n,a,i,o;r.r(t),r.d(t,{patchFetch:()=>hi,routeModule:()=>hr,serverHooks:()=>ha,workAsyncStorage:()=>hs,workUnitAsyncStorage:()=>hn});var l,u,c,d,p,h,m,f,g,y,v,b,w,_,S,x,T,k,I,E,A,N,P,C,O,$,j,R,q,D,M,L,F,z,B,Z,U,J,V,K,Q={};r.r(Q),r.d(Q,{GET:()=>p6,OPTIONS:()=>p7,PATCH:()=>he,POST:()=>p8,PUT:()=>ht});var W=r(1271),H=r(1232),G=r(8079),Y=async(e,t=Object.create(null))=>{let{all:r=!1,dot:s=!1}=t,n=(e instanceof eb?e.raw.headers:e.headers).get("Content-Type");return n?.startsWith("multipart/form-data")||n?.startsWith("application/x-www-form-urlencoded")?X(e,{all:r,dot:s}):{}};async function X(e,t){let r=await e.formData();return r?function(e,t){let r=Object.create(null);return e.forEach((e,s)=>{t.all||s.endsWith("[]")?ee(r,s,e):r[s]=e}),t.dot&&Object.entries(r).forEach(([e,t])=>{e.includes(".")&&(et(r,e,t),delete r[e])}),r}(r,t):{}}var ee=(e,t,r)=>{void 0!==e[t]?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:e[t]=r},et=(e,t,r)=>{let s=e,n=t.split(".");n.forEach((e,t)=>{t===n.length-1?s[e]=r:((!s[e]||"object"!=typeof s[e]||Array.isArray(s[e])||s[e]instanceof File)&&(s[e]=Object.create(null)),s=s[e])})},er=e=>{let t=e.split("/");return""===t[0]&&t.shift(),t},es=e=>{let{groups:t,path:r}=en(e);return ea(er(r),t)},en=e=>{let t=[];return e=e.replace(/\{[^}]+\}/g,(e,r)=>{let s=`@${r}`;return t.push([s,e]),s}),{groups:t,path:e}},ea=(e,t)=>{for(let r=t.length-1;r>=0;r--){let[s]=t[r];for(let n=e.length-1;n>=0;n--)if(e[n].includes(s)){e[n]=e[n].replace(s,t[r][1]);break}}return e},ei={},eo=(e,t)=>{if("*"===e)return"*";let r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){let s=`${e}#${t}`;return ei[s]||(r[2]?ei[s]=t&&":"!==t[0]&&"*"!==t[0]?[s,r[1],RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],RegExp(`^${r[2]}$`)]:ei[s]=[e,r[1],!0]),ei[s]}return null},el=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,e=>{try{return t(e)}catch{return e}})}},eu=e=>el(e,decodeURI),ec=e=>{let t=e.url,r=t.indexOf("/",8),s=r;for(;s<t.length;s++){let e=t.charCodeAt(s);if(37===e){let e=t.indexOf("?",s),n=t.slice(r,-1===e?void 0:e);return eu(n.includes("%25")?n.replace(/%25/g,"%2525"):n)}if(63===e)break}return t.slice(r,s)},ed=e=>{let t=ec(e);return t.length>1&&"/"===t.at(-1)?t.slice(0,-1):t},ep=(e,t,...r)=>(r.length&&(t=ep(t,...r)),`${e?.[0]==="/"?"":"/"}${e}${"/"===t?"":`${e?.at(-1)==="/"?"":"/"}${t?.[0]==="/"?t.slice(1):t}`}`),eh=e=>{if(!e.match(/\:.+\?$/))return null;let t=e.split("/"),r=[],s="";return t.forEach(e=>{if(""===e||/\:/.test(e)){if(/\:/.test(e)){if(/\?/.test(e)){0===r.length&&""===s?r.push("/"):r.push(s);let t=e.replace("?","");s+="/"+t,r.push(s)}else s+="/"+e}}else s+="/"+e}),r.filter((e,t,r)=>r.indexOf(e)===t)},em=e=>/[%+]/.test(e)?(-1!==e.indexOf("+")&&(e=e.replace(/\+/g," ")),-1!==e.indexOf("%")?ey(e):e):e,ef=(e,t,r)=>{let s;if(!r&&t&&!/[%+]/.test(t)){let r=e.indexOf(`?${t}`,8);for(-1===r&&(r=e.indexOf(`&${t}`,8));-1!==r;){let s=e.charCodeAt(r+t.length+1);if(61===s){let s=r+t.length+2,n=e.indexOf("&",s);return em(e.slice(s,-1===n?void 0:n))}if(38==s||isNaN(s))return"";r=e.indexOf(`&${t}`,r+1)}if(!(s=/[%+]/.test(e)))return}let n={};s??=/[%+]/.test(e);let a=e.indexOf("?",8);for(;-1!==a;){let t;let i=e.indexOf("&",a+1),o=e.indexOf("=",a);o>i&&-1!==i&&(o=-1);let l=e.slice(a+1,-1===o?-1===i?void 0:i:o);s&&(l=em(l)),a=i,""!==l&&(-1===o?t="":(t=e.slice(o+1,-1===i?void 0:i),s&&(t=em(t))),r?(n[l]&&Array.isArray(n[l])||(n[l]=[]),n[l].push(t)):n[l]??=t)}return t?n[t]:n},eg=(e,t)=>ef(e,t,!0),ey=decodeURIComponent,ev=e=>el(e,ey),eb=class{raw;#e;#t;routeIndex=0;path;bodyCache={};constructor(e,t="/",r=[[]]){this.raw=e,this.path=t,this.#t=r,this.#e={}}param(e){return e?this.#r(e):this.#s()}#r(e){let t=this.#t[0][this.routeIndex][1][e],r=this.#n(t);return r?/\%/.test(r)?ev(r):r:void 0}#s(){let e={};for(let t of Object.keys(this.#t[0][this.routeIndex][1])){let r=this.#n(this.#t[0][this.routeIndex][1][t]);r&&"string"==typeof r&&(e[t]=/\%/.test(r)?ev(r):r)}return e}#n(e){return this.#t[1]?this.#t[1][e]:e}query(e){return ef(this.url,e)}queries(e){return eg(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;let t={};return this.raw.headers.forEach((e,r)=>{t[r]=e}),t}async parseBody(e){return this.bodyCache.parsedBody??=await Y(this,e)}#a=e=>{let{bodyCache:t,raw:r}=this,s=t[e];if(s)return s;let n=Object.keys(t)[0];return n?t[n].then(t=>("json"===n&&(t=JSON.stringify(t)),new Response(t)[e]())):t[e]=r[e]()};json(){return this.#a("json")}text(){return this.#a("text")}arrayBuffer(){return this.#a("arrayBuffer")}blob(){return this.#a("blob")}formData(){return this.#a("formData")}addValidatedData(e,t){this.#e[e]=t}valid(e){return this.#e[e]}get url(){return this.raw.url}get method(){return this.raw.method}get matchedRoutes(){return this.#t[0].map(([[,e]])=>e)}get routePath(){return this.#t[0].map(([[,e]])=>e)[this.routeIndex].path}},ew={Stringify:1},e_=(e,t)=>{let r=new String(e);return r.isEscaped=!0,r.callbacks=t,r},eS=async(e,t,r,s,n)=>{"object"==typeof e&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));let a=e.callbacks;if(!a?.length)return Promise.resolve(e);n?n[0]+=e:n=[e];let i=Promise.all(a.map(e=>e({phase:t,buffer:n,context:s}))).then(e=>Promise.all(e.filter(Boolean).map(e=>eS(e,t,!1,s,n))).then(()=>n[0]));return r?e_(await i,a):i},ex=(e,t={})=>{for(let r of Object.keys(t))e.set(r,t[r]);return e},eT=class{#i;#o;env={};#l;finalized=!1;error;#u=200;#c;#d;#p;#h;#m=!0;#f;#g;#y;#t;#v;constructor(e,t){this.#i=e,t&&(this.#c=t.executionCtx,this.env=t.env,this.#y=t.notFoundHandler,this.#v=t.path,this.#t=t.matchResult)}get req(){return this.#o??=new eb(this.#i,this.#v,this.#t),this.#o}get event(){if(this.#c&&"respondWith"in this.#c)return this.#c;throw Error("This context has no FetchEvent")}get executionCtx(){if(this.#c)return this.#c;throw Error("This context has no ExecutionContext")}get res(){return this.#m=!1,this.#h||=new Response("404 Not Found",{status:404})}set res(e){if(this.#m=!1,this.#h&&e)try{for(let[t,r]of this.#h.headers.entries())if("content-type"!==t){if("set-cookie"===t){let t=this.#h.headers.getSetCookie();for(let r of(e.headers.delete("set-cookie"),t))e.headers.append("set-cookie",r)}else e.headers.set(t,r)}}catch(t){if(t instanceof TypeError&&t.message.includes("immutable")){this.res=new Response(e.body,{headers:e.headers,status:e.status});return}throw t}this.#h=e,this.finalized=!0}render=(...e)=>(this.#g??=e=>this.html(e),this.#g(...e));setLayout=e=>this.#f=e;getLayout=()=>this.#f;setRenderer=e=>{this.#g=e};header=(e,t,r)=>{if(void 0===t){this.#d?this.#d.delete(e):this.#p&&delete this.#p[e.toLocaleLowerCase()],this.finalized&&this.res.headers.delete(e);return}r?.append?(this.#d||(this.#m=!1,this.#d=new Headers(this.#p),this.#p={}),this.#d.append(e,t)):this.#d?this.#d.set(e,t):(this.#p??={},this.#p[e.toLowerCase()]=t),this.finalized&&(r?.append?this.res.headers.append(e,t):this.res.headers.set(e,t))};status=e=>{this.#m=!1,this.#u=e};set=(e,t)=>{this.#l??=new Map,this.#l.set(e,t)};get=e=>this.#l?this.#l.get(e):void 0;get var(){return this.#l?Object.fromEntries(this.#l):{}}#b(e,t,r){if(this.#m&&!r&&!t&&200===this.#u)return new Response(e,{headers:this.#p});if(t&&"number"!=typeof t){let r=new Headers(t.headers);return this.#d&&this.#d.forEach((e,t)=>{"set-cookie"===t?r.append(t,e):r.set(t,e)}),new Response(e,{headers:ex(r,this.#p),status:t.status??this.#u})}let s="number"==typeof t?t:this.#u;for(let[e,t]of(this.#p??={},this.#d??=new Headers,ex(this.#d,this.#p),this.#h&&(this.#h.headers.forEach((e,t)=>{"set-cookie"===t?this.#d?.append(t,e):this.#d?.set(t,e)}),ex(this.#d,this.#p)),Object.entries(r??={})))if("string"==typeof t)this.#d.set(e,t);else for(let r of(this.#d.delete(e),t))this.#d.append(e,r);return new Response(e,{status:s,headers:this.#d})}newResponse=(...e)=>this.#b(...e);body=(e,t,r)=>"number"==typeof t?this.#b(e,t,r):this.#b(e,t);text=(e,t,r)=>{if(!this.#p){if(this.#m&&!r&&!t)return new Response(e);this.#p={}}return(this.#p["content-type"]="text/plain; charset=UTF-8","number"==typeof t)?this.#b(e,t,r):this.#b(e,t)};json=(e,t,r)=>{let s=JSON.stringify(e);return this.#p??={},this.#p["content-type"]="application/json","number"==typeof t?this.#b(s,t,r):this.#b(s,t)};html=(e,t,r)=>(this.#p??={},this.#p["content-type"]="text/html; charset=UTF-8","object"==typeof e)?eS(e,ew.Stringify,!1,{}).then(e=>"number"==typeof t?this.#b(e,t,r):this.#b(e,t)):"number"==typeof t?this.#b(e,t,r):this.#b(e,t);redirect=(e,t)=>(this.#d??=new Headers,this.#d.set("Location",String(e)),this.newResponse(null,t??302));notFound=()=>(this.#y??=()=>new Response,this.#y(this))},ek=(e,t,r)=>(s,n)=>{let a=-1,i=s instanceof eT;return o(0);async function o(l){let u,c;if(l<=a)throw Error("next() called multiple times");a=l;let d=!1;if(e[l]?(c=e[l][0][0],i&&(s.req.routeIndex=l)):c=l===e.length&&n||void 0,c)try{u=await c(s,()=>o(l+1))}catch(e){if(e instanceof Error&&i&&t)s.error=e,u=await t(e,s),d=!0;else throw e}else i&&!1===s.finalized&&r&&(u=await r(s));return u&&(!1===s.finalized||d)&&(s.res=u),s}},eI=["get","post","put","delete","options","patch"],eE=class extends Error{},eA=e=>e.text("404 Not Found",404),eN=(e,t)=>"getResponse"in e?e.getResponse():(console.error(e),t.text("Internal Server Error",500)),eP=class{get;post;put;delete;options;patch;all;on;use;router;getPath;_basePath="/";#v="/";routes=[];constructor(e={}){[...eI,"all"].forEach(e=>{this[e]=(t,...r)=>("string"==typeof t?this.#v=t:this.#w(e,this.#v,t),r.forEach(t=>{this.#w(e,this.#v,t)}),this)}),this.on=(e,t,...r)=>{for(let s of[t].flat())for(let t of(this.#v=s,[e].flat()))r.map(e=>{this.#w(t.toUpperCase(),this.#v,e)});return this},this.use=(e,...t)=>("string"==typeof e?this.#v=e:(this.#v="*",t.unshift(e)),t.forEach(e=>{this.#w("ALL",this.#v,e)}),this);let t=e.strict??!0;delete e.strict,Object.assign(this,e),this.getPath=t?e.getPath??ec:ed}#_(){let e=new eP({router:this.router,getPath:this.getPath});return e.routes=this.routes,e}#y=eA;errorHandler=eN;route(e,t){let r=this.basePath(e);return t.routes.map(e=>{let s;t.errorHandler===eN?s=e.handler:(s=async(r,s)=>(await ek([],t.errorHandler)(r,()=>e.handler(r,s))).res).__COMPOSED_HANDLER=e.handler,r.#w(e.method,e.path,s)}),this}basePath(e){let t=this.#_();return t._basePath=ep(this._basePath,e),t}onError=e=>(this.errorHandler=e,this);notFound=e=>(this.#y=e,this);mount(e,t,r){let s,n;r&&("function"==typeof r?n=r:(n=r.optionHandler,s=r.replaceRequest));let a=n?e=>{let t=n(e);return Array.isArray(t)?t:[t]}:e=>{let t;try{t=e.executionCtx}catch{}return[e.env,t]};s||=(()=>{let t=ep(this._basePath,e),r="/"===t?0:t.length;return e=>{let t=new URL(e.url);return t.pathname=t.pathname.slice(r)||"/",new Request(t,e)}})();let i=async(e,r)=>{let n=await t(s(e.req.raw),...a(e));if(n)return n;await r()};return this.#w("ALL",ep(e,"*"),i),this}#w(e,t,r){e=e.toUpperCase();let s={path:t=ep(this._basePath,t),method:e,handler:r};this.router.add(e,t,[r,s]),this.routes.push(s)}#S(e,t){if(e instanceof Error)return this.errorHandler(e,t);throw e}#x(e,t,r,s){if("HEAD"===s)return(async()=>new Response(null,await this.#x(e,t,r,"GET")))();let n=this.getPath(e,{env:r}),a=this.router.match(s,n),i=new eT(e,{path:n,matchResult:a,env:r,executionCtx:t,notFoundHandler:this.#y});if(1===a[0].length){let e;try{e=a[0][0][0][0](i,async()=>{i.res=await this.#y(i)})}catch(e){return this.#S(e,i)}return e instanceof Promise?e.then(e=>e||(i.finalized?i.res:this.#y(i))).catch(e=>this.#S(e,i)):e??this.#y(i)}let o=ek(a[0],this.errorHandler,this.#y);return(async()=>{try{let e=await o(i);if(!e.finalized)throw Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return e.res}catch(e){return this.#S(e,i)}})()}fetch=(e,...t)=>this.#x(e,t[1],t[0],e.method);request=(e,t,r,s)=>e instanceof Request?this.fetch(t?new Request(e,t):e,r,s):(e=e.toString(),this.fetch(new Request(/^https?:\/\//.test(e)?e:`http://localhost${ep("/",e)}`,t),r,s));fire=()=>{addEventListener("fetch",e=>{e.respondWith(this.#x(e.request,e,void 0,e.request.method))})}},eC=Object.create(null),eO=/\/(:\w+(?:{(?:(?:{[\d,]+})|[^}])+})?)|\/[^\/\?]+|(\?)/g,e$=/\*/,ej=class{name="LinearRouter";#T=[];add(e,t,r){for(let s=0,n=eh(t)||[t],a=n.length;s<a;s++)this.#T.push([e,n[s],r])}match(e,t){let r=[];e:for(let s=0,n=this.#T.length;s<n;s++){let[n,a,i]=this.#T[s];if(n===e||"ALL"===n){if("*"===a||"/*"===a){r.push([i,eC]);continue}let e=-1!==a.indexOf("*"),s=-1!==a.indexOf(":");if(e||s){if(e&&!s){let e=42===a.charCodeAt(a.length-1),s=(e?a.slice(0,-2):a).split(e$),n=s.length-1;for(let r=0,a=0,i=s.length;r<i;r++){let i=s[r];if(t.indexOf(i,a)!==a)continue e;if(a+=i.length,r===n){if(!e&&a!==t.length&&!(a===t.length-1&&47===t.charCodeAt(a)))continue e}else{let e=t.indexOf("/",a);if(-1===e)continue e;a=e}}r.push([i,eC])}else if(s&&!e){let e=Object.create(null),s=a.match(eO),n=s.length-1;for(let r=0,a=0,i=s.length;r<i;r++){if(-1===a||a>=t.length)continue e;let i=s[r];if(58===i.charCodeAt(1)){let n,o=i.slice(2);if(125===o.charCodeAt(o.length-1)){let e=o.indexOf("{"),i=s[r+1],l=i&&":"!==i[1]&&"*"!==i[1]?`(?=${i})`:"",u=o.slice(e+1,-1)+l,c=t.slice(a+1),d=RegExp(u,"d").exec(c);if(!d||0!==d.indices[0][0]||0===d.indices[0][1])continue e;o=o.slice(0,e),n=c.slice(...d.indices[0]),a+=d.indices[0][1]+1}else{let e=t.indexOf("/",a+1);if(-1===e){if(a+1===t.length)continue e;e=t.length}n=t.slice(a+1,e),a=e}e[o]||=n}else{if(t.indexOf(i,a)!==a)continue e;a+=i.length}if(r===n&&a!==t.length&&!(a===t.length-1&&47===t.charCodeAt(a)))continue e}r.push([i,e])}else if(s&&e)throw new eE}else(a===t||a+"/"===t)&&r.push([i,eC])}}return[r]}},eR=class{name="SmartRouter";#k=[];#T=[];constructor(e){this.#k=e.routers}add(e,t,r){if(!this.#T)throw Error("Can not add a route since the matcher is already built.");this.#T.push([e,t,r])}match(e,t){let r;if(!this.#T)throw Error("Fatal error");let s=this.#k,n=this.#T,a=s.length,i=0;for(;i<a;i++){let a=s[i];try{for(let e=0,t=n.length;e<t;e++)a.add(...n[e]);r=a.match(e,t)}catch(e){if(e instanceof eE)continue;throw e}this.match=a.match.bind(a),this.#k=[a],this.#T=void 0;break}if(i===a)throw Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,r}get activeRouter(){if(this.#T||1!==this.#k.length)throw Error("No active router has been determined yet.");return this.#k[0]}},eq=Object.create(null),eD=class{#I;#E;#A;#N=0;#P=eq;constructor(e,t,r){if(this.#E=r||Object.create(null),this.#I=[],e&&t){let r=Object.create(null);r[e]={handler:t,possibleKeys:[],score:0},this.#I=[r]}this.#A=[]}insert(e,t,r){this.#N=++this.#N;let s=this,n=es(t),a=[];for(let e=0,t=n.length;e<t;e++){let t=n[e],r=n[e+1],i=eo(t,r),o=Array.isArray(i)?i[0]:t;if(Object.keys(s.#E).includes(o)){s=s.#E[o];let e=eo(t,r);e&&a.push(e[1]);continue}s.#E[o]=new eD,i&&(s.#A.push(i),a.push(i[1])),s=s.#E[o]}let i=Object.create(null),o={handler:r,possibleKeys:a.filter((e,t,r)=>r.indexOf(e)===t),score:this.#N};return i[e]=o,s.#I.push(i),s}#C(e,t,r,s){let n=[];for(let a=0,i=e.#I.length;a<i;a++){let i=e.#I[a],o=i[t]||i.ALL,l={};if(void 0!==o&&(o.params=Object.create(null),n.push(o),r!==eq||s&&s!==eq))for(let e=0,t=o.possibleKeys.length;e<t;e++){let t=o.possibleKeys[e],n=l[o.score];o.params[t]=s?.[t]&&!n?s[t]:r[t]??s?.[t],l[o.score]=!0}}return n}search(e,t){let r=[];this.#P=eq;let s=[this],n=er(t),a=[];for(let t=0,i=n.length;t<i;t++){let o=n[t],l=t===i-1,u=[];for(let i=0,c=s.length;i<c;i++){let c=s[i],d=c.#E[o];d&&(d.#P=c.#P,l?(d.#E["*"]&&r.push(...this.#C(d.#E["*"],e,c.#P)),r.push(...this.#C(d,e,c.#P))):u.push(d));for(let s=0,i=c.#A.length;s<i;s++){let i=c.#A[s],d=c.#P===eq?{}:{...c.#P};if("*"===i){let t=c.#E["*"];t&&(r.push(...this.#C(t,e,c.#P)),t.#P=d,u.push(t));continue}if(""===o)continue;let[p,h,m]=i,f=c.#E[p],g=n.slice(t).join("/");if(m instanceof RegExp){let t=m.exec(g);if(t){if(d[h]=t[0],r.push(...this.#C(f,e,c.#P,d)),Object.keys(f.#E).length){f.#P=d;let e=t[0].match(/\//)?.length??0;(a[e]||=[]).push(f)}continue}}(!0===m||m.test(o))&&(d[h]=o,l?(r.push(...this.#C(f,e,d,c.#P)),f.#E["*"]&&r.push(...this.#C(f.#E["*"],e,d,c.#P))):(f.#P=d,u.push(f)))}}s=u.concat(a.shift()??[])}return r.length>1&&r.sort((e,t)=>e.score-t.score),[r.map(({handler:e,params:t})=>[e,t])]}},eM=class{name="TrieRouter";#O;constructor(){this.#O=new eD}add(e,t,r){let s=eh(t);if(s){for(let t=0,n=s.length;t<n;t++)this.#O.insert(e,s[t],r);return}this.#O.insert(e,t,r)}match(e,t){return this.#O.search(e,t)}},eL=class extends eP{constructor(e={}){super(e),this.router=new eR({routers:[new ej,new eM]})}},eF="vercel.ai.error",ez=Symbol.for(eF),eB=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[u]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,eF)}static hasMarker(e,t){let r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}};u=ez;var eZ=eB,eU="AI_APICallError",eJ=`vercel.ai.error.${eU}`,eV=Symbol.for(eJ),eK=class extends eZ{constructor({message:e,url:t,requestBodyValues:r,statusCode:s,responseHeaders:n,responseBody:a,cause:i,isRetryable:o=null!=s&&(408===s||409===s||429===s||s>=500),data:l}){super({name:eU,message:e,cause:i}),this[c]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=s,this.responseHeaders=n,this.responseBody=a,this.isRetryable=o,this.data=l}static isInstance(e){return eZ.hasMarker(e,eJ)}};c=eV;var eQ="AI_EmptyResponseBodyError",eW=`vercel.ai.error.${eQ}`,eH=Symbol.for(eW),eG=class extends eZ{constructor({message:e="Empty response body"}={}){super({name:eQ,message:e}),this[d]=!0}static isInstance(e){return eZ.hasMarker(e,eW)}};function eY(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}d=eH;var eX="AI_InvalidArgumentError",e0=`vercel.ai.error.${eX}`,e1=Symbol.for(e0),e2=class extends eZ{constructor({message:e,cause:t,argument:r}){super({name:eX,message:e,cause:t}),this[p]=!0,this.argument=r}static isInstance(e){return eZ.hasMarker(e,e0)}};p=e1;var e4="AI_InvalidPromptError",e9=`vercel.ai.error.${e4}`,e5=Symbol.for(e9),e3=class extends eZ{constructor({prompt:e,message:t,cause:r}){super({name:e4,message:`Invalid prompt: ${t}`,cause:r}),this[h]=!0,this.prompt=e}static isInstance(e){return eZ.hasMarker(e,e9)}};h=e5;var e6="AI_InvalidResponseDataError",e8=`vercel.ai.error.${e6}`,e7=Symbol.for(e8),te=class extends eZ{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:e6,message:t}),this[m]=!0,this.data=e}static isInstance(e){return eZ.hasMarker(e,e8)}};m=e7;var tt="AI_JSONParseError",tr=`vercel.ai.error.${tt}`,ts=Symbol.for(tr),tn=class extends eZ{constructor({text:e,cause:t}){super({name:tt,message:`JSON parsing failed: Text: ${e}.
Error message: ${eY(t)}`,cause:t}),this[f]=!0,this.text=e}static isInstance(e){return eZ.hasMarker(e,tr)}};f=ts;var ta="AI_LoadAPIKeyError",ti=`vercel.ai.error.${ta}`,to=Symbol.for(ti),tl=class extends eZ{constructor({message:e}){super({name:ta,message:e}),this[g]=!0}static isInstance(e){return eZ.hasMarker(e,ti)}};g=to,Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError");var tu="AI_NoSuchModelError",tc=`vercel.ai.error.${tu}`,td=Symbol.for(tc),tp=class extends eZ{constructor({errorName:e=tu,modelId:t,modelType:r,message:s=`No such ${r}: ${t}`}){super({name:e,message:s}),this[y]=!0,this.modelId=t,this.modelType=r}static isInstance(e){return eZ.hasMarker(e,tc)}};y=td;var th="AI_TooManyEmbeddingValuesForCallError",tm=`vercel.ai.error.${th}`,tf=Symbol.for(tm),tg=class extends eZ{constructor(e){super({name:th,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[v]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return eZ.hasMarker(e,tm)}};v=tf;var ty="AI_TypeValidationError",tv=`vercel.ai.error.${ty}`,tb=Symbol.for(tv),tw=class e extends eZ{constructor({value:e,cause:t}){super({name:ty,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${eY(t)}`,cause:t}),this[b]=!0,this.value=e}static isInstance(e){return eZ.hasMarker(e,tv)}static wrap({value:t,cause:r}){return e.isInstance(r)&&r.value===t?r:new e({value:t,cause:r})}};b=tb;var t_="AI_UnsupportedFunctionalityError",tS=`vercel.ai.error.${t_}`,tx=Symbol.for(tS),tT=class extends eZ{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:t_,message:t}),this[w]=!0,this.functionality=e}static isInstance(e){return eZ.hasMarker(e,tS)}};function tk(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every(tk):"object"==typeof e&&Object.entries(e).every(([e,t])=>"string"==typeof e&&tk(t)))}w=tx;let tI=(e,t=21)=>(r=t)=>{let s="",n=0|r;for(;n--;)s+=e[Math.random()*e.length|0];return s};var tE=r(6036),tA=Object.defineProperty,tN=(e,t,r)=>t in e?tA(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,tP=(e,t,r)=>tN(e,"symbol"!=typeof t?t+"":t,r);class tC extends Error{constructor(e,t){super(e),tP(this,"type"),tP(this,"field"),tP(this,"value"),tP(this,"line"),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}}function tO(e){}class t$ extends TransformStream{constructor({onError:e,onRetry:t,onComment:r}={}){let s;super({start(n){s=function(e){let{onEvent:t=tO,onError:r=tO,onRetry:s=tO,onComment:n}=e,a="",i=!0,o,l="",u="";function c(e){if(""===e){l.length>0&&t({id:o,event:u||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),o=void 0,l="",u="";return}if(e.startsWith(":")){n&&n(e.slice(e.startsWith(": ")?2:1));return}let r=e.indexOf(":");if(-1!==r){let t=e.slice(0,r),s=" "===e[r+1]?2:1;d(t,e.slice(r+s),e);return}d(e,"",e)}function d(e,t,n){switch(e){case"event":u=t;break;case"data":l=`${l}${t}
`;break;case"id":o=t.includes("\0")?void 0:t;break;case"retry":/^\d+$/.test(t)?s(parseInt(t,10)):r(new tC(`Invalid \`retry\` value: "${t}"`,{type:"invalid-retry",value:t,line:n}));break;default:r(new tC(`Unknown field "${e.length>20?`${e.slice(0,20)}\u2026`:e}"`,{type:"unknown-field",field:e,value:t,line:n}))}}return{feed:function(e){let t=i?e.replace(/^\xEF\xBB\xBF/,""):e,[r,s]=function(e){let t=[],r="",s=e.length;for(let n=0;n<s;n++){let s=e[n];"\r"===s&&e[n+1]===`
`?(t.push(r),r="",n++):"\r"===s||s===`
`?(t.push(r),r=""):r+=s}return[t,r]}(`${a}${t}`);for(let e of r)c(e);a=s,i=!1},reset:function(e={}){a&&e.consume&&c(a),o=void 0,l="",u="",a=""}}}({onEvent:e=>{n.enqueue(e)},onError(t){"terminate"===e?n.error(t):"function"==typeof e&&e(t)},onRetry:t,onComment:r})},transform(e){s.feed(e)}})}}function tj(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}async function tR(e){return null==e?Promise.resolve():new Promise(t=>setTimeout(t,e))}function tq(e){let t={};return e.headers.forEach((e,r)=>{t[r]=e}),t}var tD=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:s="-"}={})=>{let n=tI(r,t);if(null==e)return n;if(r.includes(s))throw new e2({argument:"separator",message:`The separator "${s}" must not be part of the alphabet "${r}".`});return t=>`${e}${s}${n(t)}`},tM=tD();function tL(e){return e instanceof Error&&("AbortError"===e.name||"TimeoutError"===e.name)}var tF=Symbol.for("vercel.ai.validator");function tz({value:e,schema:t}){let r="object"==typeof t&&null!==t&&tF in t&&!0===t[tF]&&"validate"in t?t:{[tF]:!0,validate:e=>{let r=t.safeParse(e);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}};try{if(null==r.validate)return{success:!0,value:e};let t=r.validate(e);if(t.success)return t;return{success:!1,error:tw.wrap({value:e,cause:t.error})}}catch(t){return{success:!1,error:tw.wrap({value:e,cause:t})}}}function tB({text:e,schema:t}){try{let r=tE.parse(e);if(null==t)return{success:!0,value:r,rawValue:r};let s=tz({value:r,schema:t});return s.success?{...s,rawValue:r}:s}catch(t){return{success:!1,error:tn.isInstance(t)?t:new tn({text:e,cause:t})}}}function tZ(e){try{return tE.parse(e),!0}catch(e){return!1}}var tU=()=>globalThis.fetch,tJ=async({url:e,headers:t,body:r,failedResponseHandler:s,successfulResponseHandler:n,abortSignal:a,fetch:i})=>tV({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:s,successfulResponseHandler:n,abortSignal:a,fetch:i}),tV=async({url:e,headers:t={},body:r,successfulResponseHandler:s,failedResponseHandler:n,abortSignal:a,fetch:i=tU()})=>{try{let o=await i(e,{method:"POST",headers:Object.fromEntries(Object.entries(t).filter(([e,t])=>null!=t)),body:r.content,signal:a}),l=tq(o);if(!o.ok){let t;try{t=await n({response:o,url:e,requestBodyValues:r.values})}catch(t){if(tL(t)||eK.isInstance(t))throw t;throw new eK({message:"Failed to process error response",cause:t,statusCode:o.status,url:e,responseHeaders:l,requestBodyValues:r.values})}throw t.value}try{return await s({response:o,url:e,requestBodyValues:r.values})}catch(t){if(t instanceof Error&&(tL(t)||eK.isInstance(t)))throw t;throw new eK({message:"Failed to process successful response",cause:t,statusCode:o.status,url:e,responseHeaders:l,requestBodyValues:r.values})}}catch(t){if(tL(t))throw t;if(t instanceof TypeError&&"fetch failed"===t.message){let s=t.cause;if(null!=s)throw new eK({message:`Cannot connect to API: ${s.message}`,cause:s,url:e,requestBodyValues:r.values,isRetryable:!0})}throw t}},tK=e=>async({response:t})=>{let r=tq(t);if(null==t.body)throw new eG({});return{responseHeaders:r,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(new t$).pipeThrough(new TransformStream({transform({data:t},r){"[DONE]"!==t&&r.enqueue(tB({text:t,schema:e}))}}))}},tQ=e=>async({response:t,url:r,requestBodyValues:s})=>{let n=await t.text(),a=tB({text:n,schema:e}),i=tq(t);if(!a.success)throw new eK({message:"Invalid JSON response",cause:a.error,statusCode:t.status,responseHeaders:i,responseBody:n,url:r,requestBodyValues:s});return{responseHeaders:i,value:a.value,rawValue:a.rawValue}},{btoa:tW,atob:tH}=globalThis;function tG(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return tW(t)}(function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),s={};for(let e of r)s[e]=t[e];return e.objectValues(s)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t})(_||(_={})),(S||(S={})).mergeShapes=(e,t)=>({...e,...t});let tY=_.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),tX=e=>{switch(typeof e){case"undefined":return tY.undefined;case"string":return tY.string;case"number":return isNaN(e)?tY.nan:tY.number;case"boolean":return tY.boolean;case"function":return tY.function;case"bigint":return tY.bigint;case"symbol":return tY.symbol;case"object":if(Array.isArray(e))return tY.array;if(null===e)return tY.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return tY.promise;if("undefined"!=typeof Map&&e instanceof Map)return tY.map;if("undefined"!=typeof Set&&e instanceof Set)return tY.set;if("undefined"!=typeof Date&&e instanceof Date)return tY.date;return tY.object;default:return tY.unknown}},t0=_.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class t1 extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},s=e=>{for(let n of e.issues)if("invalid_union"===n.code)n.unionErrors.map(s);else if("invalid_return_type"===n.code)s(n.returnTypeError);else if("invalid_arguments"===n.code)s(n.argumentsError);else if(0===n.path.length)r._errors.push(t(n));else{let e=r,s=0;for(;s<n.path.length;){let r=n.path[s];s===n.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(n))):e[r]=e[r]||{_errors:[]},e=e[r],s++}}};return s(this),r}static assert(e){if(!(e instanceof t1))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,_.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let s of this.issues)s.path.length>0?(t[s.path[0]]=t[s.path[0]]||[],t[s.path[0]].push(e(s))):r.push(e(s));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}t1.create=e=>new t1(e);let t2=(e,t)=>{let r;switch(e.code){case t0.invalid_type:r=e.received===tY.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case t0.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,_.jsonStringifyReplacer)}`;break;case t0.unrecognized_keys:r=`Unrecognized key(s) in object: ${_.joinValues(e.keys,", ")}`;break;case t0.invalid_union:r="Invalid input";break;case t0.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${_.joinValues(e.options)}`;break;case t0.invalid_enum_value:r=`Invalid enum value. Expected ${_.joinValues(e.options)}, received '${e.received}'`;break;case t0.invalid_arguments:r="Invalid function arguments";break;case t0.invalid_return_type:r="Invalid function return type";break;case t0.invalid_date:r="Invalid date";break;case t0.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:_.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case t0.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case t0.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case t0.custom:r="Invalid input";break;case t0.invalid_intersection_types:r="Intersection results could not be merged";break;case t0.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case t0.not_finite:r="Number must be finite";break;default:r=t.defaultError,_.assertNever(e)}return{message:r}},t4=t2;function t9(){return t4}let t5=e=>{let{data:t,path:r,errorMaps:s,issueData:n}=e,a=[...r,...n.path||[]],i={...n,path:a};if(void 0!==n.message)return{...n,path:a,message:n.message};let o="";for(let e of s.filter(e=>!!e).slice().reverse())o=e(i,{data:t,defaultError:o}).message;return{...n,path:a,message:o}};function t3(e,t){let r=t9(),s=t5({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===t2?void 0:t2].filter(e=>!!e)});e.common.issues.push(s)}class t6{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let s of t){if("aborted"===s.status)return t8;"dirty"===s.status&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,s=await e.value;r.push({key:t,value:s})}return t6.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let s of t){let{key:t,value:n}=s;if("aborted"===t.status||"aborted"===n.status)return t8;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==n.value||s.alwaysSet)&&(r[t.value]=n.value)}return{status:e.value,value:r}}}let t8=Object.freeze({status:"aborted"}),t7=e=>({status:"dirty",value:e}),re=e=>({status:"valid",value:e}),rt=e=>"aborted"===e.status,rr=e=>"dirty"===e.status,rs=e=>"valid"===e.status,rn=e=>"undefined"!=typeof Promise&&e instanceof Promise;function ra(e,t,r,s){if("a"===r&&!s)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)}function ri(e,t,r,s,n){if("m"===s)throw TypeError("Private method is not writable");if("a"===s&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?n.call(e,r):n?n.value=r:t.set(e,r),r}"function"==typeof SuppressedError&&SuppressedError,function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(x||(x={}));class ro{constructor(e,t,r,s){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=s}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let rl=(e,t)=>{if(rs(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new t1(e.common.issues);return this._error=t,this._error}}};function ru(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:s,description:n}=e;if(t&&(r||s))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:n}:{errorMap:(t,n)=>{var a,i;let{message:o}=e;return"invalid_enum_value"===t.code?{message:null!=o?o:n.defaultError}:void 0===n.data?{message:null!==(a=null!=o?o:s)&&void 0!==a?a:n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:null!==(i=null!=o?o:r)&&void 0!==i?i:n.defaultError}},description:n}}class rc{get description(){return this._def.description}_getType(e){return tX(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:tX(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new t6,ctx:{common:e.parent.common,data:e.data,parsedType:tX(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(rn(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;let s={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:tX(e)},n=this._parseSync({data:e,path:s.path,parent:s});return rl(s,n)}"~validate"(e){var t,r;let s={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:tX(e)};if(!this["~standard"].async)try{let t=this._parseSync({data:e,path:[],parent:s});return rs(t)?{value:t.value}:{issues:s.common.issues}}catch(e){(null===(r=null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.toLowerCase())||void 0===r?void 0:r.includes("encountered"))&&(this["~standard"].async=!0),s.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:s}).then(e=>rs(e)?{value:e.value}:{issues:s.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:tX(e)},s=this._parse({data:e,path:r.path,parent:r});return rl(r,await (rn(s)?s:Promise.resolve(s)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,s)=>{let n=e(t),a=()=>s.addIssue({code:t0.custom,...r(t)});return"undefined"!=typeof Promise&&n instanceof Promise?n.then(e=>!!e||(a(),!1)):!!n||(a(),!1)})}refinement(e,t){return this._refinement((r,s)=>!!e(r)||(s.addIssue("function"==typeof t?t(r,s):t),!1))}_refinement(e){return new r9({schema:this,typeName:I.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return r5.create(this,this._def)}nullable(){return r3.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return rz.create(this)}promise(){return r4.create(this,this._def)}or(e){return rZ.create([this,e],this._def)}and(e){return rV.create(this,e,this._def)}transform(e){return new r9({...ru(this._def),schema:this,typeName:I.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new r6({...ru(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:I.ZodDefault})}brand(){return new st({typeName:I.ZodBranded,type:this,...ru(this._def)})}catch(e){return new r8({...ru(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:I.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return sr.create(this,e)}readonly(){return ss.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let rd=/^c[^\s-]{8,}$/i,rp=/^[0-9a-z]+$/,rh=/^[0-9A-HJKMNP-TV-Z]{26}$/i,rm=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,rf=/^[a-z0-9_-]{21}$/i,rg=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ry=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,rv=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,rb=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,rw=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,r_=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,rS=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,rx=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,rT=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,rk="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",rI=RegExp(`^${rk}$`);function rE(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function rA(e){let t=`${rk}T${rE(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}class rN extends rc{_parse(e){var t,r,n,a;let i;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==tY.string){let t=this._getOrReturnCtx(e);return t3(t,{code:t0.invalid_type,expected:tY.string,received:t.parsedType}),t8}let o=new t6;for(let l of this._def.checks)if("min"===l.kind)e.data.length<l.value&&(t3(i=this._getOrReturnCtx(e,i),{code:t0.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("max"===l.kind)e.data.length>l.value&&(t3(i=this._getOrReturnCtx(e,i),{code:t0.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("length"===l.kind){let t=e.data.length>l.value,r=e.data.length<l.value;(t||r)&&(i=this._getOrReturnCtx(e,i),t?t3(i,{code:t0.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):r&&t3(i,{code:t0.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),o.dirty())}else if("email"===l.kind)rv.test(e.data)||(t3(i=this._getOrReturnCtx(e,i),{validation:"email",code:t0.invalid_string,message:l.message}),o.dirty());else if("emoji"===l.kind)s||(s=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),s.test(e.data)||(t3(i=this._getOrReturnCtx(e,i),{validation:"emoji",code:t0.invalid_string,message:l.message}),o.dirty());else if("uuid"===l.kind)rm.test(e.data)||(t3(i=this._getOrReturnCtx(e,i),{validation:"uuid",code:t0.invalid_string,message:l.message}),o.dirty());else if("nanoid"===l.kind)rf.test(e.data)||(t3(i=this._getOrReturnCtx(e,i),{validation:"nanoid",code:t0.invalid_string,message:l.message}),o.dirty());else if("cuid"===l.kind)rd.test(e.data)||(t3(i=this._getOrReturnCtx(e,i),{validation:"cuid",code:t0.invalid_string,message:l.message}),o.dirty());else if("cuid2"===l.kind)rp.test(e.data)||(t3(i=this._getOrReturnCtx(e,i),{validation:"cuid2",code:t0.invalid_string,message:l.message}),o.dirty());else if("ulid"===l.kind)rh.test(e.data)||(t3(i=this._getOrReturnCtx(e,i),{validation:"ulid",code:t0.invalid_string,message:l.message}),o.dirty());else if("url"===l.kind)try{new URL(e.data)}catch(t){t3(i=this._getOrReturnCtx(e,i),{validation:"url",code:t0.invalid_string,message:l.message}),o.dirty()}else"regex"===l.kind?(l.regex.lastIndex=0,l.regex.test(e.data)||(t3(i=this._getOrReturnCtx(e,i),{validation:"regex",code:t0.invalid_string,message:l.message}),o.dirty())):"trim"===l.kind?e.data=e.data.trim():"includes"===l.kind?e.data.includes(l.value,l.position)||(t3(i=this._getOrReturnCtx(e,i),{code:t0.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),o.dirty()):"toLowerCase"===l.kind?e.data=e.data.toLowerCase():"toUpperCase"===l.kind?e.data=e.data.toUpperCase():"startsWith"===l.kind?e.data.startsWith(l.value)||(t3(i=this._getOrReturnCtx(e,i),{code:t0.invalid_string,validation:{startsWith:l.value},message:l.message}),o.dirty()):"endsWith"===l.kind?e.data.endsWith(l.value)||(t3(i=this._getOrReturnCtx(e,i),{code:t0.invalid_string,validation:{endsWith:l.value},message:l.message}),o.dirty()):"datetime"===l.kind?rA(l).test(e.data)||(t3(i=this._getOrReturnCtx(e,i),{code:t0.invalid_string,validation:"datetime",message:l.message}),o.dirty()):"date"===l.kind?rI.test(e.data)||(t3(i=this._getOrReturnCtx(e,i),{code:t0.invalid_string,validation:"date",message:l.message}),o.dirty()):"time"===l.kind?RegExp(`^${rE(l)}$`).test(e.data)||(t3(i=this._getOrReturnCtx(e,i),{code:t0.invalid_string,validation:"time",message:l.message}),o.dirty()):"duration"===l.kind?ry.test(e.data)||(t3(i=this._getOrReturnCtx(e,i),{validation:"duration",code:t0.invalid_string,message:l.message}),o.dirty()):"ip"===l.kind?(t=e.data,("v4"===(r=l.version)||!r)&&rb.test(t)||("v6"===r||!r)&&r_.test(t)||(t3(i=this._getOrReturnCtx(e,i),{validation:"ip",code:t0.invalid_string,message:l.message}),o.dirty())):"jwt"===l.kind?!function(e,t){if(!rg.test(e))return!1;try{let[r]=e.split("."),s=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),n=JSON.parse(atob(s));if("object"!=typeof n||null===n||!n.typ||!n.alg||t&&n.alg!==t)return!1;return!0}catch(e){return!1}}(e.data,l.alg)&&(t3(i=this._getOrReturnCtx(e,i),{validation:"jwt",code:t0.invalid_string,message:l.message}),o.dirty()):"cidr"===l.kind?(n=e.data,("v4"===(a=l.version)||!a)&&rw.test(n)||("v6"===a||!a)&&rS.test(n)||(t3(i=this._getOrReturnCtx(e,i),{validation:"cidr",code:t0.invalid_string,message:l.message}),o.dirty())):"base64"===l.kind?rx.test(e.data)||(t3(i=this._getOrReturnCtx(e,i),{validation:"base64",code:t0.invalid_string,message:l.message}),o.dirty()):"base64url"===l.kind?rT.test(e.data)||(t3(i=this._getOrReturnCtx(e,i),{validation:"base64url",code:t0.invalid_string,message:l.message}),o.dirty()):_.assertNever(l);return{status:o.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:t0.invalid_string,...x.errToObj(r)})}_addCheck(e){return new rN({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...x.errToObj(e)})}url(e){return this._addCheck({kind:"url",...x.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...x.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...x.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...x.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...x.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...x.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...x.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...x.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...x.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...x.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...x.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...x.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(r=null==e?void 0:e.local)&&void 0!==r&&r,...x.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...x.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...x.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...x.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...x.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...x.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...x.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...x.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...x.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...x.errToObj(t)})}nonempty(e){return this.min(1,x.errToObj(e))}trim(){return new rN({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new rN({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new rN({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}rN.create=e=>{var t;return new rN({checks:[],typeName:I.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...ru(e)})};class rP extends rc{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==tY.number){let t=this._getOrReturnCtx(e);return t3(t,{code:t0.invalid_type,expected:tY.number,received:t.parsedType}),t8}let r=new t6;for(let s of this._def.checks)"int"===s.kind?_.isInteger(e.data)||(t3(t=this._getOrReturnCtx(e,t),{code:t0.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):"min"===s.kind?(s.inclusive?e.data<s.value:e.data<=s.value)&&(t3(t=this._getOrReturnCtx(e,t),{code:t0.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):"max"===s.kind?(s.inclusive?e.data>s.value:e.data>=s.value)&&(t3(t=this._getOrReturnCtx(e,t),{code:t0.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):"multipleOf"===s.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,s=(t.toString().split(".")[1]||"").length,n=r>s?r:s;return parseInt(e.toFixed(n).replace(".",""))%parseInt(t.toFixed(n).replace(".",""))/Math.pow(10,n)}(e.data,s.value)&&(t3(t=this._getOrReturnCtx(e,t),{code:t0.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):"finite"===s.kind?Number.isFinite(e.data)||(t3(t=this._getOrReturnCtx(e,t),{code:t0.not_finite,message:s.message}),r.dirty()):_.assertNever(s);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,x.toString(t))}gt(e,t){return this.setLimit("min",e,!1,x.toString(t))}lte(e,t){return this.setLimit("max",e,!0,x.toString(t))}lt(e,t){return this.setLimit("max",e,!1,x.toString(t))}setLimit(e,t,r,s){return new rP({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:x.toString(s)}]})}_addCheck(e){return new rP({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:x.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:x.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:x.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:x.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:x.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:x.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:x.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:x.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:x.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&_.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}rP.create=e=>new rP({checks:[],typeName:I.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...ru(e)});class rC extends rc{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch(t){return this._getInvalidInput(e)}if(this._getType(e)!==tY.bigint)return this._getInvalidInput(e);let r=new t6;for(let s of this._def.checks)"min"===s.kind?(s.inclusive?e.data<s.value:e.data<=s.value)&&(t3(t=this._getOrReturnCtx(e,t),{code:t0.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):"max"===s.kind?(s.inclusive?e.data>s.value:e.data>=s.value)&&(t3(t=this._getOrReturnCtx(e,t),{code:t0.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):"multipleOf"===s.kind?e.data%s.value!==BigInt(0)&&(t3(t=this._getOrReturnCtx(e,t),{code:t0.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):_.assertNever(s);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return t3(t,{code:t0.invalid_type,expected:tY.bigint,received:t.parsedType}),t8}gte(e,t){return this.setLimit("min",e,!0,x.toString(t))}gt(e,t){return this.setLimit("min",e,!1,x.toString(t))}lte(e,t){return this.setLimit("max",e,!0,x.toString(t))}lt(e,t){return this.setLimit("max",e,!1,x.toString(t))}setLimit(e,t,r,s){return new rC({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:x.toString(s)}]})}_addCheck(e){return new rC({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:x.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:x.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:x.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:x.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:x.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}rC.create=e=>{var t;return new rC({checks:[],typeName:I.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...ru(e)})};class rO extends rc{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==tY.boolean){let t=this._getOrReturnCtx(e);return t3(t,{code:t0.invalid_type,expected:tY.boolean,received:t.parsedType}),t8}return re(e.data)}}rO.create=e=>new rO({typeName:I.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...ru(e)});class r$ extends rc{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==tY.date){let t=this._getOrReturnCtx(e);return t3(t,{code:t0.invalid_type,expected:tY.date,received:t.parsedType}),t8}if(isNaN(e.data.getTime()))return t3(this._getOrReturnCtx(e),{code:t0.invalid_date}),t8;let r=new t6;for(let s of this._def.checks)"min"===s.kind?e.data.getTime()<s.value&&(t3(t=this._getOrReturnCtx(e,t),{code:t0.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),r.dirty()):"max"===s.kind?e.data.getTime()>s.value&&(t3(t=this._getOrReturnCtx(e,t),{code:t0.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),r.dirty()):_.assertNever(s);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new r$({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:x.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:x.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}r$.create=e=>new r$({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:I.ZodDate,...ru(e)});class rj extends rc{_parse(e){if(this._getType(e)!==tY.symbol){let t=this._getOrReturnCtx(e);return t3(t,{code:t0.invalid_type,expected:tY.symbol,received:t.parsedType}),t8}return re(e.data)}}rj.create=e=>new rj({typeName:I.ZodSymbol,...ru(e)});class rR extends rc{_parse(e){if(this._getType(e)!==tY.undefined){let t=this._getOrReturnCtx(e);return t3(t,{code:t0.invalid_type,expected:tY.undefined,received:t.parsedType}),t8}return re(e.data)}}rR.create=e=>new rR({typeName:I.ZodUndefined,...ru(e)});class rq extends rc{_parse(e){if(this._getType(e)!==tY.null){let t=this._getOrReturnCtx(e);return t3(t,{code:t0.invalid_type,expected:tY.null,received:t.parsedType}),t8}return re(e.data)}}rq.create=e=>new rq({typeName:I.ZodNull,...ru(e)});class rD extends rc{constructor(){super(...arguments),this._any=!0}_parse(e){return re(e.data)}}rD.create=e=>new rD({typeName:I.ZodAny,...ru(e)});class rM extends rc{constructor(){super(...arguments),this._unknown=!0}_parse(e){return re(e.data)}}rM.create=e=>new rM({typeName:I.ZodUnknown,...ru(e)});class rL extends rc{_parse(e){let t=this._getOrReturnCtx(e);return t3(t,{code:t0.invalid_type,expected:tY.never,received:t.parsedType}),t8}}rL.create=e=>new rL({typeName:I.ZodNever,...ru(e)});class rF extends rc{_parse(e){if(this._getType(e)!==tY.undefined){let t=this._getOrReturnCtx(e);return t3(t,{code:t0.invalid_type,expected:tY.void,received:t.parsedType}),t8}return re(e.data)}}rF.create=e=>new rF({typeName:I.ZodVoid,...ru(e)});class rz extends rc{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),s=this._def;if(t.parsedType!==tY.array)return t3(t,{code:t0.invalid_type,expected:tY.array,received:t.parsedType}),t8;if(null!==s.exactLength){let e=t.data.length>s.exactLength.value,n=t.data.length<s.exactLength.value;(e||n)&&(t3(t,{code:e?t0.too_big:t0.too_small,minimum:n?s.exactLength.value:void 0,maximum:e?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(null!==s.minLength&&t.data.length<s.minLength.value&&(t3(t,{code:t0.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),null!==s.maxLength&&t.data.length>s.maxLength.value&&(t3(t,{code:t0.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>s.type._parseAsync(new ro(t,e,t.path,r)))).then(e=>t6.mergeArray(r,e));let n=[...t.data].map((e,r)=>s.type._parseSync(new ro(t,e,t.path,r)));return t6.mergeArray(r,n)}get element(){return this._def.type}min(e,t){return new rz({...this._def,minLength:{value:e,message:x.toString(t)}})}max(e,t){return new rz({...this._def,maxLength:{value:e,message:x.toString(t)}})}length(e,t){return new rz({...this._def,exactLength:{value:e,message:x.toString(t)}})}nonempty(e){return this.min(1,e)}}rz.create=(e,t)=>new rz({type:e,minLength:null,maxLength:null,exactLength:null,typeName:I.ZodArray,...ru(t)});class rB extends rc{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=_.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==tY.object){let t=this._getOrReturnCtx(e);return t3(t,{code:t0.invalid_type,expected:tY.object,received:t.parsedType}),t8}let{status:t,ctx:r}=this._processInputParams(e),{shape:s,keys:n}=this._getCached(),a=[];if(!(this._def.catchall instanceof rL&&"strip"===this._def.unknownKeys))for(let e in r.data)n.includes(e)||a.push(e);let i=[];for(let e of n){let t=s[e],n=r.data[e];i.push({key:{status:"valid",value:e},value:t._parse(new ro(r,n,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof rL){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of a)i.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)a.length>0&&(t3(r,{code:t0.unrecognized_keys,keys:a}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of a){let s=r.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new ro(r,s,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of i){let r=await t.key,s=await t.value;e.push({key:r,value:s,alwaysSet:t.alwaysSet})}return e}).then(e=>t6.mergeObjectSync(t,e)):t6.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return x.errToObj,new rB({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var s,n,a,i;let o=null!==(a=null===(n=(s=this._def).errorMap)||void 0===n?void 0:n.call(s,t,r).message)&&void 0!==a?a:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(i=x.errToObj(e).message)&&void 0!==i?i:o}:{message:o}}}:{}})}strip(){return new rB({...this._def,unknownKeys:"strip"})}passthrough(){return new rB({...this._def,unknownKeys:"passthrough"})}extend(e){return new rB({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new rB({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:I.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new rB({...this._def,catchall:e})}pick(e){let t={};return _.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new rB({...this._def,shape:()=>t})}omit(e){let t={};return _.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new rB({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof rB){let r={};for(let s in t.shape){let n=t.shape[s];r[s]=r5.create(e(n))}return new rB({...t._def,shape:()=>r})}return t instanceof rz?new rz({...t._def,type:e(t.element)}):t instanceof r5?r5.create(e(t.unwrap())):t instanceof r3?r3.create(e(t.unwrap())):t instanceof rK?rK.create(t.items.map(t=>e(t))):t}(this)}partial(e){let t={};return _.objectKeys(this.shape).forEach(r=>{let s=this.shape[r];e&&!e[r]?t[r]=s:t[r]=s.optional()}),new rB({...this._def,shape:()=>t})}required(e){let t={};return _.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof r5;)e=e._def.innerType;t[r]=e}}),new rB({...this._def,shape:()=>t})}keyof(){return r0(_.objectKeys(this.shape))}}rB.create=(e,t)=>new rB({shape:()=>e,unknownKeys:"strip",catchall:rL.create(),typeName:I.ZodObject,...ru(t)}),rB.strictCreate=(e,t)=>new rB({shape:()=>e,unknownKeys:"strict",catchall:rL.create(),typeName:I.ZodObject,...ru(t)}),rB.lazycreate=(e,t)=>new rB({shape:e,unknownKeys:"strip",catchall:rL.create(),typeName:I.ZodObject,...ru(t)});class rZ extends rc{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new t1(e.ctx.common.issues));return t3(t,{code:t0.invalid_union,unionErrors:r}),t8});{let e;let s=[];for(let n of r){let r={...t,common:{...t.common,issues:[]},parent:null},a=n._parseSync({data:t.data,path:t.path,parent:r});if("valid"===a.status)return a;"dirty"!==a.status||e||(e={result:a,ctx:r}),r.common.issues.length&&s.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let n=s.map(e=>new t1(e));return t3(t,{code:t0.invalid_union,unionErrors:n}),t8}}get options(){return this._def.options}}rZ.create=(e,t)=>new rZ({options:e,typeName:I.ZodUnion,...ru(t)});let rU=e=>{if(e instanceof rY)return rU(e.schema);if(e instanceof r9)return rU(e.innerType());if(e instanceof rX)return[e.value];if(e instanceof r1)return e.options;if(e instanceof r2)return _.objectValues(e.enum);if(e instanceof r6)return rU(e._def.innerType);if(e instanceof rR)return[void 0];else if(e instanceof rq)return[null];else if(e instanceof r5)return[void 0,...rU(e.unwrap())];else if(e instanceof r3)return[null,...rU(e.unwrap())];else if(e instanceof st)return rU(e.unwrap());else if(e instanceof ss)return rU(e.unwrap());else if(e instanceof r8)return rU(e._def.innerType);else return[]};class rJ extends rc{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==tY.object)return t3(t,{code:t0.invalid_type,expected:tY.object,received:t.parsedType}),t8;let r=this.discriminator,s=t.data[r],n=this.optionsMap.get(s);return n?t.common.async?n._parseAsync({data:t.data,path:t.path,parent:t}):n._parseSync({data:t.data,path:t.path,parent:t}):(t3(t,{code:t0.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),t8)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let s=new Map;for(let r of t){let t=rU(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let n of t){if(s.has(n))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);s.set(n,r)}}return new rJ({typeName:I.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:s,...ru(r)})}}class rV extends rc{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),s=(e,s)=>{if(rt(e)||rt(s))return t8;let n=function e(t,r){let s=tX(t),n=tX(r);if(t===r)return{valid:!0,data:t};if(s===tY.object&&n===tY.object){let s=_.objectKeys(r),n=_.objectKeys(t).filter(e=>-1!==s.indexOf(e)),a={...t,...r};for(let s of n){let n=e(t[s],r[s]);if(!n.valid)return{valid:!1};a[s]=n.data}return{valid:!0,data:a}}if(s===tY.array&&n===tY.array){if(t.length!==r.length)return{valid:!1};let s=[];for(let n=0;n<t.length;n++){let a=e(t[n],r[n]);if(!a.valid)return{valid:!1};s.push(a.data)}return{valid:!0,data:s}}return s===tY.date&&n===tY.date&&+t==+r?{valid:!0,data:t}:{valid:!1}}(e.value,s.value);return n.valid?((rr(e)||rr(s))&&t.dirty(),{status:t.value,value:n.data}):(t3(r,{code:t0.invalid_intersection_types}),t8)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>s(e,t)):s(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}rV.create=(e,t,r)=>new rV({left:e,right:t,typeName:I.ZodIntersection,...ru(r)});class rK extends rc{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==tY.array)return t3(r,{code:t0.invalid_type,expected:tY.array,received:r.parsedType}),t8;if(r.data.length<this._def.items.length)return t3(r,{code:t0.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t8;!this._def.rest&&r.data.length>this._def.items.length&&(t3(r,{code:t0.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let s=[...r.data].map((e,t)=>{let s=this._def.items[t]||this._def.rest;return s?s._parse(new ro(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(s).then(e=>t6.mergeArray(t,e)):t6.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new rK({...this._def,rest:e})}}rK.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new rK({items:e,typeName:I.ZodTuple,rest:null,...ru(t)})};class rQ extends rc{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==tY.object)return t3(r,{code:t0.invalid_type,expected:tY.object,received:r.parsedType}),t8;let s=[],n=this._def.keyType,a=this._def.valueType;for(let e in r.data)s.push({key:n._parse(new ro(r,e,r.path,e)),value:a._parse(new ro(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?t6.mergeObjectAsync(t,s):t6.mergeObjectSync(t,s)}get element(){return this._def.valueType}static create(e,t,r){return new rQ(t instanceof rc?{keyType:e,valueType:t,typeName:I.ZodRecord,...ru(r)}:{keyType:rN.create(),valueType:e,typeName:I.ZodRecord,...ru(t)})}}class rW extends rc{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==tY.map)return t3(r,{code:t0.invalid_type,expected:tY.map,received:r.parsedType}),t8;let s=this._def.keyType,n=this._def.valueType,a=[...r.data.entries()].map(([e,t],a)=>({key:s._parse(new ro(r,e,r.path,[a,"key"])),value:n._parse(new ro(r,t,r.path,[a,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of a){let s=await r.key,n=await r.value;if("aborted"===s.status||"aborted"===n.status)return t8;("dirty"===s.status||"dirty"===n.status)&&t.dirty(),e.set(s.value,n.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of a){let s=r.key,n=r.value;if("aborted"===s.status||"aborted"===n.status)return t8;("dirty"===s.status||"dirty"===n.status)&&t.dirty(),e.set(s.value,n.value)}return{status:t.value,value:e}}}}rW.create=(e,t,r)=>new rW({valueType:t,keyType:e,typeName:I.ZodMap,...ru(r)});class rH extends rc{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==tY.set)return t3(r,{code:t0.invalid_type,expected:tY.set,received:r.parsedType}),t8;let s=this._def;null!==s.minSize&&r.data.size<s.minSize.value&&(t3(r,{code:t0.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),t.dirty()),null!==s.maxSize&&r.data.size>s.maxSize.value&&(t3(r,{code:t0.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),t.dirty());let n=this._def.valueType;function a(e){let r=new Set;for(let s of e){if("aborted"===s.status)return t8;"dirty"===s.status&&t.dirty(),r.add(s.value)}return{status:t.value,value:r}}let i=[...r.data.values()].map((e,t)=>n._parse(new ro(r,e,r.path,t)));return r.common.async?Promise.all(i).then(e=>a(e)):a(i)}min(e,t){return new rH({...this._def,minSize:{value:e,message:x.toString(t)}})}max(e,t){return new rH({...this._def,maxSize:{value:e,message:x.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}rH.create=(e,t)=>new rH({valueType:e,minSize:null,maxSize:null,typeName:I.ZodSet,...ru(t)});class rG extends rc{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==tY.function)return t3(t,{code:t0.invalid_type,expected:tY.function,received:t.parsedType}),t8;function r(e,r){return t5({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,t9(),t2].filter(e=>!!e),issueData:{code:t0.invalid_arguments,argumentsError:r}})}function s(e,r){return t5({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,t9(),t2].filter(e=>!!e),issueData:{code:t0.invalid_return_type,returnTypeError:r}})}let n={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof r4){let e=this;return re(async function(...t){let i=new t1([]),o=await e._def.args.parseAsync(t,n).catch(e=>{throw i.addIssue(r(t,e)),i}),l=await Reflect.apply(a,this,o);return await e._def.returns._def.type.parseAsync(l,n).catch(e=>{throw i.addIssue(s(l,e)),i})})}{let e=this;return re(function(...t){let i=e._def.args.safeParse(t,n);if(!i.success)throw new t1([r(t,i.error)]);let o=Reflect.apply(a,this,i.data),l=e._def.returns.safeParse(o,n);if(!l.success)throw new t1([s(o,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new rG({...this._def,args:rK.create(e).rest(rM.create())})}returns(e){return new rG({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new rG({args:e||rK.create([]).rest(rM.create()),returns:t||rM.create(),typeName:I.ZodFunction,...ru(r)})}}class rY extends rc{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}rY.create=(e,t)=>new rY({getter:e,typeName:I.ZodLazy,...ru(t)});class rX extends rc{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return t3(t,{received:t.data,code:t0.invalid_literal,expected:this._def.value}),t8}return{status:"valid",value:e.data}}get value(){return this._def.value}}function r0(e,t){return new r1({values:e,typeName:I.ZodEnum,...ru(t)})}rX.create=(e,t)=>new rX({value:e,typeName:I.ZodLiteral,...ru(t)});class r1 extends rc{constructor(){super(...arguments),T.set(this,void 0)}_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return t3(t,{expected:_.joinValues(r),received:t.parsedType,code:t0.invalid_type}),t8}if(ra(this,T,"f")||ri(this,T,new Set(this._def.values),"f"),!ra(this,T,"f").has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return t3(t,{received:t.data,code:t0.invalid_enum_value,options:r}),t8}return re(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return r1.create(e,{...this._def,...t})}exclude(e,t=this._def){return r1.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}T=new WeakMap,r1.create=r0;class r2 extends rc{constructor(){super(...arguments),k.set(this,void 0)}_parse(e){let t=_.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==tY.string&&r.parsedType!==tY.number){let e=_.objectValues(t);return t3(r,{expected:_.joinValues(e),received:r.parsedType,code:t0.invalid_type}),t8}if(ra(this,k,"f")||ri(this,k,new Set(_.getValidEnumValues(this._def.values)),"f"),!ra(this,k,"f").has(e.data)){let e=_.objectValues(t);return t3(r,{received:r.data,code:t0.invalid_enum_value,options:e}),t8}return re(e.data)}get enum(){return this._def.values}}k=new WeakMap,r2.create=(e,t)=>new r2({values:e,typeName:I.ZodNativeEnum,...ru(t)});class r4 extends rc{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==tY.promise&&!1===t.common.async?(t3(t,{code:t0.invalid_type,expected:tY.promise,received:t.parsedType}),t8):re((t.parsedType===tY.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}r4.create=(e,t)=>new r4({type:e,typeName:I.ZodPromise,...ru(t)});class r9 extends rc{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===I.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),s=this._def.effect||null,n={addIssue:e=>{t3(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===s.type){let e=s.transform(r.data,n);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return t8;let s=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===s.status?t8:"dirty"===s.status||"dirty"===t.value?t7(s.value):s});{if("aborted"===t.value)return t8;let s=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===s.status?t8:"dirty"===s.status||"dirty"===t.value?t7(s.value):s}}if("refinement"===s.type){let e=e=>{let t=s.refinement(e,n);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?t8:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===s.status?t8:("dirty"===s.status&&t.dirty(),e(s.value),{status:t.value,value:s.value})}}if("transform"===s.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>rs(e)?Promise.resolve(s.transform(e.value,n)).then(e=>({status:t.value,value:e})):e);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!rs(e))return e;let a=s.transform(e.value,n);if(a instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:a}}}_.assertNever(s)}}r9.create=(e,t,r)=>new r9({schema:e,typeName:I.ZodEffects,effect:t,...ru(r)}),r9.createWithPreprocess=(e,t,r)=>new r9({schema:t,effect:{type:"preprocess",transform:e},typeName:I.ZodEffects,...ru(r)});class r5 extends rc{_parse(e){return this._getType(e)===tY.undefined?re(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}r5.create=(e,t)=>new r5({innerType:e,typeName:I.ZodOptional,...ru(t)});class r3 extends rc{_parse(e){return this._getType(e)===tY.null?re(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}r3.create=(e,t)=>new r3({innerType:e,typeName:I.ZodNullable,...ru(t)});class r6 extends rc{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===tY.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}r6.create=(e,t)=>new r6({innerType:e,typeName:I.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...ru(t)});class r8 extends rc{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},s=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return rn(s)?s.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new t1(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===s.status?s.value:this._def.catchValue({get error(){return new t1(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}r8.create=(e,t)=>new r8({innerType:e,typeName:I.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...ru(t)});class r7 extends rc{_parse(e){if(this._getType(e)!==tY.nan){let t=this._getOrReturnCtx(e);return t3(t,{code:t0.invalid_type,expected:tY.nan,received:t.parsedType}),t8}return{status:"valid",value:e.data}}}r7.create=e=>new r7({typeName:I.ZodNaN,...ru(e)});let se=Symbol("zod_brand");class st extends rc{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class sr extends rc{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?t8:"dirty"===e.status?(t.dirty(),t7(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?t8:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new sr({in:e,out:t,typeName:I.ZodPipeline})}}class ss extends rc{_parse(e){let t=this._def.innerType._parse(e),r=e=>(rs(e)&&(e.value=Object.freeze(e.value)),e);return rn(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function sn(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function sa(e,t={},r){return e?rD.create().superRefine((s,n)=>{var a,i;let o=e(s);if(o instanceof Promise)return o.then(e=>{var a,i;if(!e){let e=sn(t,s),o=null===(i=null!==(a=e.fatal)&&void 0!==a?a:r)||void 0===i||i;n.addIssue({code:"custom",...e,fatal:o})}});if(!o){let e=sn(t,s),o=null===(i=null!==(a=e.fatal)&&void 0!==a?a:r)||void 0===i||i;n.addIssue({code:"custom",...e,fatal:o})}}):rD.create()}ss.create=(e,t)=>new ss({innerType:e,typeName:I.ZodReadonly,...ru(t)});let si={object:rB.lazycreate};!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(I||(I={}));let so=rN.create,sl=rP.create,su=r7.create,sc=rC.create,sd=rO.create,sp=r$.create,sh=rj.create,sm=rR.create,sf=rq.create,sg=rD.create,sy=rM.create,sv=rL.create,sb=rF.create,sw=rz.create,s_=rB.create,sS=rB.strictCreate,sx=rZ.create,sT=rJ.create,sk=rV.create,sI=rK.create,sE=rQ.create,sA=rW.create,sN=rH.create,sP=rG.create,sC=rY.create,sO=rX.create,s$=r1.create,sj=r2.create,sR=r4.create,sq=r9.create,sD=r5.create,sM=r3.create,sL=r9.createWithPreprocess,sF=sr.create;var sz=Object.freeze({__proto__:null,defaultErrorMap:t2,setErrorMap:function(e){t4=e},getErrorMap:t9,makeIssue:t5,EMPTY_PATH:[],addIssueToContext:t3,ParseStatus:t6,INVALID:t8,DIRTY:t7,OK:re,isAborted:rt,isDirty:rr,isValid:rs,isAsync:rn,get util(){return _},get objectUtil(){return S},ZodParsedType:tY,getParsedType:tX,ZodType:rc,datetimeRegex:rA,ZodString:rN,ZodNumber:rP,ZodBigInt:rC,ZodBoolean:rO,ZodDate:r$,ZodSymbol:rj,ZodUndefined:rR,ZodNull:rq,ZodAny:rD,ZodUnknown:rM,ZodNever:rL,ZodVoid:rF,ZodArray:rz,ZodObject:rB,ZodUnion:rZ,ZodDiscriminatedUnion:rJ,ZodIntersection:rV,ZodTuple:rK,ZodRecord:rQ,ZodMap:rW,ZodSet:rH,ZodFunction:rG,ZodLazy:rY,ZodLiteral:rX,ZodEnum:r1,ZodNativeEnum:r2,ZodPromise:r4,ZodEffects:r9,ZodTransformer:r9,ZodOptional:r5,ZodNullable:r3,ZodDefault:r6,ZodCatch:r8,ZodNaN:r7,BRAND:se,ZodBranded:st,ZodPipeline:sr,ZodReadonly:ss,custom:sa,Schema:rc,ZodSchema:rc,late:si,get ZodFirstPartyTypeKind(){return I},coerce:{string:e=>rN.create({...e,coerce:!0}),number:e=>rP.create({...e,coerce:!0}),boolean:e=>rO.create({...e,coerce:!0}),bigint:e=>rC.create({...e,coerce:!0}),date:e=>r$.create({...e,coerce:!0})},any:sg,array:sw,bigint:sc,boolean:sd,date:sp,discriminatedUnion:sT,effect:sq,enum:s$,function:sP,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>sa(t=>t instanceof e,t),intersection:sk,lazy:sC,literal:sO,map:sA,nan:su,nativeEnum:sj,never:sv,null:sf,nullable:sM,number:sl,object:s_,oboolean:()=>sd().optional(),onumber:()=>sl().optional(),optional:sD,ostring:()=>so().optional(),pipeline:sF,preprocess:sL,promise:sR,record:sE,set:sN,strictObject:sS,string:so,symbol:sh,transformer:sq,tuple:sI,undefined:sm,union:sx,unknown:sy,void:sb,NEVER:t8,ZodIssueCode:t0,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:t1});function sB(e){var t,r;return null!=(r=null==(t=null==e?void 0:e.content)?void 0:t.map(({token:e,logprob:t,top_logprobs:r})=>({token:e,logprob:t,topLogprobs:r?r.map(({token:e,logprob:t})=>({token:e,logprob:t})):[]})))?r:void 0}function sZ(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}var sU=sz.object({error:sz.object({message:sz.string(),type:sz.string().nullish(),param:sz.any().nullish(),code:sz.union([sz.string(),sz.number()]).nullish()})}),sJ=(({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:s,url:n,requestBodyValues:a})=>{let i=await s.text(),o=tq(s);if(""===i.trim())return{responseHeaders:o,value:new eK({message:s.statusText,url:n,requestBodyValues:a,statusCode:s.status,responseHeaders:o,responseBody:i,isRetryable:null==r?void 0:r(s)})};try{let l=function({text:e,schema:t}){try{let r=tE.parse(e);if(null==t)return r;return function({value:e,schema:t}){let r=tz({value:e,schema:t});if(!r.success)throw tw.wrap({value:e,cause:r.error});return r.value}({value:r,schema:t})}catch(t){if(tn.isInstance(t)||tw.isInstance(t))throw t;throw new tn({text:e,cause:t})}}({text:i,schema:e});return{responseHeaders:o,value:new eK({message:t(l),url:n,requestBodyValues:a,statusCode:s.status,responseHeaders:o,responseBody:i,data:l,isRetryable:null==r?void 0:r(s,l)})}}catch(e){return{responseHeaders:o,value:new eK({message:s.statusText,url:n,requestBodyValues:a,statusCode:s.status,responseHeaders:o,responseBody:i,isRetryable:null==r?void 0:r(s)})}}})({errorSchema:sU,errorToMessage:e=>e.error.message});function sV({id:e,model:t,created:r}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=r?new Date(1e3*r):void 0}}var sK=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get supportsStructuredOutputs(){var e;return null!=(e=this.settings.structuredOutputs)?e:sG(this.modelId)}get defaultObjectGenerationMode(){return this.modelId.startsWith("gpt-4o-audio-preview")?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:e,prompt:t,maxTokens:r,temperature:s,topP:n,topK:a,frequencyPenalty:i,presencePenalty:o,stopSequences:l,responseFormat:u,seed:c,providerMetadata:d}){var p,h,m,f,g,y,v,b;let w=e.type,_=[];null!=a&&_.push({type:"unsupported-setting",setting:"topK"}),(null==u?void 0:u.type)!=="json"||null==u.schema||this.supportsStructuredOutputs||_.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});let S=this.settings.useLegacyFunctionCalling;if(S&&!0===this.settings.parallelToolCalls)throw new tT({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(S&&this.supportsStructuredOutputs)throw new tT({functionality:"structuredOutputs with useLegacyFunctionCalling"});"remove"===sY(this.modelId)&&t.some(e=>"system"===e.role)&&_.push({type:"other",message:"system messages are removed for this model"});let x={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:!0===this.settings.logprobs||"number"==typeof this.settings.logprobs||void 0,top_logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:r,temperature:s,top_p:n,frequency_penalty:i,presence_penalty:o,response_format:(null==u?void 0:u.type)==="json"?this.supportsStructuredOutputs&&null!=u.schema?{type:"json_schema",json_schema:{schema:u.schema,strict:!0,name:null!=(p=u.name)?p:"response",description:u.description}}:{type:"json_object"}:void 0,stop:l,seed:c,max_completion_tokens:null==(h=null==d?void 0:d.openai)?void 0:h.maxCompletionTokens,store:null==(m=null==d?void 0:d.openai)?void 0:m.store,metadata:null==(f=null==d?void 0:d.openai)?void 0:f.metadata,prediction:null==(g=null==d?void 0:d.openai)?void 0:g.prediction,reasoning_effort:null!=(v=null==(y=null==d?void 0:d.openai)?void 0:y.reasoningEffort)?v:this.settings.reasoningEffort,messages:function({prompt:e,useLegacyFunctionCalling:t=!1,systemMessageMode:r="system"}){let s=[];for(let{role:n,content:a}of e)switch(n){case"system":switch(r){case"system":s.push({role:"system",content:a});break;case"developer":s.push({role:"developer",content:a});break;case"remove":break;default:throw Error(`Unsupported system message mode: ${r}`)}break;case"user":if(1===a.length&&"text"===a[0].type){s.push({role:"user",content:a[0].text});break}s.push({role:"user",content:a.map(e=>{var t,r,s;switch(e.type){case"text":return{type:"text",text:e.text};case"image":return{type:"image_url",image_url:{url:e.image instanceof URL?e.image.toString():`data:${null!=(t=e.mimeType)?t:"image/jpeg"};base64,${tG(e.image)}`,detail:null==(s=null==(r=e.providerMetadata)?void 0:r.openai)?void 0:s.imageDetail}};case"file":if(e.data instanceof URL)throw new tT({functionality:"'File content parts with URL data' functionality not supported."});switch(e.mimeType){case"audio/wav":return{type:"input_audio",input_audio:{data:e.data,format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:e.data,format:"mp3"}};default:throw new tT({functionality:`File content part type ${e.mimeType} in user messages`})}}})});break;case"assistant":{let e="",r=[];for(let t of a)switch(t.type){case"text":e+=t.text;break;case"tool-call":r.push({id:t.toolCallId,type:"function",function:{name:t.toolName,arguments:JSON.stringify(t.args)}});break;default:throw Error(`Unsupported part: ${t}`)}if(t){if(r.length>1)throw new tT({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});s.push({role:"assistant",content:e,function_call:r.length>0?r[0].function:void 0})}else s.push({role:"assistant",content:e,tool_calls:r.length>0?r:void 0});break}case"tool":for(let e of a)t?s.push({role:"function",name:e.toolName,content:JSON.stringify(e.result)}):s.push({role:"tool",tool_call_id:e.toolCallId,content:JSON.stringify(e.result)});break;default:throw Error(`Unsupported role: ${n}`)}return s}({prompt:t,useLegacyFunctionCalling:S,systemMessageMode:sY(this.modelId)})};switch(sG(this.modelId)&&(null!=x.temperature&&(x.temperature=void 0,_.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=x.top_p&&(x.top_p=void 0,_.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),null!=x.frequency_penalty&&(x.frequency_penalty=void 0,_.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),null!=x.presence_penalty&&(x.presence_penalty=void 0,_.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),null!=x.logit_bias&&(x.logit_bias=void 0,_.push({type:"other",message:"logitBias is not supported for reasoning models"})),null!=x.logprobs&&(x.logprobs=void 0,_.push({type:"other",message:"logprobs is not supported for reasoning models"})),null!=x.top_logprobs&&(x.top_logprobs=void 0,_.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),null!=x.max_tokens&&(null==x.max_completion_tokens&&(x.max_completion_tokens=x.max_tokens),x.max_tokens=void 0)),w){case"regular":{let{tools:t,tool_choice:r,functions:s,function_call:n,toolWarnings:a}=function({mode:e,useLegacyFunctionCalling:t=!1,structuredOutputs:r}){var s;let n=(null==(s=e.tools)?void 0:s.length)?e.tools:void 0,a=[];if(null==n)return{tools:void 0,tool_choice:void 0,toolWarnings:a};let i=e.toolChoice;if(t){let e=[];for(let t of n)"provider-defined"===t.type?a.push({type:"unsupported-tool",tool:t}):e.push({name:t.name,description:t.description,parameters:t.parameters});if(null==i)return{functions:e,function_call:void 0,toolWarnings:a};switch(i.type){case"auto":case"none":case void 0:return{functions:e,function_call:void 0,toolWarnings:a};case"required":throw new tT({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return{functions:e,function_call:{name:i.toolName},toolWarnings:a}}}let o=[];for(let e of n)"provider-defined"===e.type?a.push({type:"unsupported-tool",tool:e}):o.push({type:"function",function:{name:e.name,description:e.description,parameters:e.parameters,strict:!!r||void 0}});if(null==i)return{tools:o,tool_choice:void 0,toolWarnings:a};let l=i.type;switch(l){case"auto":case"none":case"required":return{tools:o,tool_choice:l,toolWarnings:a};case"tool":return{tools:o,tool_choice:{type:"function",function:{name:i.toolName}},toolWarnings:a};default:throw new tT({functionality:`Unsupported tool choice type: ${l}`})}}({mode:e,useLegacyFunctionCalling:S,structuredOutputs:this.supportsStructuredOutputs});return{args:{...x,tools:t,tool_choice:r,functions:s,function_call:n},warnings:[..._,...a]}}case"object-json":return{args:{...x,response_format:this.supportsStructuredOutputs&&null!=e.schema?{type:"json_schema",json_schema:{schema:e.schema,strict:!0,name:null!=(b=e.name)?b:"response",description:e.description}}:{type:"json_object"}},warnings:_};case"object-tool":return{args:S?{...x,function_call:{name:e.tool.name},functions:[{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}]}:{...x,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:!!this.supportsStructuredOutputs||void 0}}]},warnings:_};default:throw Error(`Unsupported type: ${w}`)}}async doGenerate(e){var t,r,s,n,a,i,o,l;let{args:u,warnings:c}=this.getArgs(e),{responseHeaders:d,value:p}=await tJ({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:tj(this.config.headers(),e.headers),body:u,failedResponseHandler:sJ,successfulResponseHandler:tQ(sW),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:h,...m}=u,f=p.choices[0],g=null==(t=p.usage)?void 0:t.completion_tokens_details,y=null==(r=p.usage)?void 0:r.prompt_tokens_details,v={openai:{}};return(null==g?void 0:g.reasoning_tokens)!=null&&(v.openai.reasoningTokens=null==g?void 0:g.reasoning_tokens),(null==g?void 0:g.accepted_prediction_tokens)!=null&&(v.openai.acceptedPredictionTokens=null==g?void 0:g.accepted_prediction_tokens),(null==g?void 0:g.rejected_prediction_tokens)!=null&&(v.openai.rejectedPredictionTokens=null==g?void 0:g.rejected_prediction_tokens),(null==y?void 0:y.cached_tokens)!=null&&(v.openai.cachedPromptTokens=null==y?void 0:y.cached_tokens),{text:null!=(s=f.message.content)?s:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&f.message.function_call?[{toolCallType:"function",toolCallId:tM(),toolName:f.message.function_call.name,args:f.message.function_call.arguments}]:null==(n=f.message.tool_calls)?void 0:n.map(e=>{var t;return{toolCallType:"function",toolCallId:null!=(t=e.id)?t:tM(),toolName:e.function.name,args:e.function.arguments}}),finishReason:sZ(f.finish_reason),usage:{promptTokens:null!=(i=null==(a=p.usage)?void 0:a.prompt_tokens)?i:NaN,completionTokens:null!=(l=null==(o=p.usage)?void 0:o.completion_tokens)?l:NaN},rawCall:{rawPrompt:h,rawSettings:m},rawResponse:{headers:d},request:{body:JSON.stringify(u)},response:sV(p),warnings:c,logprobs:sB(f.logprobs),providerMetadata:v}}async doStream(e){let t;if(this.settings.simulateStreaming){let t=await this.doGenerate(e);return{stream:new ReadableStream({start(e){if(e.enqueue({type:"response-metadata",...t.response}),t.text&&e.enqueue({type:"text-delta",textDelta:t.text}),t.toolCalls)for(let r of t.toolCalls)e.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:r.toolCallId,toolName:r.toolName,argsTextDelta:r.args}),e.enqueue({type:"tool-call",...r});e.enqueue({type:"finish",finishReason:t.finishReason,usage:t.usage,logprobs:t.logprobs,providerMetadata:t.providerMetadata}),e.close()}}),rawCall:t.rawCall,rawResponse:t.rawResponse,warnings:t.warnings}}let{args:r,warnings:s}=this.getArgs(e),n={...r,stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},{responseHeaders:a,value:i}=await tJ({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:tj(this.config.headers(),e.headers),body:n,failedResponseHandler:sJ,successfulResponseHandler:tK(sH),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:o,...l}=r,u=[],c="unknown",d={promptTokens:void 0,completionTokens:void 0},p=!0,{useLegacyFunctionCalling:h}=this.settings,m={openai:{}};return{stream:i.pipeThrough(new TransformStream({transform(e,r){var s,n,a,i,o,l,f,g,y,v,b,w;if(!e.success){c="error",r.enqueue({type:"error",error:e.error});return}let _=e.value;if("error"in _){c="error",r.enqueue({type:"error",error:_.error});return}if(p&&(p=!1,r.enqueue({type:"response-metadata",...sV(_)})),null!=_.usage){let{prompt_tokens:e,completion_tokens:t,prompt_tokens_details:r,completion_tokens_details:s}=_.usage;d={promptTokens:null!=e?e:void 0,completionTokens:null!=t?t:void 0},(null==s?void 0:s.reasoning_tokens)!=null&&(m.openai.reasoningTokens=null==s?void 0:s.reasoning_tokens),(null==s?void 0:s.accepted_prediction_tokens)!=null&&(m.openai.acceptedPredictionTokens=null==s?void 0:s.accepted_prediction_tokens),(null==s?void 0:s.rejected_prediction_tokens)!=null&&(m.openai.rejectedPredictionTokens=null==s?void 0:s.rejected_prediction_tokens),(null==r?void 0:r.cached_tokens)!=null&&(m.openai.cachedPromptTokens=null==r?void 0:r.cached_tokens)}let S=_.choices[0];if((null==S?void 0:S.finish_reason)!=null&&(c=sZ(S.finish_reason)),(null==S?void 0:S.delta)==null)return;let x=S.delta;null!=x.content&&r.enqueue({type:"text-delta",textDelta:x.content});let T=sB(null==S?void 0:S.logprobs);(null==T?void 0:T.length)&&(void 0===t&&(t=[]),t.push(...T));let k=h&&null!=x.function_call?[{type:"function",id:tM(),function:x.function_call,index:0}]:x.tool_calls;if(null!=k)for(let e of k){let t=e.index;if(null==u[t]){if("function"!==e.type)throw new te({data:e,message:"Expected 'function' type."});if(null==e.id)throw new te({data:e,message:"Expected 'id' to be a string."});if((null==(s=e.function)?void 0:s.name)==null)throw new te({data:e,message:"Expected 'function.name' to be a string."});u[t]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(n=e.function.arguments)?n:""},hasFinished:!1};let l=u[t];(null==(a=l.function)?void 0:a.name)!=null&&(null==(i=l.function)?void 0:i.arguments)!=null&&(l.function.arguments.length>0&&r.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:l.id,toolName:l.function.name,argsTextDelta:l.function.arguments}),tZ(l.function.arguments)&&(r.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(o=l.id)?o:tM(),toolName:l.function.name,args:l.function.arguments}),l.hasFinished=!0));continue}let c=u[t];!c.hasFinished&&((null==(l=e.function)?void 0:l.arguments)!=null&&(c.function.arguments+=null!=(g=null==(f=e.function)?void 0:f.arguments)?g:""),r.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:c.id,toolName:c.function.name,argsTextDelta:null!=(y=e.function.arguments)?y:""}),(null==(v=c.function)?void 0:v.name)!=null&&(null==(b=c.function)?void 0:b.arguments)!=null&&tZ(c.function.arguments)&&(r.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(w=c.id)?w:tM(),toolName:c.function.name,args:c.function.arguments}),c.hasFinished=!0))}},flush(e){var r,s;e.enqueue({type:"finish",finishReason:c,logprobs:t,usage:{promptTokens:null!=(r=d.promptTokens)?r:NaN,completionTokens:null!=(s=d.completionTokens)?s:NaN},...null!=m?{providerMetadata:m}:{}})}})),rawCall:{rawPrompt:o,rawSettings:l},rawResponse:{headers:a},request:{body:JSON.stringify(n)},warnings:s}}},sQ=sz.object({prompt_tokens:sz.number().nullish(),completion_tokens:sz.number().nullish(),prompt_tokens_details:sz.object({cached_tokens:sz.number().nullish()}).nullish(),completion_tokens_details:sz.object({reasoning_tokens:sz.number().nullish(),accepted_prediction_tokens:sz.number().nullish(),rejected_prediction_tokens:sz.number().nullish()}).nullish()}).nullish(),sW=sz.object({id:sz.string().nullish(),created:sz.number().nullish(),model:sz.string().nullish(),choices:sz.array(sz.object({message:sz.object({role:sz.literal("assistant").nullish(),content:sz.string().nullish(),function_call:sz.object({arguments:sz.string(),name:sz.string()}).nullish(),tool_calls:sz.array(sz.object({id:sz.string().nullish(),type:sz.literal("function"),function:sz.object({name:sz.string(),arguments:sz.string()})})).nullish()}),index:sz.number(),logprobs:sz.object({content:sz.array(sz.object({token:sz.string(),logprob:sz.number(),top_logprobs:sz.array(sz.object({token:sz.string(),logprob:sz.number()}))})).nullable()}).nullish(),finish_reason:sz.string().nullish()})),usage:sQ}),sH=sz.union([sz.object({id:sz.string().nullish(),created:sz.number().nullish(),model:sz.string().nullish(),choices:sz.array(sz.object({delta:sz.object({role:sz.enum(["assistant"]).nullish(),content:sz.string().nullish(),function_call:sz.object({name:sz.string().optional(),arguments:sz.string().optional()}).nullish(),tool_calls:sz.array(sz.object({index:sz.number(),id:sz.string().nullish(),type:sz.literal("function").optional(),function:sz.object({name:sz.string().nullish(),arguments:sz.string().nullish()})})).nullish()}).nullish(),logprobs:sz.object({content:sz.array(sz.object({token:sz.string(),logprob:sz.number(),top_logprobs:sz.array(sz.object({token:sz.string(),logprob:sz.number()}))})).nullable()}).nullish(),finish_reason:sz.string().nullable().optional(),index:sz.number()})),usage:sQ}),sU]);function sG(e){return"o1"===e||e.startsWith("o1-")||"o3"===e||e.startsWith("o3-")}function sY(e){var t,r;return sG(e)?null!=(r=null==(t=sX[e])?void 0:t.systemMessageMode)?r:"developer":"system"}var sX={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"}};function s0(e){return null==e?void 0:e.tokens.map((t,r)=>({token:t,logprob:e.token_logprobs[r],topLogprobs:e.top_logprobs?Object.entries(e.top_logprobs[r]).map(([e,t])=>({token:e,logprob:t})):[]}))}var s1=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:r,maxTokens:s,temperature:n,topP:a,topK:i,frequencyPenalty:o,presencePenalty:l,stopSequences:u,responseFormat:c,seed:d}){var p;let h=e.type,m=[];null!=i&&m.push({type:"unsupported-setting",setting:"topK"}),null!=c&&"text"!==c.type&&m.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{prompt:f,stopSequences:g}=function({prompt:e,inputFormat:t,user:r="user",assistant:s="assistant"}){if("prompt"===t&&1===e.length&&"user"===e[0].role&&1===e[0].content.length&&"text"===e[0].content[0].type)return{prompt:e[0].content[0].text};let n="";for(let{role:t,content:a}of("system"===e[0].role&&(n+=`${e[0].content}

`,e=e.slice(1)),e))switch(t){case"system":throw new e3({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{let e=a.map(e=>{switch(e.type){case"text":return e.text;case"image":throw new tT({functionality:"images"})}}).join("");n+=`${r}:
${e}

`;break}case"assistant":{let e=a.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new tT({functionality:"tool-call messages"})}}).join("");n+=`${s}:
${e}

`;break}case"tool":throw new tT({functionality:"tool messages"});default:throw Error(`Unsupported role: ${t}`)}return{prompt:n+=`${s}:
`,stopSequences:[`
${r}:`]}}({prompt:r,inputFormat:t}),y=[...null!=g?g:[],...null!=u?u:[]],v={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:s,temperature:n,top_p:a,frequency_penalty:o,presence_penalty:l,seed:d,prompt:f,stop:y.length>0?y:void 0};switch(h){case"regular":if(null==(p=e.tools)?void 0:p.length)throw new tT({functionality:"tools"});if(e.toolChoice)throw new tT({functionality:"toolChoice"});return{args:v,warnings:m};case"object-json":throw new tT({functionality:"object-json mode"});case"object-tool":throw new tT({functionality:"object-tool mode"});default:throw Error(`Unsupported type: ${h}`)}}async doGenerate(e){let{args:t,warnings:r}=this.getArgs(e),{responseHeaders:s,value:n}=await tJ({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:tj(this.config.headers(),e.headers),body:t,failedResponseHandler:sJ,successfulResponseHandler:tQ(s2),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:a,...i}=t,o=n.choices[0];return{text:o.text,usage:{promptTokens:n.usage.prompt_tokens,completionTokens:n.usage.completion_tokens},finishReason:sZ(o.finish_reason),logprobs:s0(o.logprobs),rawCall:{rawPrompt:a,rawSettings:i},rawResponse:{headers:s},response:sV(n),warnings:r,request:{body:JSON.stringify(t)}}}async doStream(e){let t;let{args:r,warnings:s}=this.getArgs(e),n={...r,stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},{responseHeaders:a,value:i}=await tJ({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:tj(this.config.headers(),e.headers),body:n,failedResponseHandler:sJ,successfulResponseHandler:tK(s4),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:o,...l}=r,u="unknown",c={promptTokens:Number.NaN,completionTokens:Number.NaN},d=!0;return{stream:i.pipeThrough(new TransformStream({transform(e,r){if(!e.success){u="error",r.enqueue({type:"error",error:e.error});return}let s=e.value;if("error"in s){u="error",r.enqueue({type:"error",error:s.error});return}d&&(d=!1,r.enqueue({type:"response-metadata",...sV(s)})),null!=s.usage&&(c={promptTokens:s.usage.prompt_tokens,completionTokens:s.usage.completion_tokens});let n=s.choices[0];(null==n?void 0:n.finish_reason)!=null&&(u=sZ(n.finish_reason)),(null==n?void 0:n.text)!=null&&r.enqueue({type:"text-delta",textDelta:n.text});let a=s0(null==n?void 0:n.logprobs);(null==a?void 0:a.length)&&(void 0===t&&(t=[]),t.push(...a))},flush(e){e.enqueue({type:"finish",finishReason:u,logprobs:t,usage:c})}})),rawCall:{rawPrompt:o,rawSettings:l},rawResponse:{headers:a},warnings:s,request:{body:JSON.stringify(n)}}}},s2=sz.object({id:sz.string().nullish(),created:sz.number().nullish(),model:sz.string().nullish(),choices:sz.array(sz.object({text:sz.string(),finish_reason:sz.string(),logprobs:sz.object({tokens:sz.array(sz.string()),token_logprobs:sz.array(sz.number()),top_logprobs:sz.array(sz.record(sz.string(),sz.number())).nullable()}).nullish()})),usage:sz.object({prompt_tokens:sz.number(),completion_tokens:sz.number()})}),s4=sz.union([sz.object({id:sz.string().nullish(),created:sz.number().nullish(),model:sz.string().nullish(),choices:sz.array(sz.object({text:sz.string(),finish_reason:sz.string().nullish(),index:sz.number(),logprobs:sz.object({tokens:sz.array(sz.string()),token_logprobs:sz.array(sz.number()),top_logprobs:sz.array(sz.record(sz.string(),sz.number())).nullable()}).nullish()})),usage:sz.object({prompt_tokens:sz.number(),completion_tokens:sz.number()}).nullish()}),sU]),s9=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return null!=(e=this.settings.maxEmbeddingsPerCall)?e:2048}get supportsParallelCalls(){var e;return null==(e=this.settings.supportsParallelCalls)||e}async doEmbed({values:e,headers:t,abortSignal:r}){if(e.length>this.maxEmbeddingsPerCall)throw new tg({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:s,value:n}=await tJ({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:tj(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:sJ,successfulResponseHandler:tQ(s5),abortSignal:r,fetch:this.config.fetch});return{embeddings:n.data.map(e=>e.embedding),usage:n.usage?{tokens:n.usage.prompt_tokens}:void 0,rawResponse:{headers:s}}}},s5=sz.object({data:sz.array(sz.object({embedding:sz.array(sz.number())})),usage:sz.object({prompt_tokens:sz.number()}).nullish()}),s3={"dall-e-3":1,"dall-e-2":10},s6=class{constructor(e,t,r){this.modelId=e,this.settings=t,this.config=r,this.specificationVersion="v1"}get maxImagesPerCall(){var e,t;return null!=(t=null!=(e=this.settings.maxImagesPerCall)?e:s3[this.modelId])?t:1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:r,aspectRatio:s,seed:n,providerOptions:a,headers:i,abortSignal:o}){var l,u,c,d;let p=[];null!=s&&p.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),null!=n&&p.push({type:"unsupported-setting",setting:"seed"});let h=null!=(c=null==(u=null==(l=this.config._internal)?void 0:l.currentDate)?void 0:u.call(l))?c:new Date,{value:m,responseHeaders:f}=await tJ({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:tj(this.config.headers(),i),body:{model:this.modelId,prompt:e,n:t,size:r,...null!=(d=a.openai)?d:{},response_format:"b64_json"},failedResponseHandler:sJ,successfulResponseHandler:tQ(s8),abortSignal:o,fetch:this.config.fetch});return{images:m.data.map(e=>e.b64_json),warnings:p,response:{timestamp:h,modelId:this.modelId,headers:f}}}},s8=sz.object({data:sz.array(sz.object({b64_json:sz.string()}))});function s7(e={}){var t,r,s,n;let a=null!=(t=null==(n=e.baseURL)?void 0:n.replace(/\/$/,""))?t:"https://api.openai.com/v1",i=null!=(r=e.compatibility)?r:"compatible",o=null!=(s=e.name)?s:"openai",l=()=>({Authorization:`Bearer ${function({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:s}){if("string"==typeof e)return e;if(null!=e)throw new tl({message:`${s} API key must be a string.`});if("undefined"==typeof process)throw new tl({message:`${s} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(null==(e=process.env[t]))throw new tl({message:`${s} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new tl({message:`${s} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers}),u=(t,r={})=>new sK(t,r,{provider:`${o}.chat`,url:({path:e})=>`${a}${e}`,headers:l,compatibility:i,fetch:e.fetch}),c=(t,r={})=>new s1(t,r,{provider:`${o}.completion`,url:({path:e})=>`${a}${e}`,headers:l,compatibility:i,fetch:e.fetch}),d=(t,r={})=>new s9(t,r,{provider:`${o}.embedding`,url:({path:e})=>`${a}${e}`,headers:l,fetch:e.fetch}),p=(t,r={})=>new s6(t,r,{provider:`${o}.image`,url:({path:e})=>`${a}${e}`,headers:l,fetch:e.fetch}),h=(e,t)=>{if(new.target)throw Error("The OpenAI model function cannot be called with the new keyword.");return"gpt-3.5-turbo-instruct"===e?c(e,t):u(e,t)},m=function(e,t){return h(e,t)};return m.languageModel=h,m.chat=u,m.completion=c,m.embedding=d,m.textEmbedding=d,m.textEmbeddingModel=d,m.image=p,m.imageModel=p,m}s7({compatibility:"strict"});var ne={name:"HMAC",hash:"SHA-256"},nt=/^[\w!#$%&'*.^`|~+-]+$/,nr=/^[ !#-:<-[\]-~]*$/,ns=(e,t)=>{if(t&&-1===e.indexOf(t))return{};let r=e.trim().split(";"),s={};for(let e of r){let r=(e=e.trim()).indexOf("=");if(-1===r)continue;let n=e.substring(0,r).trim();if(t&&t!==n||!nt.test(n))continue;let a=e.substring(r+1).trim();if(a.startsWith('"')&&a.endsWith('"')&&(a=a.slice(1,-1)),nr.test(a)&&(s[n]=ey(a),t))break}return s},nn=(e,t,r)=>{let s=e.req.raw.headers.get("Cookie");if("string"==typeof t){if(!s)return;let e=t;return"secure"===r?e="__Secure-"+t:"host"===r&&(e="__Host-"+t),ns(s,e)[e]}return s?ns(s):{}},na=class extends Error{res;status;constructor(e=500,t){super(t?.message,{cause:t?.cause}),this.res=t?.res,this.status=e}getResponse(){return this.res?new Response(this.res.body,{status:this.status,headers:this.res.headers}):new Response(this.message,{status:this.status})}},ni=(e,t)=>new Response(e,{headers:{"Content-Type":t}}).formData(),no=/^application\/([a-z-\.]+\+)?json(;\s*[a-zA-Z0-9\-]+\=([^;]+))*$/,nl=/^multipart\/form-data(;\s?boundary=[a-zA-Z0-9'"()+_,\-./:=?]+)?$/,nu=/^application\/x-www-form-urlencoded(;\s*[a-zA-Z0-9\-]+\=([^;]+))*$/,nc=(e,t)=>async(r,s)=>{let n={},a=r.req.header("Content-Type");switch(e){case"json":if(!a||!no.test(a))break;try{n=await r.req.json()}catch{throw new na(400,{message:"Malformed JSON in request body"})}break;case"form":{let e;if(!a||!(nl.test(a)||nu.test(a)))break;if(r.req.bodyCache.formData)e=await r.req.bodyCache.formData;else try{let t=await r.req.arrayBuffer();e=await ni(t,a),r.req.bodyCache.formData=e}catch(t){let e="Malformed FormData request.";throw new na(400,{message:e+=t instanceof Error?` ${t.message}`:` ${String(t)}`})}let t={};e.forEach((e,r)=>{r.endsWith("[]")?(t[r]??=[]).push(e):Array.isArray(t[r])?t[r].push(e):r in t?t[r]=[t[r],e]:t[r]=e}),n=t;break}case"query":n=Object.fromEntries(Object.entries(r.req.queries()).map(([e,t])=>1===t.length?[e,t[0]]:[e,t]));break;case"param":n=r.req.param();break;case"header":n=r.req.header();break;case"cookie":n=nn(r)}let i=await t(n,r);if(i instanceof Response)return i;r.req.addValidatedData(e,i),await s()},nd=(e,t,r)=>nc(e,async(s,n)=>{let a=s;if("header"===e&&t instanceof rB){let e=Object.fromEntries(Object.keys(t.shape).map(e=>[e.toLowerCase(),e]));a=Object.fromEntries(Object.entries(s).map(([t,r])=>[e[t]||t,r]))}let i=await t.safeParseAsync(a);if(r){let t=await r({data:a,...i,target:e},n);if(t){if(t instanceof Response)return t;if("response"in t)return t.response}}return i.success?i.data:n.json(i,400)}),np=r(2555),nh=r(3331);let nm=Symbol("Let zodToJsonSchema decide on which parser to use"),nf={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},ng=e=>"string"==typeof e?{...nf,name:e}:{...nf,...e},ny=e=>{let t=ng(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}};function nv(e,t,r,s){s?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function nb(e,t,r,s,n){e[t]=r,nv(e,t,s,n)}function nw(e,t){return nD(e.type._def,t)}let n_=(e,t)=>nD(e.innerType._def,t),nS=(e,t)=>{let r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(let s of e.checks)switch(s.kind){case"min":nb(r,"minimum",s.value,s.message,t);break;case"max":nb(r,"maximum",s.value,s.message,t)}return r},nx=e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e,nT={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===i&&(i=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),i),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function nk(e,t){let r={type:"string"};if(e.checks)for(let s of e.checks)switch(s.kind){case"min":nb(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,s.value):s.value,s.message,t);break;case"max":nb(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,s.value):s.value,s.message,t);break;case"email":switch(t.emailStrategy){case"format:email":nA(r,"email",s.message,t);break;case"format:idn-email":nA(r,"idn-email",s.message,t);break;case"pattern:zod":nN(r,nT.email,s.message,t)}break;case"url":nA(r,"uri",s.message,t);break;case"uuid":nA(r,"uuid",s.message,t);break;case"regex":nN(r,s.regex,s.message,t);break;case"cuid":nN(r,nT.cuid,s.message,t);break;case"cuid2":nN(r,nT.cuid2,s.message,t);break;case"startsWith":nN(r,RegExp(`^${nI(s.value,t)}`),s.message,t);break;case"endsWith":nN(r,RegExp(`${nI(s.value,t)}$`),s.message,t);break;case"datetime":nA(r,"date-time",s.message,t);break;case"date":nA(r,"date",s.message,t);break;case"time":nA(r,"time",s.message,t);break;case"duration":nA(r,"duration",s.message,t);break;case"length":nb(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,s.value):s.value,s.message,t),nb(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,s.value):s.value,s.message,t);break;case"includes":nN(r,RegExp(nI(s.value,t)),s.message,t);break;case"ip":"v6"!==s.version&&nA(r,"ipv4",s.message,t),"v4"!==s.version&&nA(r,"ipv6",s.message,t);break;case"base64url":nN(r,nT.base64url,s.message,t);break;case"jwt":nN(r,nT.jwt,s.message,t);break;case"cidr":"v6"!==s.version&&nN(r,nT.ipv4Cidr,s.message,t),"v4"!==s.version&&nN(r,nT.ipv6Cidr,s.message,t);break;case"emoji":nN(r,nT.emoji(),s.message,t);break;case"ulid":nN(r,nT.ulid,s.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":nA(r,"binary",s.message,t);break;case"contentEncoding:base64":nb(r,"contentEncoding","base64",s.message,t);break;case"pattern:zod":nN(r,nT.base64,s.message,t)}break;case"nanoid":nN(r,nT.nanoid,s.message,t)}return r}function nI(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)nE.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}let nE=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function nA(e,t,r,s){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&s.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&s.errorMessages&&{errorMessage:{format:r}}})):nb(e,"format",t,r,s)}function nN(e,t,r,s){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&s.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:nP(t,s),...r&&s.errorMessages&&{errorMessage:{pattern:r}}})):nb(e,"pattern",nP(t,s),r,s)}function nP(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},s=r.i?e.source.toLowerCase():e.source,n="",a=!1,i=!1,o=!1;for(let e=0;e<s.length;e++){if(a){n+=s[e],a=!1;continue}if(r.i){if(i){if(s[e].match(/[a-z]/)){o?(n+=s[e],n+=`${s[e-2]}-${s[e]}`.toUpperCase(),o=!1):"-"===s[e+1]&&s[e+2]?.match(/[a-z]/)?(n+=s[e],o=!0):n+=`${s[e]}${s[e].toUpperCase()}`;continue}}else if(s[e].match(/[a-z]/)){n+=`[${s[e]}${s[e].toUpperCase()}]`;continue}}if(r.m){if("^"===s[e]){n+=`(^|(?<=[\r
]))`;continue}if("$"===s[e]){n+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===s[e]){n+=i?`${s[e]}\r
`:`[${s[e]}\r
]`;continue}n+=s[e],"\\"===s[e]?a=!0:i&&"]"===s[e]?i=!1:i||"["!==s[e]||(i=!0)}try{new RegExp(n)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return n}function nC(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===I.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,s)=>({...r,[s]:nD(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",s]})??{}}),{}),additionalProperties:!1};let r={type:"object",additionalProperties:nD(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===I.ZodString&&e.keyType._def.checks?.length){let{type:s,...n}=nk(e.keyType._def,t);return{...r,propertyNames:n}}if(e.keyType?._def.typeName===I.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===I.ZodBranded&&e.keyType._def.type._def.typeName===I.ZodString&&e.keyType._def.type._def.checks?.length){let{type:s,...n}=nw(e.keyType._def,t);return{...r,propertyNames:n}}return r}let nO={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},n$=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>nD(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0},nj=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return nD(e.innerType._def,t);let r=nD(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},nR=(e,t)=>{if("input"===t.pipeStrategy)return nD(e.in._def,t);if("output"===t.pipeStrategy)return nD(e.out._def,t);let r=nD(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),s=nD(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,s].filter(e=>void 0!==e)}},nq=(e,t)=>nD(e.innerType._def,t);function nD(e,t,r=!1){let s=t.seen.get(e);if(t.override){let n=t.override?.(e,t,s,r);if(n!==nm)return n}if(s&&!r){let e=nM(s,t);if(void 0!==e)return e}let n={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,n);let a=nF(e,e.typeName,t);return a&&nz(e,t,a),n.jsonSchema=a,a}let nM=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:nL(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},nL=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},nF=(e,t,r)=>{switch(t){case I.ZodString:return nk(e,r);case I.ZodNumber:return function(e,t){let r={type:"number"};if(!e.checks)return r;for(let s of e.checks)switch(s.kind){case"int":r.type="integer",nv(r,"type",s.message,t);break;case"min":"jsonSchema7"===t.target?s.inclusive?nb(r,"minimum",s.value,s.message,t):nb(r,"exclusiveMinimum",s.value,s.message,t):(s.inclusive||(r.exclusiveMinimum=!0),nb(r,"minimum",s.value,s.message,t));break;case"max":"jsonSchema7"===t.target?s.inclusive?nb(r,"maximum",s.value,s.message,t):nb(r,"exclusiveMaximum",s.value,s.message,t):(s.inclusive||(r.exclusiveMaximum=!0),nb(r,"maximum",s.value,s.message,t));break;case"multipleOf":nb(r,"multipleOf",s.value,s.message,t)}return r}(e,r);case I.ZodObject:return function(e,t){let r="openAi"===t.target,s={type:"object",...Object.entries(e.shape()).reduce((e,[s,n])=>{if(void 0===n||void 0===n._def)return e;let a=n.isOptional();a&&r&&(n instanceof r5&&(n=n._def.innerType),n.isNullable()||(n=n.nullable()),a=!1);let i=nD(n._def,{...t,currentPath:[...t.currentPath,"properties",s],propertyPath:[...t.currentPath,"properties",s]});return void 0===i?e:{properties:{...e.properties,[s]:i},required:a?e.required:[...e.required,s]}},{properties:{},required:[]}),additionalProperties:"strict"===t.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:nD(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:nD(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0};return s.required.length||delete s.required,s}(e,r);case I.ZodBigInt:return function(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let s of e.checks)switch(s.kind){case"min":"jsonSchema7"===t.target?s.inclusive?nb(r,"minimum",s.value,s.message,t):nb(r,"exclusiveMinimum",s.value,s.message,t):(s.inclusive||(r.exclusiveMinimum=!0),nb(r,"minimum",s.value,s.message,t));break;case"max":"jsonSchema7"===t.target?s.inclusive?nb(r,"maximum",s.value,s.message,t):nb(r,"exclusiveMaximum",s.value,s.message,t):(s.inclusive||(r.exclusiveMaximum=!0),nb(r,"maximum",s.value,s.message,t));break;case"multipleOf":nb(r,"multipleOf",s.value,s.message,t)}return r}(e,r);case I.ZodBoolean:return{type:"boolean"};case I.ZodDate:return function e(t,r,s){let n=s??r.dateStrategy;if(Array.isArray(n))return{anyOf:n.map((s,n)=>e(t,r,s))};switch(n){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return nS(t,r)}}(e,r);case I.ZodUndefined:return{not:{}};case I.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case I.ZodArray:return function(e,t){let r={type:"array"};return e.type?._def&&e.type?._def?.typeName!==I.ZodAny&&(r.items=nD(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&nb(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&nb(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(nb(r,"minItems",e.exactLength.value,e.exactLength.message,t),nb(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}(e,r);case I.ZodUnion:case I.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return n$(e,t);let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(e=>e._def.typeName in nO&&(!e._def.checks||!e._def.checks.length))){let e=r.reduce((e,t)=>{let r=nO[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(r.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=r.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===r.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:r.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(r.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:r.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return n$(e,t)}(e,r);case I.ZodIntersection:return function(e,t){let r=[nD(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),nD(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e),s="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0,n=[];return r.forEach(e=>{if(nx(e))n.push(...e.allOf),void 0===e.unevaluatedProperties&&(s=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...s}=e;t=s}else s=void 0;n.push(t)}}),n.length?{allOf:n,...s}:void 0}(e,r);case I.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,r)=>nD(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:nD(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,r)=>nD(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,r);case I.ZodRecord:return nC(e,r);case I.ZodLiteral:return function(e,t){let r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}(e,r);case I.ZodEnum:return{type:"string",enum:Array.from(e.values)};case I.ZodNativeEnum:return function(e){let t=e.values,r=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),s=Array.from(new Set(r.map(e=>typeof e)));return{type:1===s.length?"string"===s[0]?"string":"number":["string","number"],enum:r}}(e);case I.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:nO[e.innerType._def.typeName],nullable:!0}:{type:[nO[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){let r=nD(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let r=nD(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}(e,r);case I.ZodOptional:return nj(e,r);case I.ZodMap:return function(e,t){return"record"===t.mapStrategy?nC(e,t):{type:"array",maxItems:125,items:{type:"array",items:[nD(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},nD(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,r);case I.ZodSet:return function(e,t){let r={type:"array",uniqueItems:!0,items:nD(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&nb(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&nb(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}(e,r);case I.ZodLazy:return nD(e.getter()._def,r);case I.ZodPromise:return nD(e.type._def,r);case I.ZodNaN:case I.ZodNever:return{not:{}};case I.ZodEffects:return function(e,t){return"input"===t.effectStrategy?nD(e.schema._def,t):{}}(e,r);case I.ZodAny:case I.ZodUnknown:return{};case I.ZodDefault:return function(e,t){return{...nD(e.innerType._def,t),default:e.defaultValue()}}(e,r);case I.ZodBranded:return nw(e,r);case I.ZodReadonly:return nq(e,r);case I.ZodCatch:return n_(e,r);case I.ZodPipeline:return nR(e,r);case I.ZodFunction:case I.ZodVoid:case I.ZodSymbol:default:return}},nz=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),nB=(e,t)=>{let r=ny(t),s="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,s])=>({...e,[t]:nD(s._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??{}}),{}):void 0,n="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,a=nD(e._def,void 0===n?r:{...r,currentPath:[...r.basePath,r.definitionPath,n]},!1)??{},i="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==i&&(a.title=i);let o=void 0===n?s?{...a,[r.definitionPath]:s}:a:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,n].join("/"),[r.definitionPath]:{...s,[n]:a}};return"jsonSchema7"===r.target?o.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===r.target||"openAi"===r.target)&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===r.target&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};var nZ={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},nU={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},nJ={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},nV={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},nK={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},nQ=[nZ,nU,nJ,nV,nK];nZ.code,nU.code,nJ.code,nV.code,nK.code,nZ.name,nZ.code,nU.name,nU.code,nJ.name,nJ.code,nV.name,nV.code,nK.name,nK.code,nQ.map(e=>e.code);var nW=[{code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},{code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},{code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},{code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},{code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},{code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("result"in e))throw Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},{code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName)throw Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},{code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("argsTextDelta"in e)||"string"!=typeof e.argsTextDelta)throw Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},{code:"d",name:"finish_message",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_message" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},{code:"e",name:"finish_step",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_step" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&"boolean"==typeof e.isContinued&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},{code:"f",name:"start_step",parse:e=>{if(null==e||"object"!=typeof e||!("messageId"in e)||"string"!=typeof e.messageId)throw Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},{code:"g",name:"reasoning",parse:e=>{if("string"!=typeof e)throw Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},{code:"h",name:"source",parse:e=>{if(null==e||"object"!=typeof e)throw Error('"source" parts expect a Source object.');return{type:"source",value:e}}}],nH=Object.fromEntries(nW.map(e=>[e.code,e]));Object.fromEntries(nW.map(e=>[e.name,e.code]));var nG=nW.map(e=>e.code),nY=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let r=e.slice(0,t);if(!nG.includes(r))throw Error(`Failed to parse stream string. Invalid code ${r}.`);let s=JSON.parse(e.slice(t+1));return nH[r].parse(s)};function nX(e,t){let r=nW.find(t=>t.name===e);if(!r)throw Error(`Invalid stream part type: ${e}`);return`${r.code}:${JSON.stringify(t)}
`}var n0=Symbol.for("vercel.ai.schema");function n1(e){return"object"==typeof e&&null!==e&&n0 in e&&!0===e[n0]&&"jsonSchema"in e&&"validate"in e?e:function(e,{validate:t}={}){return{[n0]:!0,_type:void 0,[tF]:!0,jsonSchema:e,validate:t}}(nB(e,{$refStrategy:"none",target:"jsonSchema7"}),{validate:t=>{let r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}var n2=Object.defineProperty,n4=(e,t)=>{for(var r in t)n2(e,r,{get:t[r],enumerable:!0})};function n9(e,{contentType:t,dataStreamVersion:r}){let s=new Headers(null!=e?e:{});return s.has("Content-Type")||s.set("Content-Type",t),void 0!==r&&s.set("X-Vercel-AI-Data-Stream",r),s}function n5(e,{contentType:t,dataStreamVersion:r}){let s={};if(null!=e)for(let[t,r]of Object.entries(e))s[t]=r;return null==s["Content-Type"]&&(s["Content-Type"]=t),void 0!==r&&(s["X-Vercel-AI-Data-Stream"]=r),s}function n3({response:e,status:t,statusText:r,headers:s,stream:n}){e.writeHead(null!=t?t:200,r,s);let a=n.getReader();(async()=>{try{for(;;){let{done:t,value:r}=await a.read();if(t)break;e.write(r)}}catch(e){throw e}finally{e.end()}})()}var n6="AI_InvalidArgumentError",n8=`vercel.ai.error.${n6}`,n7=Symbol.for(n8),ae=class extends eZ{constructor({parameter:e,value:t,message:r}){super({name:n6,message:`Invalid argument for parameter ${e}: ${r}`}),this[E]=!0,this.parameter=e,this.value=t}static isInstance(e){return eZ.hasMarker(e,n8)}};E=n7;var at="AI_RetryError",ar=`vercel.ai.error.${at}`,as=Symbol.for(ar),an=class extends eZ{constructor({message:e,reason:t,errors:r}){super({name:at,message:e}),this[A]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return eZ.hasMarker(e,ar)}};A=as;var aa=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2}={})=>async s=>ai(s,{maxRetries:e,delayInMs:t,backoffFactor:r});async function ai(e,{maxRetries:t,delayInMs:r,backoffFactor:s},n=[]){try{return await e()}catch(l){if(tL(l)||0===t)throw l;let a=null==l?"unknown error":"string"==typeof l?l:l instanceof Error?l.message:JSON.stringify(l),i=[...n,l],o=i.length;if(o>t)throw new an({message:`Failed after ${o} attempts. Last error: ${a}`,reason:"maxRetriesExceeded",errors:i});if(l instanceof Error&&eK.isInstance(l)&&!0===l.isRetryable&&o<=t)return await tR(r),ai(e,{maxRetries:t,delayInMs:s*r,backoffFactor:s},i);if(1===o)throw l;throw new an({message:`Failed after ${o} attempts with non-retryable error: '${a}'`,reason:"errorNotRetryable",errors:i})}}function ao({maxRetries:e}){if(null!=e){if(!Number.isInteger(e))throw new ae({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new ae({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let t=null!=e?e:2;return{maxRetries:t,retry:aa({maxRetries:t})}}function al({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}function au({model:e,settings:t,telemetry:r,headers:s}){var n;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,r])=>(e[`ai.settings.${t}`]=r,e),{}),...Object.entries(null!=(n=null==r?void 0:r.metadata)?n:{}).reduce((e,[t,r])=>(e[`ai.telemetry.metadata.${t}`]=r,e),{}),...Object.entries(null!=s?s:{}).reduce((e,[t,r])=>(void 0!==r&&(e[`ai.request.headers.${t}`]=r),e),{})}}var ac={startSpan:()=>ad,startActiveSpan:(e,t,r,s)=>"function"==typeof t?t(ad):"function"==typeof r?r(ad):"function"==typeof s?s(ad):void 0},ad={spanContext:()=>ap,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},ap={traceId:"",spanId:"",traceFlags:0};function ah({isEnabled:e=!1,tracer:t}={}){return e?t||np.u.getTracer("ai"):ac}function am({name:e,tracer:t,attributes:r,fn:s,endWhenDone:n=!0}){return t.startActiveSpan(e,{attributes:r},async e=>{try{let t=await s(e);return n&&e.end(),t}catch(t){try{t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:nh.s.ERROR,message:t.message})):e.setStatus({code:nh.s.ERROR})}finally{e.end()}throw t}})}function af({telemetry:e,attributes:t}){return(null==e?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((t,[r,s])=>{if(void 0===s)return t;if("object"==typeof s&&"input"in s&&"function"==typeof s.input){if((null==e?void 0:e.recordInputs)===!1)return t;let n=s.input();return void 0===n?t:{...t,[r]:n}}if("object"==typeof s&&"output"in s&&"function"==typeof s.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let n=s.output();return void 0===n?t:{...t,[r]:n}}return{...t,[r]:s}},{})}Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");var ag="AI_NoObjectGeneratedError",ay=`vercel.ai.error.${ag}`,av=Symbol.for(ay),ab=class extends eZ{constructor({message:e="No object generated.",cause:t,text:r,response:s,usage:n}){super({name:ag,message:e,cause:t}),this[P]=!0,this.text=r,this.response=s,this.usage=n}static isInstance(e){return eZ.hasMarker(e,ay)}};P=av;var aw="AI_DownloadError",a_=`vercel.ai.error.${aw}`,aS=Symbol.for(a_),ax=class extends eZ{constructor({url:e,statusCode:t,statusText:r,cause:s,message:n=null==s?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${s}`}){super({name:aw,message:n,cause:s}),this[C]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return eZ.hasMarker(e,a_)}};async function aT({url:e,fetchImplementation:t=fetch}){var r;let s=e.toString();try{let e=await t(s);if(!e.ok)throw new ax({url:s,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mimeType:null!=(r=e.headers.get("content-type"))?r:void 0}}catch(e){if(ax.isInstance(e))throw e;throw new ax({url:s,cause:e})}}C=aS;var ak=[{mimeType:"image/gif",bytes:[71,73,70]},{mimeType:"image/png",bytes:[137,80,78,71]},{mimeType:"image/jpeg",bytes:[255,216]},{mimeType:"image/webp",bytes:[82,73,70,70]}],aI="AI_InvalidDataContentError",aE=`vercel.ai.error.${aI}`,aA=Symbol.for(aE),aN=class extends eZ{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:aI,message:r,cause:t}),this[O]=!0,this.content=e}static isInstance(e){return eZ.hasMarker(e,aE)}};O=aA;var aP=sz.union([sz.string(),sz.instanceof(Uint8Array),sz.instanceof(ArrayBuffer),sz.custom(e=>{var t,r;return null!=(r=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&r},{message:"Must be a Buffer"})]);function aC(e){if(e instanceof Uint8Array)return e;if("string"==typeof e)try{return function(e){let t=tH(e.replace(/-/g,"+").replace(/_/g,"/"));return Uint8Array.from(t,e=>e.codePointAt(0))}(e)}catch(t){throw new aN({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new aN({content:e})}var aO="AI_InvalidMessageRoleError",a$=`vercel.ai.error.${aO}`,aj=Symbol.for(a$),aR=class extends eZ{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:aO,message:t}),this[$]=!0,this.role=e}static isInstance(e){return eZ.hasMarker(e,a$)}};async function aq({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:r=()=>!1,downloadImplementation:s=aT}){let n=await aD(e.messages,s,t,r);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>(function(e,t){var r,s,n,a,i,o;let l=e.role;switch(l){case"system":return{role:"system",content:e.content,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerMetadata:null!=(s=e.providerOptions)?s:e.experimental_providerMetadata};return{role:"user",content:e.content.map(e=>(function(e,t){var r,s;let n,a,i;if("text"===e.type)return{type:"text",text:e.text,providerMetadata:e.experimental_providerMetadata};let o=e.mimeType,l=e.type;switch(l){case"image":n=e.image;break;case"file":n=e.data;break;default:throw Error(`Unsupported part type: ${l}`)}try{a="string"==typeof n?new URL(n):n}catch(e){a=n}if(a instanceof URL){if("data:"===a.protocol){let{mimeType:e,base64Content:t}=function(e){try{let[t,r]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:r}}catch(e){return{mimeType:void 0,base64Content:void 0}}}(a.toString());if(null==e||null==t)throw Error(`Invalid data URL format in part ${l}`);o=e,i=aC(t)}else{let e=t[a.toString()];e?(i=e.data,null!=o||(o=e.mimeType)):i=a}}else i=aC(a);switch(l){case"image":return i instanceof Uint8Array&&(o=null!=(r=function(e){for(let{bytes:t,mimeType:r}of ak)if(e.length>=t.length&&t.every((t,r)=>e[r]===t))return r}(i))?r:o),{type:"image",image:i,mimeType:o,providerMetadata:e.experimental_providerMetadata};case"file":if(null==o)throw Error("Mime type is missing for file part");return{type:"file",data:i instanceof Uint8Array?"string"==typeof(s=i)?s:s instanceof ArrayBuffer?tG(new Uint8Array(s)):tG(s):i,mimeType:o,providerMetadata:e.experimental_providerMetadata}}})(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerMetadata:null!=(n=e.providerOptions)?n:e.experimental_providerMetadata};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:null!=(a=e.providerOptions)?a:e.experimental_providerMetadata};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text).map(e=>{let{experimental_providerMetadata:t,providerOptions:r,...s}=e;return{...s,providerMetadata:null!=r?r:t}}),providerMetadata:null!=(i=e.providerOptions)?i:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(e=>{var t;return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result,content:e.experimental_content,isError:e.isError,providerMetadata:null!=(t=e.providerOptions)?t:e.experimental_providerMetadata}}),providerMetadata:null!=(o=e.providerOptions)?o:e.experimental_providerMetadata};default:throw new aR({role:l})}})(e,n))]}async function aD(e,t,r,s){let n=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).filter(e=>!("image"===e.type&&!0===r)).map(e=>"image"===e.type?e.image:e.data).map(e=>"string"==typeof e&&(e.startsWith("http:")||e.startsWith("https:"))?new URL(e):e).filter(e=>e instanceof URL).filter(e=>!s(e));return Object.fromEntries((await Promise.all(n.map(async e=>({url:e,data:await t({url:e})})))).map(({url:e,data:t})=>[e.toString(),t]))}function aM({maxTokens:e,temperature:t,topP:r,topK:s,presencePenalty:n,frequencyPenalty:a,stopSequences:i,seed:o}){if(null!=e){if(!Number.isInteger(e))throw new ae({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new ae({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new ae({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=r&&"number"!=typeof r)throw new ae({parameter:"topP",value:r,message:"topP must be a number"});if(null!=s&&"number"!=typeof s)throw new ae({parameter:"topK",value:s,message:"topK must be a number"});if(null!=n&&"number"!=typeof n)throw new ae({parameter:"presencePenalty",value:n,message:"presencePenalty must be a number"});if(null!=a&&"number"!=typeof a)throw new ae({parameter:"frequencyPenalty",value:a,message:"frequencyPenalty must be a number"});if(null!=o&&!Number.isInteger(o))throw new ae({parameter:"seed",value:o,message:"seed must be an integer"});return{maxTokens:e,temperature:null!=t?t:0,topP:r,topK:s,presencePenalty:n,frequencyPenalty:a,stopSequences:null!=i&&i.length>0?i:void 0,seed:o}}$=aj;var aL="AI_MessageConversionError",aF=`vercel.ai.error.${aL}`,az=Symbol.for(aF),aB=class extends eZ{constructor({originalMessage:e,message:t}){super({name:aL,message:t}),this[j]=!0,this.originalMessage=e}static isInstance(e){return eZ.hasMarker(e,aF)}};function aZ(e,t){var r,s;let n=null!=(r=null==t?void 0:t.tools)?r:{},a=[];for(let t=0;t<e.length;t++){let r=e[t],i=t===e.length-1,{role:o,content:l,experimental_attachments:u}=r;switch(o){case"system":a.push({role:"system",content:l});break;case"user":a.push({role:"user",content:u?[{type:"text",text:l},...function(e){var t,r,s;let n=[];for(let a of e){let e;try{e=new URL(a.url)}catch(e){throw Error(`Invalid URL: ${a.url}`)}switch(e.protocol){case"http:":case"https:":if(null==(t=a.contentType)?void 0:t.startsWith("image/"))n.push({type:"image",image:e});else{if(!a.contentType)throw Error("If the attachment is not an image, it must specify a content type");n.push({type:"file",data:e,mimeType:a.contentType})}break;case"data:":{let e,t,i;try{[e,t]=a.url.split(","),i=e.split(";")[0].split(":")[1]}catch(e){throw Error(`Error processing data URL: ${a.url}`)}if(null==i||null==t)throw Error(`Invalid data URL format: ${a.url}`);if(null==(r=a.contentType)?void 0:r.startsWith("image/"))n.push({type:"image",image:aC(t)});else if(null==(s=a.contentType)?void 0:s.startsWith("text/"))n.push({type:"text",text:function(e){try{return new TextDecoder().decode(e)}catch(e){throw Error("Error decoding Uint8Array to text")}}(aC(t))});else{if(!a.contentType)throw Error("If the attachment is not an image or text, it must specify a content type");n.push({type:"file",data:t,mimeType:a.contentType})}break}default:throw Error(`Unsupported URL protocol: ${e.protocol}`)}}return n}(u)]:l});break;case"assistant":{if(null!=r.parts){let e=function(){a.push({role:"assistant",content:o.map(e=>"text"===e.type?{type:"text",text:e.text}:{type:"tool-call",toolCallId:e.toolInvocation.toolCallId,toolName:e.toolInvocation.toolName,args:e.toolInvocation.args})});let e=o.filter(e=>"tool-invocation"===e.type).map(e=>e.toolInvocation);e.length>0&&a.push({role:"tool",content:e.map(e=>{if(!("result"in e))throw new aB({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});let{toolCallId:t,toolName:s,result:a}=e,i=n[s];return(null==i?void 0:i.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:t,toolName:s,result:i.experimental_toToolResultContent(a),experimental_content:i.experimental_toToolResultContent(a)}:{type:"tool-result",toolCallId:t,toolName:s,result:a}})}),o=[],i=!1,t++},t=0,i=!1,o=[];for(let n of r.parts)switch(n.type){case"reasoning":break;case"text":i&&e(),o.push(n);break;case"tool-invocation":(null!=(s=n.toolInvocation.step)?s:0)!==t&&e(),o.push(n),i=!0}e();break}let e=r.toolInvocations;if(null==e||0===e.length){a.push({role:"assistant",content:l});break}let t=e.reduce((e,t)=>{var r;return Math.max(e,null!=(r=t.step)?r:0)},0);for(let s=0;s<=t;s++){let t=e.filter(e=>{var t;return(null!=(t=e.step)?t:0)===s});0!==t.length&&(a.push({role:"assistant",content:[...i&&l&&0===s?[{type:"text",text:l}]:[],...t.map(({toolCallId:e,toolName:t,args:r})=>({type:"tool-call",toolCallId:e,toolName:t,args:r}))]}),a.push({role:"tool",content:t.map(e=>{if(!("result"in e))throw new aB({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});let{toolCallId:t,toolName:s,result:a}=e,i=n[s];return(null==i?void 0:i.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:t,toolName:s,result:i.experimental_toToolResultContent(a),experimental_content:i.experimental_toToolResultContent(a)}:{type:"tool-result",toolCallId:t,toolName:s,result:a}})}))}l&&!i&&a.push({role:"assistant",content:l});break}case"data":break;default:throw new aB({originalMessage:r,message:`Unsupported role: ${o}`})}}return a}function aU(e){return"object"==typeof e&&null!==e&&("function"===e.role||"data"===e.role||"toolInvocations"in e||"experimental_attachments"in e)?"has-ui-specific-parts":"object"==typeof e&&null!==e&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":"object"==typeof e&&null!==e&&"role"in e&&"content"in e&&"string"==typeof e.content&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}j=az;var aJ=sz.lazy(()=>sz.union([sz.null(),sz.string(),sz.number(),sz.boolean(),sz.record(sz.string(),aJ),sz.array(aJ)])),aV=sz.record(sz.string(),sz.record(sz.string(),aJ)),aK=sz.array(sz.union([sz.object({type:sz.literal("text"),text:sz.string()}),sz.object({type:sz.literal("image"),data:sz.string(),mimeType:sz.string().optional()})])),aQ=sz.object({type:sz.literal("text"),text:sz.string(),providerOptions:aV.optional(),experimental_providerMetadata:aV.optional()}),aW=sz.object({type:sz.literal("image"),image:sz.union([aP,sz.instanceof(URL)]),mimeType:sz.string().optional(),providerOptions:aV.optional(),experimental_providerMetadata:aV.optional()}),aH=sz.object({type:sz.literal("file"),data:sz.union([aP,sz.instanceof(URL)]),mimeType:sz.string(),providerOptions:aV.optional(),experimental_providerMetadata:aV.optional()}),aG=sz.object({type:sz.literal("tool-call"),toolCallId:sz.string(),toolName:sz.string(),args:sz.unknown(),providerOptions:aV.optional(),experimental_providerMetadata:aV.optional()}),aY=sz.object({type:sz.literal("tool-result"),toolCallId:sz.string(),toolName:sz.string(),result:sz.unknown(),content:aK.optional(),isError:sz.boolean().optional(),providerOptions:aV.optional(),experimental_providerMetadata:aV.optional()}),aX=sz.object({role:sz.literal("system"),content:sz.string(),providerOptions:aV.optional(),experimental_providerMetadata:aV.optional()}),a0=sz.object({role:sz.literal("user"),content:sz.union([sz.string(),sz.array(sz.union([aQ,aW,aH]))]),providerOptions:aV.optional(),experimental_providerMetadata:aV.optional()}),a1=sz.object({role:sz.literal("assistant"),content:sz.union([sz.string(),sz.array(sz.union([aQ,aG]))]),providerOptions:aV.optional(),experimental_providerMetadata:aV.optional()}),a2=sz.object({role:sz.literal("tool"),content:sz.array(aY),providerOptions:aV.optional(),experimental_providerMetadata:aV.optional()}),a4=sz.union([aX,a0,a1,a2]);function a9({prompt:e,tools:t}){if(null==e.prompt&&null==e.messages)throw new e3({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new e3({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new e3({prompt:e,message:"system must be a string"});if(null!=e.prompt){if("string"!=typeof e.prompt)throw new e3({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(null!=e.messages){let r=function(e){if(!Array.isArray(e))return"other";if(0===e.length)return"messages";let t=e.map(aU);return t.some(e=>"has-ui-specific-parts"===e)?"ui-messages":t.every(e=>"has-core-specific-parts"===e||"message"===e)?"messages":"other"}(e.messages);if("other"===r)throw new e3({prompt:e,message:"messages must be an array of CoreMessage or UIMessage"});let s="ui-messages"===r?aZ(e.messages,{tools:t}):e.messages,n=tz({value:s,schema:sz.array(a4)});if(!n.success)throw new e3({prompt:e,message:"messages must be an array of CoreMessage or UIMessage",cause:n.error});return{type:"messages",messages:s,system:e.system}}throw Error("unreachable")}function a5({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}function a3(e,t){return{promptTokens:e.promptTokens+t.promptTokens,completionTokens:e.completionTokens+t.completionTokens,totalTokens:e.totalTokens+t.totalTokens}}function a6(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=()=>{let e=t.getReader();return{async next(){let{done:t,value:r}=await e.read();return t?{done:!0,value:void 0}:{done:!1,value:r}}}},t}tD({prefix:"aiobj",size:24});var a8=class{constructor(){this.status={type:"pending"},this._resolve=void 0,this._reject=void 0}get value(){return this.promise||(this.promise=new Promise((e,t)=>{"resolved"===this.status.type?e(this.status.value):"rejected"===this.status.type&&t(this.status.error),this._resolve=e,this._reject=t})),this.promise}resolve(e){var t;this.status={type:"resolved",value:e},this.promise&&(null==(t=this._resolve)||t.call(this,e))}reject(e){var t;this.status={type:"rejected",error:e},this.promise&&(null==(t=this._reject)||t.call(this,e))}};function a7(){let e,t;return{promise:new Promise((r,s)=>{e=r,t=s}),resolve:e,reject:t}}tD({prefix:"aiobj",size:24});var ie="AI_NoOutputSpecifiedError",it=`vercel.ai.error.${ie}`,ir=Symbol.for(it),is=class extends eZ{constructor({message:e="No output specified."}={}){super({name:ie,message:e}),this[R]=!0}static isInstance(e){return eZ.hasMarker(e,it)}};R=ir;var ia="AI_ToolExecutionError",ii=`vercel.ai.error.${ia}`,io=Symbol.for(ii),il=class extends eZ{constructor({toolArgs:e,toolName:t,toolCallId:r,cause:s,message:n=`Error executing tool ${t}: ${eY(s)}`}){super({name:ia,message:n,cause:s}),this[q]=!0,this.toolArgs=e,this.toolName=t,this.toolCallId=r}static isInstance(e){return eZ.hasMarker(e,ii)}};function iu({tools:e,toolChoice:t,activeTools:r}){return null!=e&&Object.keys(e).length>0?{tools:(null!=r?Object.entries(e).filter(([e])=>r.includes(e)):Object.entries(e)).map(([e,t])=>{let r=t.type;switch(r){case void 0:case"function":return{type:"function",name:e,description:t.description,parameters:n1(t.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw Error(`Unsupported tool type: ${r}`)}}),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}q=io;var ic=/^([\s\S]*?)(\s+)(\S*)$/;function id(e){let t=e.match(ic);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}var ip="AI_InvalidToolArgumentsError",ih=`vercel.ai.error.${ip}`,im=Symbol.for(ih),ig=class extends eZ{constructor({toolArgs:e,toolName:t,cause:r,message:s=`Invalid arguments for tool ${t}: ${eY(r)}`}){super({name:ip,message:s,cause:r}),this[D]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return eZ.hasMarker(e,ih)}};D=im;var iy="AI_NoSuchToolError",iv=`vercel.ai.error.${iy}`,ib=Symbol.for(iv),iw=class extends eZ{constructor({toolName:e,availableTools:t,message:r=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:iy,message:r}),this[M]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return eZ.hasMarker(e,iv)}};M=ib;var i_="AI_ToolCallRepairError",iS=`vercel.ai.error.${i_}`,ix=Symbol.for(iS),iT=class extends eZ{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${eY(e)}`}){super({name:i_,message:r,cause:e}),this[L]=!0,this.originalError=t}static isInstance(e){return eZ.hasMarker(e,iS)}};async function ik({toolCall:e,tools:t,repairToolCall:r,system:s,messages:n}){if(null==t)throw new iw({toolName:e.toolName});try{return await iI({toolCall:e,tools:t})}catch(i){if(null==r||!(iw.isInstance(i)||ig.isInstance(i)))throw i;let a=null;try{a=await r({toolCall:e,tools:t,parameterSchema:({toolName:e})=>n1(t[e].parameters).jsonSchema,system:s,messages:n,error:i})}catch(e){throw new iT({cause:e,originalError:i})}if(null==a)throw i;return await iI({toolCall:a,tools:t})}}async function iI({toolCall:e,tools:t}){let r=e.toolName,s=t[r];if(null==s)throw new iw({toolName:e.toolName,availableTools:Object.keys(t)});let n=n1(s.parameters),a=""===e.args.trim()?tz({value:{},schema:n}):tB({text:e.args,schema:n});if(!1===a.success)throw new ig({toolName:r,toolArgs:e.args,cause:a.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:r,args:a.value}}function iE({text:e="",tools:t,toolCalls:r,toolResults:s,messageId:n,generateMessageId:a}){let i=[];return i.push({role:"assistant",content:[{type:"text",text:e},...r],id:n}),s.length>0&&i.push({role:"tool",id:a(),content:s.map(e=>{let r=t[e.toolName];return(null==r?void 0:r.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:r.experimental_toToolResultContent(e.result),experimental_content:r.experimental_toToolResultContent(e.result)}:{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result}})}),i}L=ix;var iA=tD({prefix:"aitxt",size:24}),iN=tD({prefix:"msg",size:24});async function iP({model:e,tools:t,toolChoice:r,system:s,prompt:n,messages:a,maxRetries:i,abortSignal:o,headers:l,maxSteps:u=1,experimental_generateMessageId:c=iN,experimental_output:d,experimental_continueSteps:p=!1,experimental_telemetry:h,experimental_providerMetadata:m,providerOptions:f=m,experimental_activeTools:g,experimental_repairToolCall:y,_internal:{generateId:v=iA,currentDate:b=()=>new Date}={},onStepFinish:w,..._}){var S;if(u<1)throw new ae({parameter:"maxSteps",value:u,message:"maxSteps must be at least 1"});let{maxRetries:x,retry:T}=ao({maxRetries:i}),k=au({model:e,telemetry:h,headers:l,settings:{..._,maxRetries:x}}),I=a9({prompt:{system:null!=(S=null==d?void 0:d.injectIntoSystemPrompt({system:s,model:e}))?S:s,prompt:n,messages:a},tools:t}),E=ah(h);return am({name:"ai.generateText",attributes:af({telemetry:h,attributes:{...al({operationId:"ai.generateText",telemetry:h}),...k,"ai.prompt":{input:()=>JSON.stringify({system:s,prompt:n,messages:a})},"ai.settings.maxSteps":u}}),tracer:E,fn:async n=>{var a,i,m,S,x,A,N,P,C;let O;let $={type:"regular",...iu({tools:t,toolChoice:r,activeTools:g})},j=aM(_),R=[],q=[],D=0,M=[],L="",F=[],z=[],B={completionTokens:0,promptTokens:0,totalTokens:0},Z="initial";do{let r=0===D?I.type:"messages",n=[...I.messages,...M],g=await aq({prompt:{type:r,system:I.system,messages:n},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:null==(a=e.supportsUrl)?void 0:a.bind(e)});O=await T(()=>am({name:"ai.generateText.doGenerate",attributes:af({telemetry:h,attributes:{...al({operationId:"ai.generateText.doGenerate",telemetry:h}),...k,"ai.prompt.format":{input:()=>r},"ai.prompt.messages":{input:()=>JSON.stringify(g)},"ai.prompt.tools":{input:()=>{var e;return null==(e=$.tools)?void 0:e.map(e=>JSON.stringify(e))}},"ai.prompt.toolChoice":{input:()=>null!=$.toolChoice?JSON.stringify($.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":_.frequencyPenalty,"gen_ai.request.max_tokens":_.maxTokens,"gen_ai.request.presence_penalty":_.presencePenalty,"gen_ai.request.stop_sequences":_.stopSequences,"gen_ai.request.temperature":_.temperature,"gen_ai.request.top_k":_.topK,"gen_ai.request.top_p":_.topP}}),tracer:E,fn:async t=>{var s,n,a,i,u,c;let p=await e.doGenerate({mode:$,...j,inputFormat:r,responseFormat:null==d?void 0:d.responseFormat({model:e}),prompt:g,providerMetadata:f,abortSignal:o,headers:l}),m={id:null!=(n=null==(s=p.response)?void 0:s.id)?n:v(),timestamp:null!=(i=null==(a=p.response)?void 0:a.timestamp)?i:b(),modelId:null!=(c=null==(u=p.response)?void 0:u.modelId)?c:e.modelId};return t.setAttributes(af({telemetry:h,attributes:{"ai.response.finishReason":p.finishReason,"ai.response.text":{output:()=>p.text},"ai.response.toolCalls":{output:()=>JSON.stringify(p.toolCalls)},"ai.response.id":m.id,"ai.response.model":m.modelId,"ai.response.timestamp":m.timestamp.toISOString(),"ai.usage.promptTokens":p.usage.promptTokens,"ai.usage.completionTokens":p.usage.completionTokens,"gen_ai.response.finish_reasons":[p.finishReason],"gen_ai.response.id":m.id,"gen_ai.response.model":m.modelId,"gen_ai.usage.input_tokens":p.usage.promptTokens,"gen_ai.usage.output_tokens":p.usage.completionTokens}})),{...p,response:m}}})),R=await Promise.all((null!=(i=O.toolCalls)?i:[]).map(e=>ik({toolCall:e,tools:t,repairToolCall:y,system:s,messages:n}))),q=null==t?[]:await iC({toolCalls:R,tools:t,tracer:E,telemetry:h,messages:n,abortSignal:o});let P=a5(O.usage);B=a3(B,P);let C="done";++D<u&&(p&&"length"===O.finishReason&&0===R.length?C="continue":R.length>0&&q.length===R.length&&(C="tool-result"));let U=null!=(m=O.text)?m:"",J="continue"===Z&&L.trimEnd()!==L?U.trimStart():U,V="continue"===C?function(e){let t=id(e);return t?t.prefix+t.whitespace:e}(J):J;if(L="continue"===C||"continue"===Z?L+V:V,F.push(...null!=(S=O.sources)?S:[]),"continue"===Z){let e=M[M.length-1];"string"==typeof e.content?e.content+=V:e.content.push({text:V,type:"text"})}else M.push(...iE({text:L,tools:null!=t?t:{},toolCalls:R,toolResults:q,messageId:c(),generateMessageId:c}));let K={stepType:Z,text:V,reasoning:O.reasoning,sources:null!=(x=O.sources)?x:[],toolCalls:R,toolResults:q,finishReason:O.finishReason,usage:P,warnings:O.warnings,logprobs:O.logprobs,request:null!=(A=O.request)?A:{},response:{...O.response,headers:null==(N=O.rawResponse)?void 0:N.headers,messages:structuredClone(M)},providerMetadata:O.providerMetadata,experimental_providerMetadata:O.providerMetadata,isContinued:"continue"===C};z.push(K),await (null==w?void 0:w(K)),Z=C}while("done"!==Z);return n.setAttributes(af({telemetry:h,attributes:{"ai.response.finishReason":O.finishReason,"ai.response.text":{output:()=>O.text},"ai.response.toolCalls":{output:()=>JSON.stringify(O.toolCalls)},"ai.usage.promptTokens":O.usage.promptTokens,"ai.usage.completionTokens":O.usage.completionTokens}})),new iO({text:L,reasoning:O.reasoning,sources:F,outputResolver:()=>{if(null==d)throw new is;return d.parseOutput({text:L},{response:O.response,usage:B})},toolCalls:R,toolResults:q,finishReason:O.finishReason,usage:B,warnings:O.warnings,request:null!=(P=O.request)?P:{},response:{...O.response,headers:null==(C=O.rawResponse)?void 0:C.headers,messages:M},logprobs:O.logprobs,steps:z,providerMetadata:O.providerMetadata})}})}async function iC({toolCalls:e,tools:t,tracer:r,telemetry:s,messages:n,abortSignal:a}){return(await Promise.all(e.map(async({toolCallId:e,toolName:i,args:o})=>{let l=t[i];if((null==l?void 0:l.execute)==null)return;let u=await am({name:"ai.toolCall",attributes:af({telemetry:s,attributes:{...al({operationId:"ai.toolCall",telemetry:s}),"ai.toolCall.name":i,"ai.toolCall.id":e,"ai.toolCall.args":{output:()=>JSON.stringify(o)}}}),tracer:r,fn:async t=>{try{let r=await l.execute(o,{toolCallId:e,messages:n,abortSignal:a});try{t.setAttributes(af({telemetry:s,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(r)}}}))}catch(e){}return r}catch(t){throw new il({toolCallId:e,toolName:i,toolArgs:o,cause:t})}}});return{type:"tool-result",toolCallId:e,toolName:i,args:o,result:u}}))).filter(e=>null!=e)}var iO=class{constructor(e){this.text=e.text,this.reasoning=e.reasoning,this.toolCalls=e.toolCalls,this.toolResults=e.toolResults,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.request=e.request,this.response=e.response,this.steps=e.steps,this.experimental_providerMetadata=e.providerMetadata,this.providerMetadata=e.providerMetadata,this.logprobs=e.logprobs,this.outputResolver=e.outputResolver,this.sources=e.sources}get experimental_output(){return this.outputResolver()}};n4({},{object:()=>ij,text:()=>i$});var i$=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt:({system:e})=>e,parsePartial:({text:e})=>({partial:e}),parseOutput:({text:e})=>e}),ij=({schema:e})=>{let t=n1(e);return{type:"object",responseFormat:({model:e})=>({type:"json",schema:e.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt:({system:e,model:r})=>r.supportsStructuredOutputs?e:function({prompt:e,schema:t,schemaPrefix:r=null!=t?"JSON schema:":void 0,schemaSuffix:s=null!=t?"You MUST answer with a JSON object that matches the JSON schema above.":"You MUST answer with JSON."}){return[null!=e&&e.length>0?e:void 0,null!=e&&e.length>0?"":void 0,r,null!=t?JSON.stringify(t):void 0,s].filter(e=>null!=e).join("\n")}({prompt:e,schema:t.jsonSchema}),parsePartial({text:e}){let t=function(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=tB({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=tB({text:function(e){let t=["ROOT"],r=-1,s=null;function n(e,n,a){switch(e){case'"':r=n,t.pop(),t.push(a),t.push("INSIDE_STRING");break;case"f":case"t":case"n":r=n,s=n,t.pop(),t.push(a),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(a),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=n,t.pop(),t.push(a),t.push("INSIDE_NUMBER");break;case"{":r=n,t.pop(),t.push(a),t.push("INSIDE_OBJECT_START");break;case"[":r=n,t.pop(),t.push(a),t.push("INSIDE_ARRAY_START")}}function a(e,s){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=s,t.pop()}}function i(e,s){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=s,t.pop()}}for(let o=0;o<e.length;o++){let l=e[o];switch(t[t.length-1]){case"ROOT":n(l,o,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":r=o,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":n(l,o,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":a(l,o);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),r=o;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:r=o}break;case"INSIDE_ARRAY_START":"]"===l?(r=o,t.pop()):(r=o,n(l,o,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=o,t.pop();break;default:r=o}break;case"INSIDE_ARRAY_AFTER_COMMA":n(l,o,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),r=o;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=o;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,o),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&a(l,o);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&a(l,o);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,o);break;default:t.pop()}break;case"INSIDE_LITERAL":{let n=e.substring(s,o+1);"false".startsWith(n)||"true".startsWith(n)||"null".startsWith(n)?r=o:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?a(l,o):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,o))}}}let o=e.slice(0,r+1);for(let r=t.length-1;r>=0;r--)switch(t[r]){case"INSIDE_STRING":o+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":o+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":o+="]";break;case"INSIDE_LITERAL":{let t=e.substring(s,e.length);"true".startsWith(t)?o+="true".slice(t.length):"false".startsWith(t)?o+="false".slice(t.length):"null".startsWith(t)&&(o+="null".slice(t.length))}}return o}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},parseOutput({text:e},r){let s=tB({text:e});if(!s.success)throw new ab({message:"No object generated: could not parse the response.",cause:s.error,text:e,response:r.response,usage:r.usage});let n=tz({value:s.value,schema:t});if(!n.success)throw new ab({message:"No object generated: response did not match schema.",cause:n.error,text:e,response:r.response,usage:r.usage});return n.value}}};function iR(e,t){let r,s;let n=e.getReader(),a=t.getReader(),i=!1,o=!1;async function l(e){try{null==r&&(r=n.read());let t=await r;r=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}async function u(e){try{null==s&&(s=a.read());let t=await s;s=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}return new ReadableStream({async pull(e){try{if(i){await u(e);return}if(o){await l(e);return}null==r&&(r=n.read()),null==s&&(s=a.read());let{result:t,reader:c}=await Promise.race([r.then(e=>({result:e,reader:n})),s.then(e=>({result:e,reader:a}))]);t.done||e.enqueue(t.value),c===n?(r=void 0,t.done&&(await u(e),i=!0)):(s=void 0,t.done&&(o=!0,await l(e)))}catch(t){e.error(t)}},cancel(){n.cancel(),a.cancel()}})}var iq=tD({prefix:"aitxt",size:24}),iD=tD({prefix:"msg",size:24}),iM=class{constructor({model:e,telemetry:t,headers:r,settings:s,maxRetries:n,abortSignal:a,system:i,prompt:o,messages:l,tools:u,toolChoice:c,toolCallStreaming:d,transforms:p,activeTools:h,repairToolCall:m,maxSteps:f,output:g,continueSteps:y,providerOptions:v,now:b,currentDate:w,generateId:_,generateMessageId:S,onChunk:x,onError:T,onFinish:k,onStepFinish:I}){var E;let A,N,P,C;if(this.warningsPromise=new a8,this.usagePromise=new a8,this.finishReasonPromise=new a8,this.providerMetadataPromise=new a8,this.textPromise=new a8,this.reasoningPromise=new a8,this.sourcesPromise=new a8,this.toolCallsPromise=new a8,this.toolResultsPromise=new a8,this.requestPromise=new a8,this.responsePromise=new a8,this.stepsPromise=new a8,f<1)throw new ae({parameter:"maxSteps",value:f,message:"maxSteps must be at least 1"});this.output=g;let O="",$="",j="",R=[],q=[],D={id:_(),timestamp:w(),modelId:e.modelId,messages:[]},M=[],L=[],F="initial",z=[],B=new TransformStream({async transform(e,t){t.enqueue(e);let{part:r}=e;if(("text-delta"===r.type||"reasoning"===r.type||"source"===r.type||"tool-call"===r.type||"tool-result"===r.type||"tool-call-streaming-start"===r.type||"tool-call-delta"===r.type)&&await (null==x?void 0:x({chunk:r})),"error"===r.type&&await (null==T?void 0:T({error:r.error})),"text-delta"===r.type&&(O+=r.textDelta,$+=r.textDelta,j+=r.textDelta),"reasoning"===r.type&&(N=(null!=N?N:"")+r.textDelta),"source"===r.type&&(q.push(r.source),R.push(r.source)),"tool-call"===r.type&&M.push(r),"tool-result"===r.type&&L.push(r),"step-finish"===r.type){let e=iE({text:$,tools:null!=u?u:{},toolCalls:M,toolResults:L,messageId:r.messageId,generateMessageId:S}),t=z.length,s="done";t+1<f&&(y&&"length"===r.finishReason&&0===M.length?s="continue":M.length>0&&L.length===M.length&&(s="tool-result"));let n={stepType:F,text:O,reasoning:N,sources:R,toolCalls:M,toolResults:L,finishReason:r.finishReason,usage:r.usage,warnings:r.warnings,logprobs:r.logprobs,request:r.request,response:{...r.response,messages:[...D.messages,...e]},providerMetadata:r.experimental_providerMetadata,experimental_providerMetadata:r.experimental_providerMetadata,isContinued:r.isContinued};await (null==I?void 0:I(n)),z.push(n),M=[],L=[],O="",R=[],"done"!==s&&(F=s),"continue"!==s&&(D.messages.push(...e),$="")}"finish"===r.type&&(D.id=r.response.id,D.timestamp=r.response.timestamp,D.modelId=r.response.modelId,D.headers=r.response.headers,C=r.usage,P=r.finishReason)},async flush(e){var r;try{if(0===z.length)return;let e=z[z.length-1];H.warningsPromise.resolve(e.warnings),H.requestPromise.resolve(e.request),H.responsePromise.resolve(e.response),H.toolCallsPromise.resolve(e.toolCalls),H.toolResultsPromise.resolve(e.toolResults),H.providerMetadataPromise.resolve(e.experimental_providerMetadata);let s=null!=P?P:"unknown",n=null!=C?C:{completionTokens:NaN,promptTokens:NaN,totalTokens:NaN};H.finishReasonPromise.resolve(s),H.usagePromise.resolve(n),H.textPromise.resolve(j),H.reasoningPromise.resolve(N),H.sourcesPromise.resolve(q),H.stepsPromise.resolve(z),await (null==k?void 0:k({finishReason:s,logprobs:void 0,usage:n,text:j,reasoning:e.reasoning,sources:e.sources,toolCalls:e.toolCalls,toolResults:e.toolResults,request:null!=(r=e.request)?r:{},response:e.response,warnings:e.warnings,providerMetadata:e.providerMetadata,experimental_providerMetadata:e.experimental_providerMetadata,steps:z})),A.setAttributes(af({telemetry:t,attributes:{"ai.response.finishReason":s,"ai.response.text":{output:()=>j},"ai.response.toolCalls":{output:()=>{var t;return(null==(t=e.toolCalls)?void 0:t.length)?JSON.stringify(e.toolCalls):void 0}},"ai.usage.promptTokens":n.promptTokens,"ai.usage.completionTokens":n.completionTokens}}))}catch(t){e.error(t)}finally{A.end()}}}),Z=function(){let e=[],t=null,r=!1,s=a7(),n=async()=>{if(r&&0===e.length){null==t||t.close();return}if(0===e.length)return s=a7(),await s.promise,n();try{let{value:s,done:a}=await e[0].read();a?(e.shift(),e.length>0?await n():r&&(null==t||t.close())):null==t||t.enqueue(s)}catch(s){null==t||t.error(s),e.shift(),r&&0===e.length&&(null==t||t.close())}};return{stream:new ReadableStream({start(e){t=e},pull:n,async cancel(){for(let t of e)await t.cancel();e=[],r=!0}}),addStream:t=>{if(r)throw Error("Cannot add inner stream: outer stream is closed");e.push(t.getReader()),s.resolve()},close:()=>{r=!0,s.resolve(),0===e.length&&(null==t||t.close())},terminate:()=>{r=!0,s.resolve(),e.forEach(e=>e.cancel()),e=[],null==t||t.close()}}}();this.addStream=Z.addStream,this.closeStream=Z.close;let U=Z.stream;for(let e of p)U=U.pipeThrough(e({tools:u,stopStream(){Z.terminate()}}));this.baseStream=U.pipeThrough(function(e){if(!e)return new TransformStream({transform(e,t){t.enqueue({part:e,partialOutput:void 0})}});let t="",r="",s="";function n({controller:e,partialOutput:t}){e.enqueue({part:{type:"text-delta",textDelta:r},partialOutput:t}),r=""}return new TransformStream({transform(a,i){if("step-finish"===a.type&&n({controller:i}),"text-delta"!==a.type){i.enqueue({part:a,partialOutput:void 0});return}t+=a.textDelta,r+=a.textDelta;let o=e.parsePartial({text:t});if(null!=o){let e=JSON.stringify(o.partial);e!==s&&(n({controller:i,partialOutput:o.partial}),s=e)}},flush(e){r.length>0&&n({controller:e})}})}(g)).pipeThrough(B);let{maxRetries:J,retry:V}=ao({maxRetries:n}),K=ah(t),Q=au({model:e,telemetry:t,headers:r,settings:{...s,maxRetries:J}}),W=a9({prompt:{system:null!=(E=null==g?void 0:g.injectIntoSystemPrompt({system:i,model:e}))?E:i,prompt:o,messages:l},tools:u}),H=this;am({name:"ai.streamText",attributes:af({telemetry:t,attributes:{...al({operationId:"ai.streamText",telemetry:t}),...Q,"ai.prompt":{input:()=>JSON.stringify({system:i,prompt:o,messages:l})},"ai.settings.maxSteps":f}}),tracer:K,endWhenDone:!1,fn:async n=>{async function o({currentStep:n,responseMessages:l,usage:p,stepType:x,previousStepText:T,hasLeadingWhitespace:k,messageId:I}){var E;let A,N;let P=0===l.length?W.type:"messages",C=[...W.messages,...l],O=await aq({prompt:{type:P,system:W.system,messages:C},modelSupportsImageUrls:e.supportsImageUrls,modelSupportsUrl:null==(E=e.supportsUrl)?void 0:E.bind(e)}),$={type:"regular",...iu({tools:u,toolChoice:c,activeTools:h})},{result:{stream:j,warnings:R,rawResponse:q,request:D},doStreamSpan:M,startTimestampMs:L}=await V(()=>am({name:"ai.streamText.doStream",attributes:af({telemetry:t,attributes:{...al({operationId:"ai.streamText.doStream",telemetry:t}),...Q,"ai.prompt.format":{input:()=>P},"ai.prompt.messages":{input:()=>JSON.stringify(O)},"ai.prompt.tools":{input:()=>{var e;return null==(e=$.tools)?void 0:e.map(e=>JSON.stringify(e))}},"ai.prompt.toolChoice":{input:()=>null!=$.toolChoice?JSON.stringify($.toolChoice):void 0},"gen_ai.system":e.provider,"gen_ai.request.model":e.modelId,"gen_ai.request.frequency_penalty":s.frequencyPenalty,"gen_ai.request.max_tokens":s.maxTokens,"gen_ai.request.presence_penalty":s.presencePenalty,"gen_ai.request.stop_sequences":s.stopSequences,"gen_ai.request.temperature":s.temperature,"gen_ai.request.top_k":s.topK,"gen_ai.request.top_p":s.topP}}),tracer:K,endWhenDone:!1,fn:async t=>({startTimestampMs:b(),doStreamSpan:t,result:await e.doStream({mode:$,...aM(s),inputFormat:P,responseFormat:null==g?void 0:g.responseFormat({model:e}),prompt:O,providerMetadata:v,abortSignal:a,headers:r})})})),F=function({tools:e,generatorStream:t,toolCallStreaming:r,tracer:s,telemetry:n,system:a,messages:i,abortSignal:o,repairToolCall:l}){let u,c=null,d=new ReadableStream({start(e){c=e}}),p={},h=new Set,m=!1;function f(){m&&0===h.size&&(null!=u&&c.enqueue(u),c.close())}let g=new TransformStream({async transform(t,d){let m=t.type;switch(m){case"text-delta":case"reasoning":case"source":case"response-metadata":case"error":d.enqueue(t);break;case"tool-call-delta":r&&(p[t.toolCallId]||(d.enqueue({type:"tool-call-streaming-start",toolCallId:t.toolCallId,toolName:t.toolName}),p[t.toolCallId]=!0),d.enqueue({type:"tool-call-delta",toolCallId:t.toolCallId,toolName:t.toolName,argsTextDelta:t.argsTextDelta}));break;case"tool-call":try{let r=await ik({toolCall:t,tools:e,repairToolCall:l,system:a,messages:i});d.enqueue(r);let u=e[r.toolName];if(null!=u.execute){let e=tM();h.add(e),am({name:"ai.toolCall",attributes:af({telemetry:n,attributes:{...al({operationId:"ai.toolCall",telemetry:n}),"ai.toolCall.name":r.toolName,"ai.toolCall.id":r.toolCallId,"ai.toolCall.args":{output:()=>JSON.stringify(r.args)}}}),tracer:s,fn:async t=>u.execute(r.args,{toolCallId:r.toolCallId,messages:i,abortSignal:o}).then(s=>{c.enqueue({...r,type:"tool-result",result:s}),h.delete(e),f();try{t.setAttributes(af({telemetry:n,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(s)}}}))}catch(e){}},t=>{c.enqueue({type:"error",error:new il({toolCallId:r.toolCallId,toolName:r.toolName,toolArgs:r.args,cause:t})}),h.delete(e),f()})})}}catch(e){c.enqueue({type:"error",error:e})}break;case"finish":u={type:"finish",finishReason:t.finishReason,logprobs:t.logprobs,usage:a5(t.usage),experimental_providerMetadata:t.providerMetadata};break;default:throw Error(`Unhandled chunk type: ${m}`)}},flush(){m=!0,f()}});return new ReadableStream({start:async e=>Promise.all([t.pipeThrough(g).pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){}})),d.pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){e.close()}}))])})}({tools:u,generatorStream:j,toolCallStreaming:d,tracer:K,telemetry:t,system:i,messages:C,repairToolCall:m,abortSignal:a}),z=null!=D?D:{},B=[],Z=[],U="unknown",J={promptTokens:0,completionTokens:0,totalTokens:0},G=!0,Y="",X="",ee="continue"===x?T:"",et={id:_(),timestamp:w(),modelId:e.modelId},er="",es=!1,en=!0,ea=!1;async function ei({controller:e,chunk:t}){e.enqueue(t),Y+=t.textDelta,ee+=t.textDelta,es=!0,ea=t.textDelta.trimEnd()!==t.textDelta}H.addStream(F.pipeThrough(new TransformStream({async transform(e,t){var r,s,n;if(G){let e=b()-L;G=!1,M.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":e}),M.setAttributes({"ai.response.msToFirstChunk":e}),t.enqueue({type:"step-start",messageId:I,request:z,warnings:null!=R?R:[]})}if("text-delta"===e.type&&0===e.textDelta.length)return;let a=e.type;switch(a){case"text-delta":if(y){let r=en&&k?e.textDelta.trimStart():e.textDelta;if(0===r.length)break;en=!1;let s=id(er+=r);null!=s&&(er=s.suffix,await ei({controller:t,chunk:{type:"text-delta",textDelta:s.prefix+s.whitespace}}))}else await ei({controller:t,chunk:e});break;case"reasoning":t.enqueue(e),X+=e.textDelta;break;case"source":case"tool-call-streaming-start":case"tool-call-delta":t.enqueue(e);break;case"tool-call":t.enqueue(e),B.push(e);break;case"tool-result":t.enqueue(e),Z.push(e);break;case"response-metadata":et={id:null!=(r=e.id)?r:et.id,timestamp:null!=(s=e.timestamp)?s:et.timestamp,modelId:null!=(n=e.modelId)?n:et.modelId};break;case"finish":{J=e.usage,U=e.finishReason,A=e.experimental_providerMetadata,N=e.logprobs;let t=b()-L;M.addEvent("ai.stream.finish"),M.setAttributes({"ai.response.msToFinish":t,"ai.response.avgCompletionTokensPerSecond":1e3*J.completionTokens/t});break}case"error":t.enqueue(e),U="error";break;default:throw Error(`Unknown chunk type: ${a}`)}},async flush(e){let r=B.length>0?JSON.stringify(B):void 0,s="done";n+1<f&&(y&&"length"===U&&0===B.length?s="continue":B.length>0&&Z.length===B.length&&(s="tool-result")),y&&er.length>0&&("continue"!==s||"continue"===x&&!es)&&(await ei({controller:e,chunk:{type:"text-delta",textDelta:er}}),er="");try{M.setAttributes(af({telemetry:t,attributes:{"ai.response.finishReason":U,"ai.response.text":{output:()=>Y},"ai.response.toolCalls":{output:()=>r},"ai.response.id":et.id,"ai.response.model":et.modelId,"ai.response.timestamp":et.timestamp.toISOString(),"ai.usage.promptTokens":J.promptTokens,"ai.usage.completionTokens":J.completionTokens,"gen_ai.response.finish_reasons":[U],"gen_ai.response.id":et.id,"gen_ai.response.model":et.modelId,"gen_ai.usage.input_tokens":J.promptTokens,"gen_ai.usage.output_tokens":J.completionTokens}}))}catch(e){}finally{M.end()}e.enqueue({type:"step-finish",finishReason:U,usage:J,providerMetadata:A,experimental_providerMetadata:A,logprobs:N,request:z,response:{...et,headers:null==q?void 0:q.headers},warnings:R,isContinued:"continue"===s,messageId:I});let a=a3(p,J);if("done"===s)e.enqueue({type:"finish",finishReason:U,usage:a,providerMetadata:A,experimental_providerMetadata:A,logprobs:N,response:{...et,headers:null==q?void 0:q.headers}}),H.closeStream();else{if("continue"===x){let e=l[l.length-1];"string"==typeof e.content?e.content+=Y:e.content.push({text:Y,type:"text"})}else l.push(...iE({text:Y,tools:null!=u?u:{},toolCalls:B,toolResults:Z,messageId:I,generateMessageId:S}));await o({currentStep:n+1,responseMessages:l,usage:a,stepType:s,previousStepText:ee,hasLeadingWhitespace:ea,messageId:"continue"===s?I:S()})}}})))}A=n,await o({currentStep:0,responseMessages:[],usage:{promptTokens:0,completionTokens:0,totalTokens:0},previousStepText:"",stepType:"initial",hasLeadingWhitespace:!1,messageId:S()})}}).catch(e=>{H.addStream(new ReadableStream({start(t){t.enqueue({type:"error",error:e}),t.close()}})),H.closeStream()})}get warnings(){return this.warningsPromise.value}get usage(){return this.usagePromise.value}get finishReason(){return this.finishReasonPromise.value}get experimental_providerMetadata(){return this.providerMetadataPromise.value}get providerMetadata(){return this.providerMetadataPromise.value}get text(){return this.textPromise.value}get reasoning(){return this.reasoningPromise.value}get sources(){return this.sourcesPromise.value}get toolCalls(){return this.toolCallsPromise.value}get toolResults(){return this.toolResultsPromise.value}get request(){return this.requestPromise.value}get response(){return this.responsePromise.value}get steps(){return this.stepsPromise.value}teeStream(){let[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return a6(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){"text-delta"===e.type&&t.enqueue(e.textDelta)}})))}get fullStream(){return a6(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(){for await(let e of this.fullStream);}get experimental_partialOutputStream(){if(null==this.output)throw new is;return a6(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){null!=e&&t.enqueue(e)}})))}toDataStreamInternal({getErrorMessage:e=()=>"An error occurred.",sendUsage:t=!0,sendReasoning:r=!1,sendSources:s=!1}){return this.fullStream.pipeThrough(new TransformStream({transform:async(n,a)=>{let i=n.type;switch(i){case"text-delta":a.enqueue(nX("text",n.textDelta));break;case"reasoning":r&&a.enqueue(nX("reasoning",n.textDelta));break;case"source":s&&a.enqueue(nX("source",n.source));break;case"tool-call-streaming-start":a.enqueue(nX("tool_call_streaming_start",{toolCallId:n.toolCallId,toolName:n.toolName}));break;case"tool-call-delta":a.enqueue(nX("tool_call_delta",{toolCallId:n.toolCallId,argsTextDelta:n.argsTextDelta}));break;case"tool-call":a.enqueue(nX("tool_call",{toolCallId:n.toolCallId,toolName:n.toolName,args:n.args}));break;case"tool-result":a.enqueue(nX("tool_result",{toolCallId:n.toolCallId,result:n.result}));break;case"error":a.enqueue(nX("error",e(n.error)));break;case"step-start":a.enqueue(nX("start_step",{messageId:n.messageId}));break;case"step-finish":a.enqueue(nX("finish_step",{finishReason:n.finishReason,usage:t?{promptTokens:n.usage.promptTokens,completionTokens:n.usage.completionTokens}:void 0,isContinued:n.isContinued}));break;case"finish":a.enqueue(nX("finish_message",{finishReason:n.finishReason,usage:t?{promptTokens:n.usage.promptTokens,completionTokens:n.usage.completionTokens}:void 0}));break;default:throw Error(`Unknown chunk type: ${i}`)}}}))}pipeDataStreamToResponse(e,{status:t,statusText:r,headers:s,data:n,getErrorMessage:a,sendUsage:i,sendReasoning:o,sendSources:l}={}){n3({response:e,status:t,statusText:r,headers:n5(s,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"}),stream:this.toDataStream({data:n,getErrorMessage:a,sendUsage:i,sendReasoning:o,sendSources:l})})}pipeTextStreamToResponse(e,t){n3({response:e,status:null==t?void 0:t.status,statusText:null==t?void 0:t.statusText,headers:n5(null==t?void 0:t.headers,{contentType:"text/plain; charset=utf-8"}),stream:this.textStream.pipeThrough(new TextEncoderStream)})}toDataStream(e){let t=this.toDataStreamInternal({getErrorMessage:null==e?void 0:e.getErrorMessage,sendUsage:null==e?void 0:e.sendUsage,sendReasoning:null==e?void 0:e.sendReasoning,sendSources:null==e?void 0:e.sendSources}).pipeThrough(new TextEncoderStream);return(null==e?void 0:e.data)?iR(null==e?void 0:e.data.stream,t):t}mergeIntoDataStream(e,t){e.merge(this.toDataStreamInternal({getErrorMessage:e.onError,sendUsage:null==t?void 0:t.sendUsage,sendReasoning:null==t?void 0:t.sendReasoning,sendSources:null==t?void 0:t.sendSources}))}toDataStreamResponse({headers:e,status:t,statusText:r,data:s,getErrorMessage:n,sendUsage:a,sendReasoning:i,sendSources:o}={}){return new Response(this.toDataStream({data:s,getErrorMessage:n,sendUsage:a,sendReasoning:i,sendSources:o}),{status:t,statusText:r,headers:n9(e,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}toTextStreamResponse(e){var t;return new Response(this.textStream.pipeThrough(new TextEncoderStream),{status:null!=(t=null==e?void 0:e.status)?t:200,headers:n9(null==e?void 0:e.headers,{contentType:"text/plain; charset=utf-8"})})}},iL="AI_NoSuchProviderError",iF=`vercel.ai.error.${iL}`;function iz(e={}){let t=new TextEncoder,r="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(s,n){n.enqueue(t.encode(s)),r+=s,e.onToken&&await e.onToken(s),e.onText&&"string"==typeof s&&await e.onText(s)},async flush(){e.onCompletion&&await e.onCompletion(r),e.onFinal&&await e.onFinal(r)}})}function iB(e,t){return e.pipeThrough(new TransformStream({transform:async(e,t)=>{var r;if("string"==typeof e){t.enqueue(e);return}if("event"in e){"on_chat_model_stream"===e.event&&iV(null==(r=e.data)?void 0:r.chunk,t);return}iV(e,t)}})).pipeThrough(iz(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(nX("text",e))}}))}function iZ(e,t){return iB(e,t).pipeThrough(new TextEncoderStream)}function iU(e,t){var r;let s=iB(e,null==t?void 0:t.callbacks).pipeThrough(new TextEncoderStream),n=null==t?void 0:t.data,a=null==t?void 0:t.init;return new Response(n?iR(n.stream,s):s,{status:null!=(r=null==a?void 0:a.status)?r:200,statusText:null==a?void 0:a.statusText,headers:n9(null==a?void 0:a.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function iJ(e,t){t.dataStream.merge(iB(e,t.callbacks))}function iV(e,t){if("string"==typeof e.content)t.enqueue(e.content);else for(let r of e.content)"text"===r.type&&t.enqueue(r.text)}function iK(e,t){var r;let s;let n=(s=!0,e=>(s&&(e=e.trimStart())&&(s=!1),e));return(r=e[Symbol.asyncIterator](),new ReadableStream({async pull(e){try{let{value:t,done:s}=await r.next();s?e.close():e.enqueue(t)}catch(t){e.error(t)}},cancel(){}})).pipeThrough(new TransformStream({async transform(e,t){t.enqueue(n(e.delta))}})).pipeThrough(iz(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(nX("text",e))}}))}function iQ(e,t){return iK(e,t).pipeThrough(new TextEncoderStream)}function iW(e,t={}){var r;let{init:s,data:n,callbacks:a}=t,i=iK(e,a).pipeThrough(new TextEncoderStream);return new Response(n?iR(n.stream,i):i,{status:null!=(r=null==s?void 0:s.status)?r:200,statusText:null==s?void 0:s.statusText,headers:n9(null==s?void 0:s.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function iH(e,t){t.dataStream.merge(iK(e,t.callbacks))}F=Symbol.for(iF),n4({},{mergeIntoDataStream:()=>iJ,toDataStream:()=>iZ,toDataStreamResponse:()=>iU}),n4({},{mergeIntoDataStream:()=>iH,toDataStream:()=>iQ,toDataStreamResponse:()=>iW});var iG="[^/]+",iY="(?:|/.*)",iX=Symbol(),i0=new Set(".\\+*[^]$()");function i1(e,t){return 1===e.length?1===t.length?e<t?-1:1:-1:1===t.length?1:".*"===e||e===iY?1:".*"===t||t===iY?-1:e===iG?1:t===iG?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var i2=class{#$;#j;#E=Object.create(null);insert(e,t,r,s,n){let a;if(0===e.length){if(void 0!==this.#$)throw iX;if(n)return;this.#$=t;return}let[i,...o]=e,l="*"===i?0===o.length?["","",".*"]:["","",iG]:"/*"===i?["","",iY]:i.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(l){let e=l[1],t=l[2]||iG;if(e&&l[2]&&(t=t.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(t)))throw iX;if(!(a=this.#E[t])){if(Object.keys(this.#E).some(e=>".*"!==e&&e!==iY))throw iX;if(n)return;a=this.#E[t]=new i2,""!==e&&(a.#j=s.varIndex++)}n||""===e||r.push([e,a.#j])}else if(!(a=this.#E[i])){if(Object.keys(this.#E).some(e=>e.length>1&&".*"!==e&&e!==iY))throw iX;if(n)return;a=this.#E[i]=new i2}a.insert(o,t,r,s,n)}buildRegExpStr(){let e=Object.keys(this.#E).sort(i1).map(e=>{let t=this.#E[e];return("number"==typeof t.#j?`(${e})@${t.#j}`:i0.has(e)?`\\${e}`:e)+t.buildRegExpStr()});return("number"==typeof this.#$&&e.unshift(`#${this.#$}`),0===e.length)?"":1===e.length?e[0]:"(?:"+e.join("|")+")"}},i4=Object.create(null);let i9=require("node:buffer"),i5=new TextEncoder,i3=new TextDecoder,i6=e=>new Uint8Array(i9.Buffer.from(function(e){let t=e;return t instanceof Uint8Array&&(t=i3.decode(t)),t}(e),"base64url")),i8=require("node:crypto"),i7=e=>e.d?(0,i8.createPrivateKey)({format:"jwk",key:e}):(0,i8.createPublicKey)({format:"jwk",key:e});class oe extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class ot extends oe{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(e,t,r="unspecified",s="unspecified"){super(e,{cause:{claim:r,reason:s,payload:t}}),this.claim=r,this.reason=s,this.payload=t}}class or extends oe{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(e,t,r="unspecified",s="unspecified"){super(e,{cause:{claim:r,reason:s,payload:t}}),this.claim=r,this.reason=s,this.payload=t}}class os extends oe{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class on extends oe{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class oa extends oe{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class oi extends oe{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class oo extends oe{static code="ERR_JWKS_INVALID";code="ERR_JWKS_INVALID"}class ol extends oe{static code="ERR_JWKS_NO_MATCHING_KEY";code="ERR_JWKS_NO_MATCHING_KEY";constructor(e="no applicable key found in the JSON Web Key Set",t){super(e,t)}}class ou extends oe{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}class oc extends oe{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(e="signature verification failed",t){super(e,t)}}function od(e){if(!("object"==typeof e&&null!==e)||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}async function op(e,t){if(!od(e))throw TypeError("JWK must be an object");switch(t||=e.alg,e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return i6(e.k);case"RSA":if(void 0!==e.oth)throw new on('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return i7({...e,alg:t});default:throw new on('Unsupported "kty" (Key Type) Parameter value')}}function oh(e){return od(e)}function om(e){return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}class of{_jwks;_cached=new WeakMap;constructor(e){if(!function(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(oh)}(e))throw new oo("JSON Web Key Set malformed");this._jwks=om(e)}async getKey(e,t){let{alg:r,kid:s}={...e,...t?.header},n=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new on('Unsupported "alg" value for a JSON Web Key Set')}}(r),a=this._jwks.keys.filter(e=>{let t=n===e.kty;if(t&&"string"==typeof s&&(t=s===e.kid),t&&"string"==typeof e.alg&&(t=r===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t&&"EdDSA"===r&&(t="Ed25519"===e.crv||"Ed448"===e.crv),t)switch(r){case"ES256":t="P-256"===e.crv;break;case"ES256K":t="secp256k1"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv}return t}),{0:i,length:o}=a;if(0===o)throw new ol;if(1!==o){let e=new ou,{_cached:t}=this;throw e[Symbol.asyncIterator]=async function*(){for(let e of a)try{yield await og(t,e,r)}catch{}},e}return og(this._cached,i,r)}}async function og(e,t,r){let s=e.get(t)||e.set(t,{}).get(t);if(void 0===s[r]){let e=await op({...t,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new oo("JSON Web Key Set members must be public keys");s[r]=e}return s[r]}let oy=e=>i9.Buffer.from(e).toString("base64url"),ov=require("node:util");function ob(e){switch(e){case"PS256":case"RS256":case"ES256":case"ES256K":return"sha256";case"PS384":case"RS384":case"ES384":return"sha384";case"PS512":case"RS512":case"ES512":return"sha512";case"EdDSA":return;default:throw new on(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}let ow=i8.webcrypto,o_=e=>ov.types.isCryptoKey(e),oS=e=>ov.types.isKeyObject(e);function ox(e,t,...r){if((r=r.filter(Boolean)).length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let oT=(e,...t)=>ox("Key must be ",e,...t);function ok(e,t,...r){return ox(`Key for the ${e} algorithm must be `,t,...r)}let oI=e=>oS(e)||o_(e),oE=["KeyObject"];function oA(e){return od(e)&&"string"==typeof e.kty}(globalThis.CryptoKey||ow?.CryptoKey)&&oE.push("CryptoKey"),new WeakMap;let oN=e=>{switch(e){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new on("Unsupported key curve for this operation")}},oP=(e,t)=>{let r;if(o_(e))r=i8.KeyObject.from(e);else if(oS(e))r=e;else if(oA(e))return e.crv;else throw TypeError(oT(e,...oE));if("secret"===r.type)throw TypeError('only "private" or "public" type keys can be used for this operation');switch(r.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${r.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${r.asymmetricKeyType.slice(1)}`;case"ec":{let e=r.asymmetricKeyDetails.namedCurve;if(t)return e;return oN(e)}default:throw TypeError("Invalid asymmetric key type for this operation")}},oC=(e,t)=>{let r;try{r=e instanceof i8.KeyObject?e.asymmetricKeyDetails?.modulusLength:Buffer.from(e.n,"base64url").byteLength<<3}catch{}if("number"!=typeof r||r<2048)throw TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)},oO=new Map([["ES256","P-256"],["ES256K","secp256k1"],["ES384","P-384"],["ES512","P-521"]]);function o$(e,t){let r,s,n,a;if(t instanceof i8.KeyObject)r=t.asymmetricKeyType,s=t.asymmetricKeyDetails;else switch(n=!0,t.kty){case"RSA":r="rsa";break;case"EC":r="ec";break;case"OKP":if("Ed25519"===t.crv){r="ed25519";break}if("Ed448"===t.crv){r="ed448";break}throw TypeError("Invalid key for this operation, its crv must be Ed25519 or Ed448");default:throw TypeError("Invalid key for this operation, its kty must be RSA, OKP, or EC")}switch(e){case"EdDSA":if(!["ed25519","ed448"].includes(r))throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519 or ed448");break;case"RS256":case"RS384":case"RS512":if("rsa"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");oC(t,e);break;case"PS256":case"PS384":case"PS512":if("rsa-pss"===r){let{hashAlgorithm:t,mgf1HashAlgorithm:r,saltLength:n}=s,a=parseInt(e.slice(-3),10);if(void 0!==t&&(t!==`sha${a}`||r!==t))throw TypeError(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${e}`);if(void 0!==n&&n>a>>3)throw TypeError(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${e}`)}else if("rsa"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa or rsa-pss");oC(t,e),a={padding:i8.constants.RSA_PKCS1_PSS_PADDING,saltLength:i8.constants.RSA_PSS_SALTLEN_DIGEST};break;case"ES256":case"ES256K":case"ES384":case"ES512":{if("ec"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ec");let s=oP(t),n=oO.get(e);if(s!==n)throw TypeError(`Invalid key curve for the algorithm, its curve must be ${n}, got ${s}`);a={dsaEncoding:"ieee-p1363"};break}default:throw new on(`alg ${e} is not supported either by JOSE or your javascript runtime`)}return n?{format:"jwk",key:t,...a}:a?{...a,key:t}:t}function oj(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function oR(e,t){return e.name===t}function oq(e){return parseInt(e.name.slice(4),10)}function oD(e,t,r){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(oT(t,...oE));return(0,i8.createSecretKey)(t)}if(t instanceof i8.KeyObject)return t;if(o_(t))return function(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!oR(e.algorithm,"HMAC"))throw oj("HMAC");let r=parseInt(t.slice(2),10);if(oq(e.algorithm.hash)!==r)throw oj(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!oR(e.algorithm,"RSASSA-PKCS1-v1_5"))throw oj("RSASSA-PKCS1-v1_5");let r=parseInt(t.slice(2),10);if(oq(e.algorithm.hash)!==r)throw oj(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!oR(e.algorithm,"RSA-PSS"))throw oj("RSA-PSS");let r=parseInt(t.slice(2),10);if(oq(e.algorithm.hash)!==r)throw oj(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw oj("Ed25519 or Ed448");break;case"ES256":case"ES384":case"ES512":{if(!oR(e.algorithm,"ECDSA"))throw oj("ECDSA");let r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw oj(r,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}(function(e,t){if(t.length&&!t.some(t=>e.usages.includes(t))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){let r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw TypeError(e)}})(e,r)}(t,e,r),i8.KeyObject.from(t);if(oA(t))return e.startsWith("HS")?(0,i8.createSecretKey)(Buffer.from(t.k,"base64url")):t;throw TypeError(oT(t,...oE,"Uint8Array","JSON Web Key"))}let oM=(0,ov.promisify)(i8.sign),oL=async(e,t,r)=>{let s=oD(e,t,"sign");if(e.startsWith("HS")){let t=i8.createHmac(function(e){switch(e){case"HS256":return"sha256";case"HS384":return"sha384";case"HS512":return"sha512";default:throw new on(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}(e),s);return t.update(r),t.digest()}return oM(ob(e),r,o$(e,s))},oF=(0,ov.promisify)(i8.verify),oz=async(e,t,r,s)=>{let n=oD(e,t,"verify");if(e.startsWith("HS")){let t=await oL(e,n,s);try{return i8.timingSafeEqual(r,t)}catch{return!1}}let a=ob(e),i=o$(e,n);try{return await oF(a,s,i,r)}catch{return!1}},oB=(...e)=>{let t;let r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0},oZ=e=>e?.[Symbol.toStringTag],oU=(e,t,r)=>{if(void 0!==t.use&&"sig"!==t.use)throw TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==t.key_ops&&t.key_ops.includes?.(r)!==!0)throw TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0},oJ=(e,t,r,s)=>{if(!(t instanceof Uint8Array)){if(s&&oA(t)){if(function(e){return oA(e)&&"oct"===e.kty&&"string"==typeof e.k}(t)&&oU(e,t,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!oI(t))throw TypeError(ok(e,t,...oE,"Uint8Array",s?"JSON Web Key":null));if("secret"!==t.type)throw TypeError(`${oZ(t)} instances for symmetric algorithms must be of type "secret"`)}},oV=(e,t,r,s)=>{if(s&&oA(t))switch(r){case"sign":if(function(e){return"oct"!==e.kty&&"string"==typeof e.d}(t)&&oU(e,t,r))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(function(e){return"oct"!==e.kty&&void 0===e.d}(t)&&oU(e,t,r))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!oI(t))throw TypeError(ok(e,t,...oE,s?"JSON Web Key":null));if("secret"===t.type)throw TypeError(`${oZ(t)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw TypeError(`${oZ(t)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw TypeError(`${oZ(t)} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError(`${oZ(t)} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError(`${oZ(t)} instances for asymmetric algorithm encryption must be of type "public"`)};function oK(e,t,r,s){t.startsWith("HS")||"dir"===t||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?oJ(t,r,s,e):oV(t,r,s,e)}oK.bind(void 0,!1);let oQ=oK.bind(void 0,!0),oW=function(e,t,r,s,n){let a;if(void 0!==n.crit&&s?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!s||void 0===s.crit)return new Set;if(!Array.isArray(s.crit)||0===s.crit.length||s.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let i of(a=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,s.crit)){if(!a.has(i))throw new on(`Extension Header Parameter "${i}" is not recognized`);if(void 0===n[i])throw new e(`Extension Header Parameter "${i}" is missing`);if(a.get(i)&&void 0===s[i])throw new e(`Extension Header Parameter "${i}" MUST be integrity protected`)}return new Set(s.crit)},oH=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};async function oG(e,t,r){let s,n;if(!od(e))throw new oa("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new oa('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new oa("JWS Protected Header incorrect type");if(void 0===e.payload)throw new oa("JWS Payload missing");if("string"!=typeof e.signature)throw new oa("JWS Signature missing or incorrect type");if(void 0!==e.header&&!od(e.header))throw new oa("JWS Unprotected Header incorrect type");let a={};if(e.protected)try{let t=i6(e.protected);a=JSON.parse(i3.decode(t))}catch{throw new oa("JWS Protected Header is invalid")}if(!oB(a,e.header))throw new oa("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let i={...a,...e.header},o=oW(oa,new Map([["b64",!0]]),r?.crit,a,i),l=!0;if(o.has("b64")&&"boolean"!=typeof(l=a.b64))throw new oa('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:u}=i;if("string"!=typeof u||!u)throw new oa('JWS "alg" (Algorithm) Header Parameter missing or invalid');let c=r&&oH("algorithms",r.algorithms);if(c&&!c.has(u))throw new os('"alg" (Algorithm) Header Parameter value not allowed');if(l){if("string"!=typeof e.payload)throw new oa("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new oa("JWS Payload must be a string or an Uint8Array instance");let d=!1;"function"==typeof t?(t=await t(a,e),d=!0,oQ(u,t,"verify"),oA(t)&&(t=await op(t,u))):oQ(u,t,"verify");let p=function(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;for(let s of e)t.set(s,r),r+=s.length;return t}(i5.encode(e.protected??""),i5.encode("."),"string"==typeof e.payload?i5.encode(e.payload):e.payload);try{s=i6(e.signature)}catch{throw new oa("Failed to base64url decode the signature")}if(!await oz(u,t,s,p))throw new oc;if(l)try{n=i6(e.payload)}catch{throw new oa("Failed to base64url decode the payload")}else n="string"==typeof e.payload?i5.encode(e.payload):e.payload;let h={payload:n};return(void 0!==e.protected&&(h.protectedHeader=a),void 0!==e.header&&(h.unprotectedHeader=e.header),d)?{...h,key:t}:h}async function oY(e,t,r){if(e instanceof Uint8Array&&(e=i3.decode(e)),"string"!=typeof e)throw new oa("Compact JWS must be a string or Uint8Array");let{0:s,1:n,2:a,length:i}=e.split(".");if(3!==i)throw new oa("Invalid Compact JWS");let o=await oG({payload:n,protected:s,signature:a},t,r),l={payload:o.payload,protectedHeader:o.protectedHeader};return"function"==typeof t?{...l,key:o.key}:l}let oX=e=>Math.floor(e.getTime()/1e3),o0=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,o1=e=>{let t;let r=o0.exec(e);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");let s=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(s);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*s);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*s);break;case"day":case"days":case"d":t=Math.round(86400*s);break;case"week":case"weeks":case"w":t=Math.round(604800*s);break;default:t=Math.round(0x1e187e0*s)}return"-"===r[1]||"ago"===r[4]?-t:t},o2=e=>e.toLowerCase().replace(/^application\//,""),o4=(e,t)=>"string"==typeof e?t.includes(e):!!Array.isArray(e)&&t.some(Set.prototype.has.bind(new Set(e))),o9=(e,t,r={})=>{let s,n;try{s=JSON.parse(i3.decode(t))}catch{}if(!od(s))throw new oi("JWT Claims Set must be a top-level JSON object");let{typ:a}=r;if(a&&("string"!=typeof e.typ||o2(e.typ)!==o2(a)))throw new ot('unexpected "typ" JWT header value',s,"typ","check_failed");let{requiredClaims:i=[],issuer:o,subject:l,audience:u,maxTokenAge:c}=r,d=[...i];for(let e of(void 0!==c&&d.push("iat"),void 0!==u&&d.push("aud"),void 0!==l&&d.push("sub"),void 0!==o&&d.push("iss"),new Set(d.reverse())))if(!(e in s))throw new ot(`missing required "${e}" claim`,s,e,"missing");if(o&&!(Array.isArray(o)?o:[o]).includes(s.iss))throw new ot('unexpected "iss" claim value',s,"iss","check_failed");if(l&&s.sub!==l)throw new ot('unexpected "sub" claim value',s,"sub","check_failed");if(u&&!o4(s.aud,"string"==typeof u?[u]:u))throw new ot('unexpected "aud" claim value',s,"aud","check_failed");switch(typeof r.clockTolerance){case"string":n=o1(r.clockTolerance);break;case"number":n=r.clockTolerance;break;case"undefined":n=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:p}=r,h=oX(p||new Date);if((void 0!==s.iat||c)&&"number"!=typeof s.iat)throw new ot('"iat" claim must be a number',s,"iat","invalid");if(void 0!==s.nbf){if("number"!=typeof s.nbf)throw new ot('"nbf" claim must be a number',s,"nbf","invalid");if(s.nbf>h+n)throw new ot('"nbf" claim timestamp check failed',s,"nbf","check_failed")}if(void 0!==s.exp){if("number"!=typeof s.exp)throw new ot('"exp" claim must be a number',s,"exp","invalid");if(s.exp<=h-n)throw new or('"exp" claim timestamp check failed',s,"exp","check_failed")}if(c){let e=h-s.iat;if(e-n>("number"==typeof c?c:o1(c)))throw new or('"iat" claim timestamp check failed (too far in the past)',s,"iat","check_failed");if(e<0-n)throw new ot('"iat" claim timestamp check failed (it should be in the past)',s,"iat","check_failed")}return s};async function o5(e,t,r){let s=await oY(e,t,r);if(s.protectedHeader.crit?.includes("b64")&&!1===s.protectedHeader.b64)throw new oi("JWTs MUST NOT use unencoded payload");let n={payload:o9(s.protectedHeader,s.payload,r),protectedHeader:s.protectedHeader};return"function"==typeof t?{...n,key:s.key}:n}class o3 extends Error{constructor(){super("Invalid subject")}}class o6 extends Error{constructor(){super("Invalid refresh token")}}class o8 extends Error{constructor(){super("Invalid access token")}}class o7 extends Error{constructor(){super("Invalid authorization code")}}async function le(e,t){if("plain"===t)return e;let r=(new TextEncoder).encode(e);return oy(new Uint8Array(await crypto.subtle.digest("SHA-256",r)))}async function lt(e=64){if(e<43||e>128)throw Error("Code verifier length must be between 43 and 128 characters");let t=function(e){let t=new Uint8Array(e);return crypto.getRandomValues(t),oy(t)}(e),r=await le(t,"S256");return{verifier:t,challenge:r,method:"S256"}}let lr=require("process"),ls=require("fs");var ln=r(5511);let la={...globalThis.$SST_LINKS};for(let[e,t]of Object.entries({...lr.env,...globalThis.process?.env}))e.startsWith("SST_RESOURCE_")&&t&&(la[e.slice("SST_RESOURCE_".length)]=JSON.parse(t));if(lr.env.SST_KEY_FILE&&lr.env.SST_KEY&&!globalThis.SST_KEY_FILE_DATA){let e=Buffer.from(lr.env.SST_KEY,"base64"),t=(0,ls.readFileSync)(lr.env.SST_KEY_FILE),r=Buffer.alloc(12,0),s=ln.createDecipheriv("aes-256-gcm",e,r),n=t.subarray(-16),a=t.subarray(0,-16);s.setAuthTag(n);let i=s.update(a);Object.assign(la,JSON.parse((i=Buffer.concat([i,s.final()])).toString()))}globalThis.SST_KEY_FILE_DATA&&Object.assign(la,globalThis.SST_KEY_FILE_DATA);let li=new Proxy(la,{get(e,t){if(t in la)return la[t];if(!lr.env.SST_RESOURCE_App)throw Error("It does not look like SST links are active. If this is in local development and you are not starting this process through the multiplexer, wrap your command with `sst dev -- <command>`");let r=`"${t}" is not linked in your sst.config.ts`;throw lr.env.AWS_LAMBDA_FUNCTION_NAME&&(r+=` to ${lr.env.AWS_LAMBDA_FUNCTION_NAME}`),Error(r)}}),lo=function(e){let t=new Map,r=new Map,s=e.issuer||process.env.OPENAUTH_ISSUER;if(!s)throw Error("No issuer");let n=e.fetch??fetch;async function a(){let e=r.get(s);if(e)return e;let t=await (n||fetch)(`${s}/.well-known/oauth-authorization-server`).then(e=>e.json());return r.set(s,t),t}async function i(){let e=await a(),r=t.get(s);if(r)return r;let i=function(e){let t=new of(e),r=async(e,r)=>t.getKey(e,r);return Object.defineProperties(r,{jwks:{value:()=>om(t._jwks),enumerable:!0,configurable:!1,writable:!1}}),r}(await (n||fetch)(e.jwks_uri).then(e=>e.json()));return t.set(s,i),i}let o={async authorize(t,r,n){let a=new URL(s+"/authorize"),i={state:crypto.randomUUID()};if(a.searchParams.set("client_id",e.clientID),a.searchParams.set("redirect_uri",t),a.searchParams.set("response_type",r),a.searchParams.set("state",i.state),n?.provider&&a.searchParams.set("provider",n.provider),n?.pkce&&"code"===r){let e=await lt();a.searchParams.set("code_challenge_method","S256"),a.searchParams.set("code_challenge",e.challenge),i.verifier=e.verifier}return{challenge:i,url:a.toString()}},async pkce(t,r){let n=new URL(s+"/authorize");r?.provider&&n.searchParams.set("provider",r.provider),n.searchParams.set("client_id",e.clientID),n.searchParams.set("redirect_uri",t),n.searchParams.set("response_type","code");let a=await lt();return n.searchParams.set("code_challenge_method","S256"),n.searchParams.set("code_challenge",a.challenge),[a.verifier,n.toString()]},async exchange(t,r,a){let i=await n(s+"/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({code:t,redirect_uri:r,grant_type:"authorization_code",client_id:e.clientID,code_verifier:a||""}).toString()}),o=await i.json();return i.ok?{err:!1,tokens:{access:o.access_token,refresh:o.refresh_token}}:{err:new o7}},async refresh(e,t){if(t&&t.access){let e=function(e){let t,r;if("string"!=typeof e)throw new oi("JWTs must use Compact JWS serialization, JWT must be a string");let{1:s,length:n}=e.split(".");if(5===n)throw new oi("Only JWTs using Compact JWS serialization can be decoded");if(3!==n)throw new oi("Invalid JWT");if(!s)throw new oi("JWTs must contain a payload");try{t=i6(s)}catch{throw new oi("Failed to base64url decode the payload")}try{r=JSON.parse(i3.decode(t))}catch{throw new oi("Failed to parse the decoded payload as JSON")}if(!od(r))throw new oi("Invalid JWT Claims Set");return r}(t.access);if(!e)return{err:new o8};if((e.exp||0)>Date.now()/1e3+30)return{err:!1}}let r=await n(s+"/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:e}).toString()}),a=await r.json();return r.ok?{err:!1,tokens:{access:a.access_token,refresh:a.refresh_token}}:{err:new o6}},async verify(e,t,r){let n=await i();try{let r=await o5(t,n,{issuer:s}),a=await e[r.payload.type]["~standard"].validate(r.payload.properties);if(!a.issues&&"access"===r.payload.mode)return{aud:r.payload.aud,subject:{type:r.payload.type,properties:a.value}};return{err:new o3}}catch(t){if(t instanceof or&&r?.refresh){let t=await this.refresh(r.refresh);if(t.err)return t;let n=await o.verify(e,t.tokens.access,{refresh:t.tokens.refresh,issuer:s,fetch:r?.fetch});if(n.err)return n;return n.tokens=t.tokens,n}return{err:new o8}}}};return o}({clientID:"api",issuer:li.auth.url});function ll(e,t,r,s,n){var a,i,o,l;let u=n&&"input"in n?n.input:r.value,c=n?.expected??e.expects??null,d=n?.received??function(e){let t=typeof e;return"string"===t?`"${e}"`:"number"===t||"bigint"===t||"boolean"===t?`${e}`:"object"===t||"function"===t?(e&&Object.getPrototypeOf(e)?.constructor?.name)??"null":t}(u),p={kind:e.kind,type:e.type,input:u,expected:c,received:d,message:`Invalid ${t}: ${c?`Expected ${c} but r`:"R"}eceived ${d}`,requirement:e.requirement,path:n?.path,issues:n?.issues,lang:s.lang,abortEarly:s.abortEarly,abortPipeEarly:s.abortPipeEarly},h="schema"===e.kind,m=n?.message??e.message??(a=e.reference,i=p.lang,U?.get(a)?.get(i))??(h?(o=p.lang,Z?.get(o)):null)??s.message??(l=p.lang,B?.get(l));m&&(p.message="function"==typeof m?m(p):m),h&&(r.typed=!1),r.issues?r.issues.push(p):r.issues=[p]}function lu(e){return{version:1,vendor:"valibot",validate:t=>{var r;return e["~run"]({value:t},{lang:(void 0)??z?.lang,message:r?.message,abortEarly:r?.abortEarly??z?.abortEarly,abortPipeEarly:r?.abortPipeEarly??z?.abortPipeEarly})}}}function lc(e,t,r){return"function"==typeof e.fallback?e.fallback(t,r):e.fallback}function ld(e,t,r){return"function"==typeof e.default?e.default(t,r):e.default}function lp(e){if("entries"in e){let t={};for(let r in e.entries)t[r]=lp(e.entries[r]);return t}return"items"in e?e.items.map(lp):ld(e)}async function lh(e){return"entries"in e?Object.fromEntries(await Promise.all(Object.entries(e.entries).map(async([e,t])=>[e,await lh(t)]))):"items"in e?Promise.all(e.items.map(lh)):ld(e)}function lm(e){if("entries"in e){let t={};for(let r in e.entries)t[r]=lm(e.entries[r]);return t}return"items"in e?e.items.map(lm):lc(e)}async function lf(e){return"entries"in e?Object.fromEntries(await Promise.all(Object.entries(e.entries).map(async([e,t])=>[e,await lf(t)]))):"items"in e?Promise.all(e.items.map(lf)):lc(e)}function lg(e){return{kind:"schema",type:"string",reference:lg,expects:"string",async:!1,message:e,get"~standard"(){return lu(this)},"~run"(e,t){return"string"==typeof e.value?e.typed=!0:ll(this,"type",e,t),e}}}let ly={user:function e(t,r){return{kind:"schema",type:"object",reference:e,expects:"Object",async:!1,entries:t,message:r,get"~standard"(){return lu(this)},"~run"(e,t){let r=e.value;if(r&&"object"==typeof r)for(let s in e.typed=!0,e.value={},this.entries){let n=this.entries[s];if(s in r||("exact_optional"===n.type||"optional"===n.type||"nullish"===n.type)&&void 0!==n.default){let a=s in r?r[s]:ld(n),i=n["~run"]({value:a},t);if(i.issues){let n={type:"object",origin:"value",input:r,key:s,value:a};for(let t of i.issues)t.path?t.path.unshift(n):t.path=[n],e.issues?.push(t);if(e.issues||(e.issues=i.issues),t.abortEarly){e.typed=!1;break}}i.typed||(e.typed=!1),e.value[s]=i.value}else if(void 0!==n.fallback)e.value[s]=lc(n);else if("exact_optional"!==n.type&&"optional"!==n.type&&"nullish"!==n.type&&(ll(this,"key",e,t,{input:void 0,expected:`"${s}"`,path:[{type:"object",origin:"key",input:r,key:s,value:r[s]}]}),t.abortEarly))break}else ll(this,"type",e,t);return e}}}({id:lg(),name:function e(t,r){return{kind:"schema",type:"nullable",reference:e,expects:`(${t.expects} | null)`,async:!1,wrapped:t,default:r,get"~standard"(){return lu(this)},"~run"(e,t){return null===e.value&&(void 0!==this.default&&(e.value=ld(this,e,t)),null===e.value)?(e.typed=!0,e):this.wrapped["~run"](e,t)}}}(lg()),email:lg(),verified:function e(t){return{kind:"schema",type:"boolean",reference:e,expects:"boolean",async:!1,message:t,get"~standard"(){return lu(this)},"~run"(e,t){return"boolean"==typeof e.value?e.typed=!0:ll(this,"type",e,t),e}}}()})},lv=async(e,t)=>{let r=e.req.header("Authorization");if(!r)throw new na(401);let s=r.split(" ")[1];if(!s)throw new na(401);let n=await lo.verify(ly,s);if(n.err)throw new na(401,n.err);e.set("user",n.subject.properties),await t()},lb=new eL().use(lv);function lw(e){var t=Error(e);return t.source="ulid",t}lb.post("/command",nd("json",sz.object({messages:sz.array(sz.any()),system:sz.string().optional()})),e=>{let{messages:t,system:r}=e.req.valid("json");console.log({apiKey:e.env.LANGDB_API_KEY,baseURL:e.env.LANGDB_OPENAI_BASE_URL,headers:{"x-project-id":e.env.LANGDB_PROJECT_ID}});let s=s7({apiKey:e.env.LANGDB_API_KEY,baseURL:e.env.LANGDB_OPENAI_BASE_URL,headers:{"x-project-id":e.env.LANGDB_PROJECT_ID}});try{return(function({model:e,tools:t,toolChoice:r,system:s,prompt:n,messages:a,maxRetries:i,abortSignal:o,headers:l,maxSteps:u=1,experimental_generateMessageId:c=iD,experimental_output:d,experimental_continueSteps:p=!1,experimental_telemetry:h,experimental_providerMetadata:m,providerOptions:f=m,experimental_toolCallStreaming:g=!1,toolCallStreaming:y=g,experimental_activeTools:v,experimental_repairToolCall:b,experimental_transform:w,onChunk:_,onError:S,onFinish:x,onStepFinish:T,_internal:{now:k=function(){var e,t;return null!=(t=null==(e=null==globalThis?void 0:globalThis.performance)?void 0:e.now())?t:Date.now()},generateId:I=iq,currentDate:E=()=>new Date}={},...A}){return new iM({model:e,telemetry:h,headers:l,settings:A,maxRetries:i,abortSignal:o,system:s,prompt:n,messages:a,tools:t,toolChoice:r,toolCallStreaming:y,transforms:void 0===w?[]:Array.isArray(w)?w:[w],activeTools:v,repairToolCall:b,maxSteps:u,output:d,continueSteps:p,providerOptions:f,onChunk:_,onError:S,onFinish:x,onStepFinish:T,now:k,currentDate:E,generateId:I,generateMessageId:c})})({maxTokens:2048,messages:aZ(t),model:s("gpt-3.5-turbo-0125"),system:r}).toDataStreamResponse()}catch{throw new na(500,{message:"Failed to process AI request"})}}),lb.post("/copilot",nd("json",sz.object({system:sz.string().optional(),prompt:sz.string().optional()})),async e=>{let{prompt:t,system:r}=e.req.valid("json"),s=s7({apiKey:e.env.LANGDB_API_KEY,baseURL:e.env.LANGDB_OPENAI_BASE_URL,headers:{"x-project-id":e.env.LANGDB_PROJECT_ID}});try{let n=await iP({abortSignal:e.event.request.signal,maxTokens:200,model:s("gpt-3.5-turbo-0125"),prompt:t,system:r,temperature:.7});return e.json(n)}catch(e){if(e instanceof Error&&"AbortError"===e.name)throw new na(408);throw new na(500,{message:"Failed to process AI request"})}});var l_="0123456789ABCDEFGHJKMNPQRSTVWXYZ",lS=l_.length,lx=function(e){return e||(e=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments[1];t||(t="undefined"!=typeof window?window:null);var s=t&&(t.crypto||t.msCrypto);if(s)return function(){var e=new Uint8Array(1);return s.getRandomValues(e),e[0]/255};try{var n=r(5511);return function(){return n.randomBytes(1).readUInt8()/255}}catch(e){}if(e){try{console.error("secure crypto unusable, falling back to insecure Math.random()!")}catch(e){}return function(){return Math.random()}}throw lw("secure crypto unusable, insecure Math.random not allowed")}()),function(t){return isNaN(t)&&(t=Date.now()),function(e,t){if(isNaN(e))throw Error(e+" must be a number");if(e>0xffffffffffff)throw lw("cannot encode time greater than 281474976710655");if(e<0)throw lw("time must be positive");if(!1===Number.isInteger(e))throw lw("time must be an integer");for(var r=void 0,s="";t>0;t--)r=e%lS,s=l_.charAt(r)+s,e=(e-r)/lS;return s}(t,10)+function(e,t){for(var r="";e>0;e--)r=function(e){var t=Math.floor(e()*lS);return t===lS&&(t=lS-1),l_.charAt(t)}(t)+r;return r}(16,e)}}();let lT=require("pg"),lk=Symbol.for("drizzle:entityKind");function lI(e,t){if(!e||"object"!=typeof e)return!1;if(e instanceof t)return!0;if(!Object.prototype.hasOwnProperty.call(t,lk))throw Error(`Class "${t.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let r=Object.getPrototypeOf(e).constructor;if(r)for(;r;){if(lk in r&&r[lk]===t[lk])return!0;r=Object.getPrototypeOf(r)}return!1}Symbol.for("drizzle:hasOwnEntityKind");class lE{static [lk]="ConsoleLogWriter";write(e){console.log(e)}}class lA{static [lk]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new lE}logQuery(e,t){let r=t.map(e=>{try{return JSON.stringify(e)}catch{return String(e)}}),s=r.length?` -- params: [${r.join(", ")}]`:"";this.writer.write(`Query: ${e}${s}`)}}class lN{static [lk]="NoopLogger";logQuery(){}}class lP{constructor(e,t){this.table=e,this.config=t,this.name=t.name,this.keyAsName=t.keyAsName,this.notNull=t.notNull,this.default=t.default,this.defaultFn=t.defaultFn,this.onUpdateFn=t.onUpdateFn,this.hasDefault=t.hasDefault,this.primary=t.primaryKey,this.isUnique=t.isUnique,this.uniqueName=t.uniqueName,this.uniqueType=t.uniqueType,this.dataType=t.dataType,this.columnType=t.columnType,this.generated=t.generated,this.generatedIdentity=t.generatedIdentity}static [lk]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(e){return e}mapToDriverValue(e){return e}shouldDisableInsert(){return void 0!==this.config.generated&&"byDefault"!==this.config.generated.type}}class lC{static [lk]="ColumnBuilder";config;constructor(e,t,r){this.config={name:e,keyAsName:""===e,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:t,columnType:r,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(e){return this.config.default=e,this.config.hasDefault=!0,this}$defaultFn(e){return this.config.defaultFn=e,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(e){return this.config.onUpdateFn=e,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(e){""===this.config.name&&(this.config.name=e)}}let lO=Symbol.for("drizzle:Name");class l${static [lk]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(e,t){this.reference=()=>{let{name:t,columns:r,foreignColumns:s}=e();return{name:t,columns:r,foreignTable:s[0].table,foreignColumns:s}},t&&(this._onUpdate=t.onUpdate,this._onDelete=t.onDelete)}onUpdate(e){return this._onUpdate=void 0===e?"no action":e,this}onDelete(e){return this._onDelete=void 0===e?"no action":e,this}build(e){return new lj(e,this)}}class lj{constructor(e,t){this.table=e,this.reference=t.reference,this.onUpdate=t._onUpdate,this.onDelete=t._onDelete}static [lk]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:e,columns:t,foreignColumns:r}=this.reference(),s=t.map(e=>e.name),n=r.map(e=>e.name),a=[this.table[lO],...s,r[0].table[lO],...n];return e??`${a.join("_")}_fk`}}function lR(e,...t){return e(...t)}function lq(e,t){return`${e[lO]}_${t.join("_")}_unique`}class lD{constructor(e,t){this.name=t,this.columns=e}static [lk]=null;columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(e){return new lL(e,this.columns,this.nullsNotDistinctConfig,this.name)}}class lM{static [lk]=null;name;constructor(e){this.name=e}on(...e){return new lD(e,this.name)}}class lL{constructor(e,t,r,s){this.table=e,this.columns=t,this.name=s??lq(this.table,this.columns.map(e=>e.name)),this.nullsNotDistinct=r}static [lk]=null;columns;name;nullsNotDistinct=!1;getName(){return this.name}}function lF(e,t,r){for(let s=t;s<e.length;s++){let n=e[s];if("\\"===n){s++;continue}if('"'===n)return[e.slice(t,s).replace(/\\/g,""),s+1];if(!r&&(","===n||"}"===n))return[e.slice(t,s).replace(/\\/g,""),s]}return[e.slice(t).replace(/\\/g,""),e.length]}class lz extends lC{foreignKeyConfigs=[];static [lk]="PgColumnBuilder";array(e){return new lJ(this.config.name,this,e)}references(e,t={}){return this.foreignKeyConfigs.push({ref:e,actions:t}),this}unique(e,t){return this.config.isUnique=!0,this.config.uniqueName=e,this.config.uniqueType=t?.nulls,this}generatedAlwaysAs(e){return this.config.generated={as:e,type:"always",mode:"stored"},this}buildForeignKeys(e,t){return this.foreignKeyConfigs.map(({ref:r,actions:s})=>lR((r,s)=>{let n=new l$(()=>({columns:[e],foreignColumns:[r()]}));return s.onUpdate&&n.onUpdate(s.onUpdate),s.onDelete&&n.onDelete(s.onDelete),n.build(t)},r,s))}buildExtraConfigColumn(e){return new lZ(e,this.config)}}class lB extends lP{constructor(e,t){t.uniqueName||(t.uniqueName=lq(e,[t.name])),super(e,t),this.table=e}static [lk]="PgColumn"}class lZ extends lB{static [lk]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(e){return this.indexConfig.opClass=e,this}}class lU{static [lk]=null;constructor(e,t,r,s){this.name=e,this.keyAsName=t,this.type=r,this.indexConfig=s}name;keyAsName;type;indexConfig}class lJ extends lz{static [lk]="PgArrayBuilder";constructor(e,t,r){super(e,"array","PgArray"),this.config.baseBuilder=t,this.config.size=r}build(e){let t=this.config.baseBuilder.build(e);return new lV(e,this.config,t)}}class lV extends lB{constructor(e,t,r,s){super(e,t),this.baseColumn=r,this.range=s,this.size=t.size}size;static [lk]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${"number"==typeof this.size?this.size:""}]`}mapFromDriverValue(e){return"string"==typeof e&&(e=function(e){let[t]=function e(t,r=0){let s=[],n=r,a=!1;for(;n<t.length;){let i=t[n];if(","===i){(a||n===r)&&s.push(""),a=!0,n++;continue}if(a=!1,"\\"===i){n+=2;continue}if('"'===i){let[e,r]=lF(t,n+1,!0);s.push(e),n=r;continue}if("}"===i)return[s,n+1];if("{"===i){let[r,a]=e(t,n+1);s.push(r),n=a;continue}let[o,l]=lF(t,n,!1);s.push(o),n=l}return[s,n]}(e,1);return t}(e)),e.map(e=>this.baseColumn.mapFromDriverValue(e))}mapToDriverValue(e,t=!1){let r=e.map(e=>null===e?null:lI(this.baseColumn,lV)?this.baseColumn.mapToDriverValue(e,!0):this.baseColumn.mapToDriverValue(e));return t?r:function e(t){return`{${t.map(t=>Array.isArray(t)?e(t):"string"==typeof t?`"${t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${t}`).join(",")}}`}(r)}}let lK=Symbol.for("drizzle:isPgEnum");class lQ extends lz{static [lk]="PgEnumColumnBuilder";constructor(e,t){super(e,"string","PgEnumColumn"),this.config.enum=t}build(e){return new lW(e,this.config)}}class lW extends lB{static [lk]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(e,t){super(e,t),this.enum=t.enum}getSQLType(){return this.enum.enumName}}function lH(e,t,r){let s=Object.assign(e=>new lQ(e??"",s),{enumName:e,enumValues:t,schema:r,[lK]:!0});return s}class lG{static [lk]="Subquery";constructor(e,t,r,s=!1){this._={brand:"Subquery",sql:e,selectedFields:t,alias:r,isWith:s}}}class lY extends lG{static [lk]="WithSubquery"}let lX={startActiveSpan:(e,t)=>n?(a||(a=n.trace.getTracer("drizzle-orm","0.39.3")),lR((r,s)=>s.startActiveSpan(e,e=>{try{return t(e)}catch(t){throw e.setStatus({code:r.SpanStatusCode.ERROR,message:t instanceof Error?t.message:"Unknown error"}),t}finally{e.end()}}),n,a)):t()},l0=Symbol.for("drizzle:ViewBaseConfig"),l1=Symbol.for("drizzle:Schema"),l2=Symbol.for("drizzle:Columns"),l4=Symbol.for("drizzle:ExtraConfigColumns"),l9=Symbol.for("drizzle:OriginalName"),l5=Symbol.for("drizzle:BaseName"),l3=Symbol.for("drizzle:IsAlias"),l6=Symbol.for("drizzle:ExtraConfigBuilder"),l8=Symbol.for("drizzle:IsDrizzleTable");class l7{static [lk]="Table";static Symbol={Name:lO,Schema:l1,OriginalName:l9,Columns:l2,ExtraConfigColumns:l4,BaseName:l5,IsAlias:l3,ExtraConfigBuilder:l6};[lO];[l9];[l1];[l2];[l4];[l5];[l3]=!1;[l8]=!0;[l6]=void 0;constructor(e,t,r){this[lO]=this[l9]=e,this[l1]=t,this[l5]=r}}function ue(e){return`${e[l1]??"public"}.${e[lO]}`}class ut{static [lk]=null}function ur(e){return null!=e&&"function"==typeof e.getSQL}class us{static [lk]="StringChunk";value;constructor(e){this.value=Array.isArray(e)?e:[e]}getSQL(){return new un([this])}}class un{constructor(e){this.queryChunks=e}static [lk]="SQL";decoder=ui;shouldInlineParams=!1;append(e){return this.queryChunks.push(...e.queryChunks),this}toQuery(e){return lX.startActiveSpan("drizzle.buildSQL",t=>{let r=this.buildQueryFromSourceParams(this.queryChunks,e);return t?.setAttributes({"drizzle.query.text":r.sql,"drizzle.query.params":JSON.stringify(r.params)}),r})}buildQueryFromSourceParams(e,t){let r=Object.assign({},t,{inlineParams:t.inlineParams||this.shouldInlineParams,paramStartIndex:t.paramStartIndex||{value:0}}),{casing:s,escapeName:n,escapeParam:a,prepareTyping:i,inlineParams:o,paramStartIndex:l}=r;return function(e){let t={sql:"",params:[]};for(let r of e)t.sql+=r.sql,t.params.push(...r.params),r.typings?.length&&(t.typings||(t.typings=[]),t.typings.push(...r.typings));return t}(e.map(e=>{if(lI(e,us))return{sql:e.value.join(""),params:[]};if(lI(e,ua))return{sql:n(e.value),params:[]};if(void 0===e)return{sql:"",params:[]};if(Array.isArray(e)){let t=[new us("(")];for(let[r,s]of e.entries())t.push(s),r<e.length-1&&t.push(new us(", "));return t.push(new us(")")),this.buildQueryFromSourceParams(t,r)}if(lI(e,un))return this.buildQueryFromSourceParams(e.queryChunks,{...r,inlineParams:o||e.shouldInlineParams});if(lI(e,l7)){let t=e[l7.Symbol.Schema],r=e[l7.Symbol.Name];return{sql:void 0===t||e[l3]?n(r):n(t)+"."+n(r),params:[]}}if(lI(e,lP)){let r=s.getColumnCasing(e);if("indexes"===t.invokeSource)return{sql:n(r),params:[]};let a=e.table[l7.Symbol.Schema];return{sql:e.table[l3]||void 0===a?n(e.table[l7.Symbol.Name])+"."+n(r):n(a)+"."+n(e.table[l7.Symbol.Name])+"."+n(r),params:[]}}if(lI(e,uh)){let t=e[l0].schema,r=e[l0].name;return{sql:void 0===t||e[l0].isAlias?n(r):n(t)+"."+n(r),params:[]}}if(lI(e,ul)){if(lI(e.value,uc))return{sql:a(l.value++,e),params:[e],typings:["none"]};let t=null===e.value?null:e.encoder.mapToDriverValue(e.value);if(lI(t,un))return this.buildQueryFromSourceParams([t],r);if(o)return{sql:this.mapInlineParam(t,r),params:[]};let s=["none"];return i&&(s=[i(e.encoder)]),{sql:a(l.value++,t),params:[t],typings:s}}return lI(e,uc)?{sql:a(l.value++,e),params:[e],typings:["none"]}:lI(e,un.Aliased)&&void 0!==e.fieldAlias?{sql:n(e.fieldAlias),params:[]}:lI(e,lG)?e._.isWith?{sql:n(e._.alias),params:[]}:this.buildQueryFromSourceParams([new us("("),e._.sql,new us(") "),new ua(e._.alias)],r):e&&"function"==typeof e&&lK in e&&!0===e[lK]?e.schema?{sql:n(e.schema)+"."+n(e.enumName),params:[]}:{sql:n(e.enumName),params:[]}:ur(e)?e.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([e.getSQL()],r):this.buildQueryFromSourceParams([new us("("),e.getSQL(),new us(")")],r):o?{sql:this.mapInlineParam(e,r),params:[]}:{sql:a(l.value++,e),params:[e],typings:["none"]}}))}mapInlineParam(e,{escapeString:t}){if(null===e)return"null";if("number"==typeof e||"boolean"==typeof e)return e.toString();if("string"==typeof e)return t(e);if("object"==typeof e){let r=e.toString();return"[object Object]"===r?t(JSON.stringify(e)):t(r)}throw Error("Unexpected param value: "+e)}getSQL(){return this}as(e){return void 0===e?this:new un.Aliased(this,e)}mapWith(e){return this.decoder="function"==typeof e?{mapFromDriverValue:e}:e,this}inlineParams(){return this.shouldInlineParams=!0,this}if(e){return e?this:void 0}}class ua{constructor(e){this.value=e}static [lk]="Name";brand;getSQL(){return new un([this])}}let ui={mapFromDriverValue:e=>e},uo={mapToDriverValue:e=>e};({...ui,...uo});class ul{constructor(e,t=uo){this.value=e,this.encoder=t}static [lk]="Param";brand;getSQL(){return new un([this])}}function uu(e,...t){let r=[];for(let[s,n]of((t.length>0||e.length>0&&""!==e[0])&&r.push(new us(e[0])),t.entries()))r.push(n,new us(e[s+1]));return new un(r)}(e=>{e.empty=function(){return new un([])},e.fromList=function(e){return new un(e)},e.raw=function(e){return new un([new us(e)])},e.join=function(e,t){let r=[];for(let[s,n]of e.entries())s>0&&void 0!==t&&r.push(t),r.push(n);return new un(r)},e.identifier=function(e){return new ua(e)},e.placeholder=function(e){return new uc(e)},e.param=function(e,t){return new ul(e,t)}})(uu||(uu={})),(e=>{class t{constructor(e,t){this.sql=e,this.fieldAlias=t}static [lk]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new t(this.sql,this.fieldAlias)}}e.Aliased=t})(un||(un={}));class uc{constructor(e){this.name=e}static [lk]="Placeholder";getSQL(){return new un([this])}}function ud(e,t){return e.map(e=>{if(lI(e,uc)){if(!(e.name in t))throw Error(`No value for placeholder "${e.name}" was provided`);return t[e.name]}if(lI(e,ul)&&lI(e.value,uc)){if(!(e.value.name in t))throw Error(`No value for placeholder "${e.value.name}" was provided`);return e.encoder.mapToDriverValue(t[e.value.name])}return e})}let up=Symbol.for("drizzle:IsDrizzleView");class uh{static [lk]="View";[l0];[up]=!0;constructor({name:e,schema:t,selectedFields:r,query:s}){this[l0]={name:e,originalName:e,schema:t,selectedFields:r,query:s,isExisting:!s,isAlias:!1}}getSQL(){return new un([this])}}lP.prototype.getSQL=function(){return new un([this])},l7.prototype.getSQL=function(){return new un([this])},lG.prototype.getSQL=function(){return new un([this])};class um{constructor(e){this.table=e}static [lk]="ColumnAliasProxyHandler";get(e,t){return"table"===t?this.table:e[t]}}class uf{constructor(e,t){this.alias=e,this.replaceOriginalName=t}static [lk]="TableAliasProxyHandler";get(e,t){if(t===l7.Symbol.IsAlias)return!0;if(t===l7.Symbol.Name||this.replaceOriginalName&&t===l7.Symbol.OriginalName)return this.alias;if(t===l0)return{...e[l0],name:this.alias,isAlias:!0};if(t===l7.Symbol.Columns){let t=e[l7.Symbol.Columns];if(!t)return t;let r={};return Object.keys(t).map(s=>{r[s]=new Proxy(t[s],new um(new Proxy(e,this)))}),r}let r=e[t];return lI(r,lP)?new Proxy(r,new um(new Proxy(e,this))):r}}class ug{constructor(e){this.alias=e}static [lk]=null;get(e,t){return"sourceTable"===t?uy(e.sourceTable,this.alias):e[t]}}function uy(e,t){return new Proxy(e,new uf(t,!1))}function uv(e,t){return new Proxy(e,new um(new Proxy(e.table,new uf(t,!1))))}function ub(e,t){return new un.Aliased(uw(e.sql,t),e.fieldAlias)}function uw(e,t){return uu.join(e.queryChunks.map(e=>lI(e,lP)?uv(e,t):lI(e,un)?uw(e,t):lI(e,un.Aliased)?ub(e,t):e))}function u_(e){return(e.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(e=>e.toLowerCase()).join("_")}function uS(e){return(e.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((e,t,r)=>e+(0===r?t.toLowerCase():`${t[0].toUpperCase()}${t.slice(1)}`),"")}function ux(e){return e}class uT{static [lk]="CasingCache";cache={};cachedTables={};convert;constructor(e){this.convert="snake_case"===e?u_:"camelCase"===e?uS:ux}getColumnCasing(e){if(!e.keyAsName)return e.name;let t=e.table[l7.Symbol.Schema]??"public",r=e.table[l7.Symbol.OriginalName],s=`${t}.${r}.${e.name}`;return this.cache[s]||this.cacheTable(e.table),this.cache[s]}cacheTable(e){let t=e[l7.Symbol.Schema]??"public",r=e[l7.Symbol.OriginalName],s=`${t}.${r}`;if(!this.cachedTables[s]){for(let t of Object.values(e[l7.Symbol.Columns])){let e=`${s}.${t.name}`;this.cache[e]=this.convert(t.name)}this.cachedTables[s]=!0}}clearCache(){this.cache={},this.cachedTables={}}}class uk extends Error{static [lk]="DrizzleError";constructor({message:e,cause:t}){super(e),this.name="DrizzleError",this.cause=t}}class uI extends uk{static [lk]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}class uE extends lz{static [lk]="PgJsonbBuilder";constructor(e){super(e,"json","PgJsonb")}build(e){return new uA(e,this.config)}}class uA extends lB{static [lk]="PgJsonb";constructor(e,t){super(e,t)}getSQLType(){return"jsonb"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if("string"==typeof e)try{return JSON.parse(e)}catch{}return e}}function uN(e){return new uE(e??"")}class uP extends lz{static [lk]="PgJsonBuilder";constructor(e){super(e,"json","PgJson")}build(e){return new uC(e,this.config)}}class uC extends lB{static [lk]="PgJson";constructor(e,t){super(e,t)}getSQLType(){return"json"}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){if("string"==typeof e)try{return JSON.parse(e)}catch{}return e}}function uO(e){return new uP(e??"")}function u$(e,t){return Object.entries(e).reduce((e,[r,s])=>{if("string"!=typeof r)return e;let n=t?[...t,r]:[r];return lI(s,lP)||lI(s,un)||lI(s,un.Aliased)?e.push({path:n,field:s}):lI(s,l7)?e.push(...u$(s[l7.Symbol.Columns],n)):e.push(...u$(s,n)),e},[])}function uj(e,t){let r=Object.keys(e),s=Object.keys(t);if(r.length!==s.length)return!1;for(let[e,t]of r.entries())if(t!==s[e])return!1;return!0}function uR(e,t){let r=Object.entries(t).filter(([,e])=>void 0!==e).map(([t,r])=>lI(r,un)||lI(r,lP)?[t,r]:[t,new ul(r,e[l7.Symbol.Columns][t])]);if(0===r.length)throw Error("No values to set");return Object.fromEntries(r)}function uq(e){return e[l7.Symbol.Columns]}function uD(e){return lI(e,lG)?e._.alias:lI(e,uh)?e[l0].name:lI(e,un)?void 0:e[l7.Symbol.IsAlias]?e[l7.Symbol.Name]:e[l7.Symbol.BaseName]}function uM(e,t){return{name:"string"==typeof e&&e.length>0?e:"",config:"object"==typeof e?e:t}}class uL extends lz{static [lk]="PgNumericBuilder";constructor(e,t,r){super(e,"string","PgNumeric"),this.config.precision=t,this.config.scale=r}build(e){return new uF(e,this.config)}}class uF extends lB{static [lk]="PgNumeric";precision;scale;constructor(e,t){super(e,t),this.precision=t.precision,this.scale=t.scale}getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}function uz(e,t){let{name:r,config:s}=uM(e,t);return new uL(r,s?.precision,s?.scale)}class uB extends lz{static [lk]="PgDateColumnBaseBuilder";defaultNow(){return this.default(uu`now()`)}}class uZ extends uB{constructor(e,t,r){super(e,"string","PgTime"),this.withTimezone=t,this.precision=r,this.config.withTimezone=t,this.config.precision=r}static [lk]="PgTimeBuilder";build(e){return new uU(e,this.config)}}class uU extends lB{static [lk]="PgTime";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){let e=void 0===this.precision?"":`(${this.precision})`;return`time${e}${this.withTimezone?" with time zone":""}`}}function uJ(e,t={}){let{name:r,config:s}=uM(e,t);return new uZ(r,s.withTimezone??!1,s.precision)}class uV extends uB{static [lk]="PgTimestampBuilder";constructor(e,t,r){super(e,"date","PgTimestamp"),this.config.withTimezone=t,this.config.precision=r}build(e){return new uK(e,this.config)}}class uK extends lB{static [lk]="PgTimestamp";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){let e=void 0===this.precision?"":` (${this.precision})`;return`timestamp${e}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=e=>new Date(this.withTimezone?e:e+"+0000");mapToDriverValue=e=>e.toISOString()}class uQ extends uB{static [lk]="PgTimestampStringBuilder";constructor(e,t,r){super(e,"string","PgTimestampString"),this.config.withTimezone=t,this.config.precision=r}build(e){return new uW(e,this.config)}}class uW extends lB{static [lk]="PgTimestampString";withTimezone;precision;constructor(e,t){super(e,t),this.withTimezone=t.withTimezone,this.precision=t.precision}getSQLType(){let e=void 0===this.precision?"":`(${this.precision})`;return`timestamp${e}${this.withTimezone?" with time zone":""}`}}function uH(e,t={}){let{name:r,config:s}=uM(e,t);return s?.mode==="string"?new uQ(r,s.withTimezone??!1,s.precision):new uV(r,s?.withTimezone??!1,s?.precision)}class uG extends uB{static [lk]="PgDateBuilder";constructor(e){super(e,"date","PgDate")}build(e){return new uY(e,this.config)}}class uY extends lB{static [lk]="PgDate";getSQLType(){return"date"}mapFromDriverValue(e){return new Date(e)}mapToDriverValue(e){return e.toISOString()}}class uX extends uB{static [lk]="PgDateStringBuilder";constructor(e){super(e,"string","PgDateString")}build(e){return new u0(e,this.config)}}class u0 extends lB{static [lk]="PgDateString";getSQLType(){return"date"}}function u1(e,t){let{name:r,config:s}=uM(e,t);return s?.mode==="date"?new uG(r):new uX(r)}class u2 extends lz{static [lk]="PgUUIDBuilder";constructor(e){super(e,"string","PgUUID")}defaultRandom(){return this.default(uu`gen_random_uuid()`)}build(e){return new u4(e,this.config)}}class u4 extends lB{static [lk]="PgUUID";getSQLType(){return"uuid"}}function u9(e){return new u2(e??"")}class u5 extends lz{static [lk]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(e){if(e){let{name:t,...r}=e;this.config.generatedIdentity={type:"always",sequenceName:t,sequenceOptions:r}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(e){if(e){let{name:t,...r}=e;this.config.generatedIdentity={type:"byDefault",sequenceName:t,sequenceOptions:r}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}class u3 extends u5{static [lk]="PgBigInt53Builder";constructor(e){super(e,"number","PgBigInt53")}build(e){return new u6(e,this.config)}}class u6 extends lB{static [lk]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(e){return"number"==typeof e?e:Number(e)}}class u8 extends u5{static [lk]="PgBigInt64Builder";constructor(e){super(e,"bigint","PgBigInt64")}build(e){return new u7(e,this.config)}}class u7 extends lB{static [lk]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(e){return BigInt(e)}}function ce(e,t){let{name:r,config:s}=uM(e,t);return"number"===s.mode?new u3(r):new u8(r)}class ct extends lz{static [lk]="PgBigSerial53Builder";constructor(e){super(e,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new cr(e,this.config)}}class cr extends lB{static [lk]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(e){return"number"==typeof e?e:Number(e)}}class cs extends lz{static [lk]="PgBigSerial64Builder";constructor(e){super(e,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(e){return new cn(e,this.config)}}class cn extends lB{static [lk]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(e){return BigInt(e)}}function ca(e,t){let{name:r,config:s}=uM(e,t);return"number"===s.mode?new ct(r):new cs(r)}class ci extends lz{static [lk]="PgBooleanBuilder";constructor(e){super(e,"boolean","PgBoolean")}build(e){return new co(e,this.config)}}class co extends lB{static [lk]="PgBoolean";getSQLType(){return"boolean"}}function cl(e){return new ci(e??"")}class cu extends lz{static [lk]="PgCharBuilder";constructor(e,t){super(e,"string","PgChar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new cc(e,this.config)}}class cc extends lB{static [lk]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"char":`char(${this.length})`}}function cd(e,t={}){let{name:r,config:s}=uM(e,t);return new cu(r,s)}class cp extends lz{static [lk]="PgCidrBuilder";constructor(e){super(e,"string","PgCidr")}build(e){return new ch(e,this.config)}}class ch extends lB{static [lk]="PgCidr";getSQLType(){return"cidr"}}function cm(e){return new cp(e??"")}class cf extends lz{static [lk]="PgCustomColumnBuilder";constructor(e,t,r){super(e,"custom","PgCustomColumn"),this.config.fieldConfig=t,this.config.customTypeParams=r}build(e){return new cg(e,this.config)}}class cg extends lB{static [lk]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(e,t){super(e,t),this.sqlName=t.customTypeParams.dataType(t.fieldConfig),this.mapTo=t.customTypeParams.toDriver,this.mapFrom=t.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(e){return"function"==typeof this.mapFrom?this.mapFrom(e):e}mapToDriverValue(e){return"function"==typeof this.mapTo?this.mapTo(e):e}}function cy(e){return(t,r)=>{let{name:s,config:n}=uM(t,r);return new cf(s,n,e)}}class cv extends lz{static [lk]="PgDoublePrecisionBuilder";constructor(e){super(e,"number","PgDoublePrecision")}build(e){return new cb(e,this.config)}}class cb extends lB{static [lk]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(e){return"string"==typeof e?Number.parseFloat(e):e}}function cw(e){return new cv(e??"")}class c_ extends lz{static [lk]="PgInetBuilder";constructor(e){super(e,"string","PgInet")}build(e){return new cS(e,this.config)}}class cS extends lB{static [lk]="PgInet";getSQLType(){return"inet"}}function cx(e){return new c_(e??"")}class cT extends u5{static [lk]="PgIntegerBuilder";constructor(e){super(e,"number","PgInteger")}build(e){return new ck(e,this.config)}}class ck extends lB{static [lk]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(e){return"string"==typeof e?Number.parseInt(e):e}}function cI(e){return new cT(e??"")}class cE extends lz{static [lk]="PgIntervalBuilder";constructor(e,t){super(e,"string","PgInterval"),this.config.intervalConfig=t}build(e){return new cA(e,this.config)}}class cA extends lB{static [lk]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let e=this.fields?` ${this.fields}`:"",t=this.precision?`(${this.precision})`:"";return`interval${e}${t}`}}function cN(e,t={}){let{name:r,config:s}=uM(e,t);return new cE(r,s)}class cP extends lz{static [lk]="PgLineBuilder";constructor(e){super(e,"array","PgLine")}build(e){return new cC(e,this.config)}}class cC extends lB{static [lk]="PgLine";getSQLType(){return"line"}mapFromDriverValue(e){let[t,r,s]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(r),Number.parseFloat(s)]}mapToDriverValue(e){return`{${e[0]},${e[1]},${e[2]}}`}}class cO extends lz{static [lk]="PgLineABCBuilder";constructor(e){super(e,"json","PgLineABC")}build(e){return new c$(e,this.config)}}class c$ extends lB{static [lk]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(e){let[t,r,s]=e.slice(1,-1).split(",");return{a:Number.parseFloat(t),b:Number.parseFloat(r),c:Number.parseFloat(s)}}mapToDriverValue(e){return`{${e.a},${e.b},${e.c}}`}}function cj(e,t){let{name:r,config:s}=uM(e,t);return s?.mode&&"tuple"!==s.mode?new cO(r):new cP(r)}class cR extends lz{static [lk]="PgMacaddrBuilder";constructor(e){super(e,"string","PgMacaddr")}build(e){return new cq(e,this.config)}}class cq extends lB{static [lk]="PgMacaddr";getSQLType(){return"macaddr"}}function cD(e){return new cR(e??"")}class cM extends lz{static [lk]="PgMacaddr8Builder";constructor(e){super(e,"string","PgMacaddr8")}build(e){return new cL(e,this.config)}}class cL extends lB{static [lk]="PgMacaddr8";getSQLType(){return"macaddr8"}}function cF(e){return new cM(e??"")}class cz extends lz{static [lk]="PgPointTupleBuilder";constructor(e){super(e,"array","PgPointTuple")}build(e){return new cB(e,this.config)}}class cB extends lB{static [lk]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(e){if("string"==typeof e){let[t,r]=e.slice(1,-1).split(",");return[Number.parseFloat(t),Number.parseFloat(r)]}return[e.x,e.y]}mapToDriverValue(e){return`(${e[0]},${e[1]})`}}class cZ extends lz{static [lk]="PgPointObjectBuilder";constructor(e){super(e,"json","PgPointObject")}build(e){return new cU(e,this.config)}}class cU extends lB{static [lk]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(e){if("string"==typeof e){let[t,r]=e.slice(1,-1).split(",");return{x:Number.parseFloat(t),y:Number.parseFloat(r)}}return e}mapToDriverValue(e){return`(${e.x},${e.y})`}}function cJ(e,t){let{name:r,config:s}=uM(e,t);return s?.mode&&"tuple"!==s.mode?new cZ(r):new cz(r)}function cV(e,t){let r=new DataView(new ArrayBuffer(8));for(let s=0;s<8;s++)r.setUint8(s,e[t+s]);return r.getFloat64(0,!0)}function cK(e){let t=function(e){let t=[];for(let r=0;r<e.length;r+=2)t.push(Number.parseInt(e.slice(r,r+2),16));return new Uint8Array(t)}(e),r=0,s=t[0];r+=1;let n=new DataView(t.buffer),a=n.getUint32(r,1===s);if(r+=4,0x20000000&a&&(n.getUint32(r,1===s),r+=4),(65535&a)==1){let e=cV(t,r),s=cV(t,r+=8);return r+=8,[e,s]}throw Error("Unsupported geometry type")}class cQ extends lz{static [lk]="PgGeometryBuilder";constructor(e){super(e,"array","PgGeometry")}build(e){return new cW(e,this.config)}}class cW extends lB{static [lk]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){return cK(e)}mapToDriverValue(e){return`point(${e[0]} ${e[1]})`}}class cH extends lz{static [lk]="PgGeometryObjectBuilder";constructor(e){super(e,"json","PgGeometryObject")}build(e){return new cG(e,this.config)}}class cG extends lB{static [lk]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(e){let t=cK(e);return{x:t[0],y:t[1]}}mapToDriverValue(e){return`point(${e.x} ${e.y})`}}function cY(e,t){let{name:r,config:s}=uM(e,t);return s?.mode&&"tuple"!==s.mode?new cH(r):new cQ(r)}class cX extends lz{static [lk]="PgRealBuilder";constructor(e,t){super(e,"number","PgReal"),this.config.length=t}build(e){return new c0(e,this.config)}}class c0 extends lB{static [lk]="PgReal";constructor(e,t){super(e,t)}getSQLType(){return"real"}mapFromDriverValue=e=>"string"==typeof e?Number.parseFloat(e):e}function c1(e){return new cX(e??"")}class c2 extends lz{static [lk]="PgSerialBuilder";constructor(e){super(e,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new c4(e,this.config)}}class c4 extends lB{static [lk]="PgSerial";getSQLType(){return"serial"}}function c9(e){return new c2(e??"")}class c5 extends u5{static [lk]="PgSmallIntBuilder";constructor(e){super(e,"number","PgSmallInt")}build(e){return new c3(e,this.config)}}class c3 extends lB{static [lk]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=e=>"string"==typeof e?Number(e):e}function c6(e){return new c5(e??"")}class c8 extends lz{static [lk]="PgSmallSerialBuilder";constructor(e){super(e,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(e){return new c7(e,this.config)}}class c7 extends lB{static [lk]="PgSmallSerial";getSQLType(){return"smallserial"}}function de(e){return new c8(e??"")}class dt extends lz{static [lk]="PgTextBuilder";constructor(e,t){super(e,"string","PgText"),this.config.enumValues=t.enum}build(e){return new dr(e,this.config)}}class dr extends lB{static [lk]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}}function ds(e,t={}){let{name:r,config:s}=uM(e,t);return new dt(r,s)}class dn extends lz{static [lk]="PgVarcharBuilder";constructor(e,t){super(e,"string","PgVarchar"),this.config.length=t.length,this.config.enumValues=t.enum}build(e){return new da(e,this.config)}}class da extends lB{static [lk]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"varchar":`varchar(${this.length})`}}function di(e,t={}){let{name:r,config:s}=uM(e,t);return new dn(r,s)}class dl extends lz{static [lk]="PgBinaryVectorBuilder";constructor(e,t){super(e,"string","PgBinaryVector"),this.config.dimensions=t.dimensions}build(e){return new du(e,this.config)}}class du extends lB{static [lk]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}}function dc(e,t){let{name:r,config:s}=uM(e,t);return new dl(r,s)}class dd extends lz{static [lk]="PgHalfVectorBuilder";constructor(e,t){super(e,"array","PgHalfVector"),this.config.dimensions=t.dimensions}build(e){return new dp(e,this.config)}}class dp extends lB{static [lk]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(e=>Number.parseFloat(e))}}function dh(e,t){let{name:r,config:s}=uM(e,t);return new dd(r,s)}class dm extends lz{static [lk]="PgSparseVectorBuilder";constructor(e,t){super(e,"string","PgSparseVector"),this.config.dimensions=t.dimensions}build(e){return new df(e,this.config)}}class df extends lB{static [lk]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}}function dg(e,t){let{name:r,config:s}=uM(e,t);return new dm(r,s)}class dy extends lz{static [lk]="PgVectorBuilder";constructor(e,t){super(e,"array","PgVector"),this.config.dimensions=t.dimensions}build(e){return new dv(e,this.config)}}class dv extends lB{static [lk]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(e){return JSON.stringify(e)}mapFromDriverValue(e){return e.slice(1,-1).split(",").map(e=>Number.parseFloat(e))}}function db(e,t){let{name:r,config:s}=uM(e,t);return new dy(r,s)}let dw=Symbol.for("drizzle:PgInlineForeignKeys"),d_=Symbol.for("drizzle:EnableRLS");class dS extends l7{static [lk]="PgTable";static Symbol=Object.assign({},l7.Symbol,{InlineForeignKeys:dw,EnableRLS:d_});[dw]=[];[d_]=!1;[l7.Symbol.ExtraConfigBuilder]=void 0}let dx=(e,t,r)=>(function(e,t,r,s,n=e){let a=new dS(e,s,n),i="function"==typeof t?t({bigint:ce,bigserial:ca,boolean:cl,char:cd,cidr:cm,customType:cy,date:u1,doublePrecision:cw,inet:cx,integer:cI,interval:cN,json:uO,jsonb:uN,line:cj,macaddr:cD,macaddr8:cF,numeric:uz,point:cJ,geometry:cY,real:c1,serial:c9,smallint:c6,smallserial:de,text:ds,time:uJ,timestamp:uH,uuid:u9,varchar:di,bit:dc,halfvec:dh,sparsevec:dg,vector:db}):t,o=Object.fromEntries(Object.entries(i).map(([e,t])=>{t.setName(e);let r=t.build(a);return a[dw].push(...t.buildForeignKeys(r,a)),[e,r]})),l=Object.fromEntries(Object.entries(i).map(([e,t])=>(t.setName(e),[e,t.buildExtraConfigColumn(a)]))),u=Object.assign(a,o);return u[l7.Symbol.Columns]=o,u[l7.Symbol.ExtraConfigColumns]=l,r&&(u[dS.Symbol.ExtraConfigBuilder]=r),Object.assign(u,{enableRLS:()=>(u[dS.Symbol.EnableRLS]=!0,u)})})(e,t,r,void 0);class dT{static [lk]="PgPrimaryKeyBuilder";columns;name;constructor(e,t){this.columns=e,this.name=t}build(e){return new dk(e,this.columns,this.name)}}class dk{constructor(e,t,r){this.table=e,this.columns=t,this.name=r}static [lk]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[dS.Symbol.Name]}_${this.columns.map(e=>e.name).join("_")}_pk`}}function dI(e,t){return"object"!=typeof t||null===t||!("mapToDriverValue"in t)||"function"!=typeof t.mapToDriverValue||ur(e)||lI(e,ul)||lI(e,uc)||lI(e,lP)||lI(e,l7)||lI(e,uh)?e:new ul(e,t)}let dE=(e,t)=>uu`${e} = ${dI(t,e)}`,dA=(e,t)=>uu`${e} <> ${dI(t,e)}`;function dN(...e){let t=e.filter(e=>void 0!==e);return 0===t.length?void 0:new un(1===t.length?t:[new us("("),uu.join(t,new us(" and ")),new us(")")])}function dP(...e){let t=e.filter(e=>void 0!==e);return 0===t.length?void 0:new un(1===t.length?t:[new us("("),uu.join(t,new us(" or ")),new us(")")])}function dC(e){return uu`not ${e}`}let dO=(e,t)=>uu`${e} > ${dI(t,e)}`,d$=(e,t)=>uu`${e} >= ${dI(t,e)}`,dj=(e,t)=>uu`${e} < ${dI(t,e)}`,dR=(e,t)=>uu`${e} <= ${dI(t,e)}`;function dq(e,t){return Array.isArray(t)?0===t.length?uu`false`:uu`${e} in ${t.map(t=>dI(t,e))}`:uu`${e} in ${dI(t,e)}`}function dD(e,t){return Array.isArray(t)?0===t.length?uu`true`:uu`${e} not in ${t.map(t=>dI(t,e))}`:uu`${e} not in ${dI(t,e)}`}function dM(e){return uu`${e} is null`}function dL(e){return uu`${e} is not null`}function dF(e){return uu`exists ${e}`}function dz(e){return uu`not exists ${e}`}function dB(e,t,r){return uu`${e} between ${dI(t,e)} and ${dI(r,e)}`}function dZ(e,t,r){return uu`${e} not between ${dI(t,e)} and ${dI(r,e)}`}function dU(e,t){return uu`${e} like ${t}`}function dJ(e,t){return uu`${e} not like ${t}`}function dV(e,t){return uu`${e} ilike ${t}`}function dK(e,t){return uu`${e} not ilike ${t}`}function dQ(e){return uu`${e} asc`}function dW(e){return uu`${e} desc`}class dH{constructor(e,t,r){this.sourceTable=e,this.referencedTable=t,this.relationName=r,this.referencedTableName=t[l7.Symbol.Name]}static [lk]="Relation";referencedTableName;fieldName}class dG{constructor(e,t){this.table=e,this.config=t}static [lk]="Relations"}class dY extends dH{constructor(e,t,r,s){super(e,t,r?.relationName),this.config=r,this.isNullable=s}static [lk]="One";withFieldName(e){let t=new dY(this.sourceTable,this.referencedTable,this.config,this.isNullable);return t.fieldName=e,t}}class dX extends dH{constructor(e,t,r){super(e,t,r?.relationName),this.config=r}static [lk]="Many";withFieldName(e){let t=new dX(this.sourceTable,this.referencedTable,this.config);return t.fieldName=e,t}}function d0(e){return{one:function(t,r){return new dY(e,t,r,r?.fields.reduce((e,t)=>e&&t.notNull,!0)??!1)},many:function(t,r){return new dX(e,t,r)}}}class d1 extends uh{static [lk]="PgViewBase"}class d2{static [lk]="PgDialect";casing;constructor(e){this.casing=new uT(e?.casing)}async migrate(e,t,r){let s="string"==typeof r?"__drizzle_migrations":r.migrationsTable??"__drizzle_migrations",n="string"==typeof r?"drizzle":r.migrationsSchema??"drizzle",a=uu`
			CREATE TABLE IF NOT EXISTS ${uu.identifier(n)}.${uu.identifier(s)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await t.execute(uu`CREATE SCHEMA IF NOT EXISTS ${uu.identifier(n)}`),await t.execute(a);let i=(await t.all(uu`select id, hash, created_at from ${uu.identifier(n)}.${uu.identifier(s)} order by created_at desc limit 1`))[0];await t.transaction(async t=>{for await(let r of e)if(!i||Number(i.created_at)<r.folderMillis){for(let e of r.sql)await t.execute(uu.raw(e));await t.execute(uu`insert into ${uu.identifier(n)}.${uu.identifier(s)} ("hash", "created_at") values(${r.hash}, ${r.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let t=[uu`with `];for(let[r,s]of e.entries())t.push(uu`${uu.identifier(s._.alias)} as (${s._.sql})`),r<e.length-1&&t.push(uu`, `);return t.push(uu` `),uu.join(t)}buildDeleteQuery({table:e,where:t,returning:r,withList:s}){let n=this.buildWithCTE(s),a=r?uu` returning ${this.buildSelection(r,{isSingleTable:!0})}`:void 0,i=t?uu` where ${t}`:void 0;return uu`${n}delete from ${e}${i}${a}`}buildUpdateSet(e,t){let r=e[l7.Symbol.Columns],s=Object.keys(r).filter(e=>void 0!==t[e]||r[e]?.onUpdateFn!==void 0),n=s.length;return uu.join(s.flatMap((e,s)=>{let a=r[e],i=t[e]??uu.param(a.onUpdateFn(),a),o=uu`${uu.identifier(this.casing.getColumnCasing(a))} = ${i}`;return s<n-1?[o,uu.raw(", ")]:[o]}))}buildUpdateQuery({table:e,set:t,where:r,returning:s,withList:n,from:a,joins:i}){let o=this.buildWithCTE(n),l=e[dS.Symbol.Name],u=e[dS.Symbol.Schema],c=e[dS.Symbol.OriginalName],d=l===c?void 0:l,p=uu`${u?uu`${uu.identifier(u)}.`:void 0}${uu.identifier(c)}${d&&uu` ${uu.identifier(d)}`}`,h=this.buildUpdateSet(e,t),m=a&&uu.join([uu.raw(" from "),this.buildFromTable(a)]),f=this.buildJoins(i),g=s?uu` returning ${this.buildSelection(s,{isSingleTable:!a})}`:void 0,y=r?uu` where ${r}`:void 0;return uu`${o}update ${p} set ${h}${m}${f}${y}${g}`}buildSelection(e,{isSingleTable:t=!1}={}){let r=e.length,s=e.flatMap(({field:e},s)=>{let n=[];if(lI(e,un.Aliased)&&e.isSelectionField)n.push(uu.identifier(e.fieldAlias));else if(lI(e,un.Aliased)||lI(e,un)){let r=lI(e,un.Aliased)?e.sql:e;t?n.push(new un(r.queryChunks.map(e=>lI(e,lB)?uu.identifier(this.casing.getColumnCasing(e)):e))):n.push(r),lI(e,un.Aliased)&&n.push(uu` as ${uu.identifier(e.fieldAlias)}`)}else lI(e,lP)&&(t?n.push(uu.identifier(this.casing.getColumnCasing(e))):n.push(e));return s<r-1&&n.push(uu`, `),n});return uu.join(s)}buildJoins(e){if(!e||0===e.length)return;let t=[];for(let[r,s]of e.entries()){0===r&&t.push(uu` `);let n=s.table,a=s.lateral?uu` lateral`:void 0;if(lI(n,dS)){let e=n[dS.Symbol.Name],r=n[dS.Symbol.Schema],i=n[dS.Symbol.OriginalName],o=e===i?void 0:s.alias;t.push(uu`${uu.raw(s.joinType)} join${a} ${r?uu`${uu.identifier(r)}.`:void 0}${uu.identifier(i)}${o&&uu` ${uu.identifier(o)}`} on ${s.on}`)}else if(lI(n,uh)){let e=n[l0].name,r=n[l0].schema,i=n[l0].originalName,o=e===i?void 0:s.alias;t.push(uu`${uu.raw(s.joinType)} join${a} ${r?uu`${uu.identifier(r)}.`:void 0}${uu.identifier(i)}${o&&uu` ${uu.identifier(o)}`} on ${s.on}`)}else t.push(uu`${uu.raw(s.joinType)} join${a} ${n} on ${s.on}`);r<e.length-1&&t.push(uu` `)}return uu.join(t)}buildFromTable(e){if(lI(e,l7)&&e[l7.Symbol.OriginalName]!==e[l7.Symbol.Name]){let t=uu`${uu.identifier(e[l7.Symbol.OriginalName])}`;return e[l7.Symbol.Schema]&&(t=uu`${uu.identifier(e[l7.Symbol.Schema])}.${t}`),uu`${t} ${uu.identifier(e[l7.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:t,fieldsFlat:r,where:s,having:n,table:a,joins:i,orderBy:o,groupBy:l,limit:u,offset:c,lockingClause:d,distinct:p,setOperators:h}){let m,f,g;let y=r??u$(t);for(let e of y){let t;if(lI(e.field,lP)&&e.field.table[lO]!==(lI(a,lG)?a._.alias:lI(a,d1)?a[l0].name:lI(a,un)?void 0:a[lO])&&(t=e.field.table,!i?.some(({alias:e})=>e===(t[l7.Symbol.IsAlias]?t[lO]:t[l7.Symbol.BaseName])))){let t=e.field.table[lO];throw Error(`Your "${e.path.join("->")}" field references a column "${t}"."${e.field.name}", but the table "${t}" is not part of the query! Did you forget to join it?`)}}let v=!i||0===i.length,b=this.buildWithCTE(e);p&&(m=!0===p?uu` distinct`:uu` distinct on (${uu.join(p.on,uu`, `)})`);let w=this.buildSelection(y,{isSingleTable:v}),_=this.buildFromTable(a),S=this.buildJoins(i),x=s?uu` where ${s}`:void 0,T=n?uu` having ${n}`:void 0;o&&o.length>0&&(f=uu` order by ${uu.join(o,uu`, `)}`),l&&l.length>0&&(g=uu` group by ${uu.join(l,uu`, `)}`);let k="object"==typeof u||"number"==typeof u&&u>=0?uu` limit ${u}`:void 0,I=c?uu` offset ${c}`:void 0,E=uu.empty();if(d){let e=uu` for ${uu.raw(d.strength)}`;d.config.of&&e.append(uu` of ${uu.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],uu`, `)}`),d.config.noWait?e.append(uu` no wait`):d.config.skipLocked&&e.append(uu` skip locked`),E.append(e)}let A=uu`${b}select${m} ${w} from ${_}${S}${x}${g}${T}${f}${k}${I}${E}`;return h.length>0?this.buildSetOperations(A,h):A}buildSetOperations(e,t){let[r,...s]=t;if(!r)throw Error("Cannot pass undefined values to any set operator");return 0===s.length?this.buildSetOperationQuery({leftSelect:e,setOperator:r}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:r}),s)}buildSetOperationQuery({leftSelect:e,setOperator:{type:t,isAll:r,rightSelect:s,limit:n,orderBy:a,offset:i}}){let o;let l=uu`(${e.getSQL()}) `,u=uu`(${s.getSQL()})`;if(a&&a.length>0){let e=[];for(let t of a)if(lI(t,lB))e.push(uu.identifier(t.name));else if(lI(t,un)){for(let e=0;e<t.queryChunks.length;e++){let r=t.queryChunks[e];lI(r,lB)&&(t.queryChunks[e]=uu.identifier(r.name))}e.push(uu`${t}`)}else e.push(uu`${t}`);o=uu` order by ${uu.join(e,uu`, `)} `}let c="object"==typeof n||"number"==typeof n&&n>=0?uu` limit ${n}`:void 0,d=uu.raw(`${t} ${r?"all ":""}`),p=i?uu` offset ${i}`:void 0;return uu`${l}${d}${u}${o}${c}${p}`}buildInsertQuery({table:e,values:t,onConflict:r,returning:s,withList:n,select:a,overridingSystemValue_:i}){let o=[],l=Object.entries(e[l7.Symbol.Columns]).filter(([e,t])=>!t.shouldDisableInsert()),u=l.map(([,e])=>uu.identifier(this.casing.getColumnCasing(e)));if(a)lI(t,un)?o.push(t):o.push(t.getSQL());else for(let[e,r]of(o.push(uu.raw("values ")),t.entries())){let s=[];for(let[e,t]of l){let n=r[e];if(void 0===n||lI(n,ul)&&void 0===n.value){if(void 0!==t.defaultFn){let e=t.defaultFn(),r=lI(e,un)?e:uu.param(e,t);s.push(r)}else if(t.default||void 0===t.onUpdateFn)s.push(uu`default`);else{let e=t.onUpdateFn(),r=lI(e,un)?e:uu.param(e,t);s.push(r)}}else s.push(n)}o.push(s),e<t.length-1&&o.push(uu`, `)}let c=this.buildWithCTE(n),d=uu.join(o),p=s?uu` returning ${this.buildSelection(s,{isSingleTable:!0})}`:void 0,h=r?uu` on conflict ${r}`:void 0,m=!0===i?uu`overriding system value `:void 0;return uu`${c}insert into ${e} ${u} ${m}${d}${h}${p}`}buildRefreshMaterializedViewQuery({view:e,concurrently:t,withNoData:r}){let s=t?uu` concurrently`:void 0,n=r?uu` with no data`:void 0;return uu`refresh materialized view${s} ${e}${n}`}prepareTyping(e){return lI(e,uA)||lI(e,uC)?"json":lI(e,uF)?"decimal":lI(e,uU)?"time":lI(e,uK)||lI(e,uW)?"timestamp":lI(e,uY)||lI(e,u0)?"date":lI(e,u4)?"uuid":"none"}sqlToQuery(e,t){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:t})}buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:r,table:s,tableConfig:n,queryConfig:a,tableAlias:i,nestedQueryRelation:o,joinOn:l}){let u,c=[],d,p,h=[],m,f=[];if(!0===a)c=Object.entries(n.columns).map(([e,t])=>({dbKey:t.name,tsKey:e,field:uv(t,i),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let s=Object.fromEntries(Object.entries(n.columns).map(([e,t])=>[e,uv(t,i)]));if(a.where){let e="function"==typeof a.where?a.where(s,{and:dN,between:dB,eq:dE,exists:dF,gt:dO,gte:d$,ilike:dV,inArray:dq,isNull:dM,isNotNull:dL,like:dU,lt:dj,lte:dR,ne:dA,not:dC,notBetween:dZ,notExists:dz,notLike:dJ,notIlike:dK,notInArray:dD,or:dP,sql:uu}):a.where;m=e&&uw(e,i)}let o=[],l=[];if(a.columns){let e=!1;for(let[t,r]of Object.entries(a.columns))void 0!==r&&t in n.columns&&(e||!0!==r||(e=!0),l.push(t));l.length>0&&(l=e?l.filter(e=>a.columns?.[e]===!0):Object.keys(n.columns).filter(e=>!l.includes(e)))}else l=Object.keys(n.columns);for(let e of l){let t=n.columns[e];o.push({tsKey:e,value:t})}let u=[];if(a.with&&(u=Object.entries(a.with).filter(e=>!!e[1]).map(([e,t])=>({tsKey:e,queryConfig:t,relation:n.relations[e]}))),a.extras)for(let[e,t]of Object.entries("function"==typeof a.extras?a.extras(s,{sql:uu}):a.extras))o.push({tsKey:e,value:ub(t,i)});for(let{tsKey:e,value:t}of o)c.push({dbKey:lI(t,un.Aliased)?t.fieldAlias:n.columns[e].name,tsKey:e,field:lI(t,lP)?uv(t,i):t,relationTableTsKey:void 0,isJson:!1,selection:[]});let g="function"==typeof a.orderBy?a.orderBy(s,{sql:uu,asc:dQ,desc:dW}):a.orderBy??[];for(let{tsKey:s,queryConfig:n,relation:o}of(Array.isArray(g)||(g=[g]),h=g.map(e=>lI(e,lP)?uv(e,i):uw(e,i)),d=a.limit,p=a.offset,u)){let a=function(e,t,r){if(lI(r,dY)&&r.config)return{fields:r.config.fields,references:r.config.references};let s=t[ue(r.referencedTable)];if(!s)throw Error(`Table "${r.referencedTable[l7.Symbol.Name]}" not found in schema`);let n=e[s];if(!n)throw Error(`Table "${s}" not found in schema`);let a=r.sourceTable,i=t[ue(a)];if(!i)throw Error(`Table "${a[l7.Symbol.Name]}" not found in schema`);let o=[];for(let e of Object.values(n.relations))(r.relationName&&r!==e&&e.relationName===r.relationName||!r.relationName&&e.referencedTable===r.sourceTable)&&o.push(e);if(o.length>1)throw r.relationName?Error(`There are multiple relations with name "${r.relationName}" in table "${s}"`):Error(`There are multiple relations between "${s}" and "${r.sourceTable[l7.Symbol.Name]}". Please specify relation name`);if(o[0]&&lI(o[0],dY)&&o[0].config)return{fields:o[0].config.references,references:o[0].config.fields};throw Error(`There is not enough information to infer relation "${i}.${r.fieldName}"`)}(t,r,o),l=r[ue(o.referencedTable)],u=`${i}_${s}`,d=dN(...a.fields.map((e,t)=>dE(uv(a.references[t],u),uv(e,i)))),p=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:t,tableNamesMap:r,table:e[l],tableConfig:t[l],queryConfig:lI(o,dY)?!0===n?{limit:1}:{...n,limit:1}:n,tableAlias:u,joinOn:d,nestedQueryRelation:o}),h=uu`${uu.identifier(u)}.${uu.identifier("data")}`.as(s);f.push({on:uu`true`,table:new lG(p.sql,{},u),alias:u,joinType:"left",lateral:!0}),c.push({dbKey:s,tsKey:s,field:h,relationTableTsKey:l,isJson:!0,selection:p.selection})}}if(0===c.length)throw new uk({message:`No fields selected for table "${n.tsName}" ("${i}")`});if(m=dN(l,m),o){let e=uu`json_build_array(${uu.join(c.map(({field:e,tsKey:t,isJson:r})=>r?uu`${uu.identifier(`${i}_${t}`)}.${uu.identifier("data")}`:lI(e,un.Aliased)?e.sql:e),uu`, `)})`;lI(o,dX)&&(e=uu`coalesce(json_agg(${e}${h.length>0?uu` order by ${uu.join(h,uu`, `)}`:void 0}), '[]'::json)`);let t=[{dbKey:"data",tsKey:"data",field:e.as("data"),isJson:!0,relationTableTsKey:n.tsName,selection:c}];void 0!==d||void 0!==p||h.length>0?(u=this.buildSelectQuery({table:uy(s,i),fields:{},fieldsFlat:[{path:[],field:uu.raw("*")}],where:m,limit:d,offset:p,orderBy:h,setOperators:[]}),m=void 0,d=void 0,p=void 0,h=[]):u=uy(s,i),u=this.buildSelectQuery({table:lI(u,dS)?u:new lG(u,{},i),fields:{},fieldsFlat:t.map(({field:e})=>({path:[],field:lI(e,lP)?uv(e,i):e})),joins:f,where:m,limit:d,offset:p,orderBy:h,setOperators:[]})}else u=this.buildSelectQuery({table:uy(s,i),fields:{},fieldsFlat:c.map(({field:e})=>({path:[],field:lI(e,lP)?uv(e,i):e})),joins:f,where:m,limit:d,offset:p,orderBy:h,setOperators:[]});return{tableTsKey:n.tsName,sql:u,selection:c}}}class d4{static [lk]="SelectionProxyHandler";config;constructor(e){this.config={...e}}get(e,t){if("_"===t)return{...e._,selectedFields:new Proxy(e._.selectedFields,this)};if(t===l0)return{...e[l0],selectedFields:new Proxy(e[l0].selectedFields,this)};if("symbol"==typeof t)return e[t];let r=(lI(e,lG)?e._.selectedFields:lI(e,uh)?e[l0].selectedFields:e)[t];if(lI(r,un.Aliased)){if("sql"===this.config.sqlAliasedBehavior&&!r.isSelectionField)return r.sql;let e=r.clone();return e.isSelectionField=!0,e}if(lI(r,un)){if("sql"===this.config.sqlBehavior)return r;throw Error(`You tried to reference "${t}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return lI(r,lP)?this.config.alias?new Proxy(r,new um(new Proxy(r.table,new uf(this.config.alias,this.config.replaceOriginalName??!1)))):r:"object"!=typeof r||null===r?r:new Proxy(r,new d4(this.config))}}class d9{static [lk]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class d5{static [lk]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}then(e,t){return this.execute().then(e,t)}}class d3{static [lk]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let t;let r=!!this.fields;return t=this.fields?this.fields:lI(e,lG)?Object.fromEntries(Object.keys(e._.selectedFields).map(t=>[t,e[t]])):lI(e,d1)?e[l0].selectedFields:lI(e,un)?{}:uq(e),new d8({table:e,fields:t,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}}class d6 extends d9{static [lk]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:t,isPartialSelect:r,session:s,dialect:n,withList:a,distinct:i}){super(),this.config={withList:a,table:e,fields:{...t},distinct:i,setOperators:[]},this.isPartialSelect=r,this.session=s,this.dialect=n,this._={selectedFields:t},this.tableName=uD(e),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{}}createJoin(e){return(t,r)=>{let s=this.tableName,n=uD(t);if("string"==typeof n&&this.config.joins?.some(e=>e.alias===n))throw Error(`Alias "${n}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof s&&(this.config.fields={[s]:this.config.fields}),"string"==typeof n&&!lI(t,un))){let e=lI(t,lG)?t._.selectedFields:lI(t,uh)?t[l0].selectedFields:t[l7.Symbol.Columns];this.config.fields[n]=e}if("function"==typeof r&&(r=r(new Proxy(this.config.fields,new d4({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:r,table:t,joinType:e,alias:n}),"string"==typeof n)switch(e){case"left":this.joinsNotNullableMap[n]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[n]=!0;break;case"inner":this.joinsNotNullableMap[n]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[n]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,t){return r=>{let s="function"==typeof r?r(pe()):r;if(!uj(this.getSelectedFields(),s.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:t,rightSelect:s}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new d4({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return"function"==typeof e&&(e=e(new Proxy(this.config.fields,new d4({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.fields,new d4({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(t)?t:[t]}else this.config.groupBy=e;return this}orderBy(...e){if("function"==typeof e[0]){let t=e[0](new Proxy(this.config.fields,new d4({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),r=Array.isArray(t)?t:[t];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}else this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=e:this.config.orderBy=e;return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,t={}){return this.config.lockingClause={strength:e,config:t},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}as(e){return new Proxy(new lG(this.getSQL(),this.config.fields,e),new d4({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new d4({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}}class d8 extends d6{static [lk]="PgSelect";_prepare(e){let{session:t,config:r,dialect:s,joinsNotNullableMap:n,authToken:a}=this;if(!t)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");return lX.startActiveSpan("drizzle.prepareQuery",()=>{let i=u$(r.fields),o=t.prepareQuery(s.sqlToQuery(this.getSQL()),i,e,!0);return o.joinsNotNullableMap=n,o.setToken(a)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>lX.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))}function d7(e,t){return(r,s,...n)=>{let a=[s,...n].map(r=>({type:e,isAll:t,rightSelect:r}));for(let e of a)if(!uj(r.getSelectedFields(),e.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(a)}}!function(e,t){for(let r of t)for(let t of Object.getOwnPropertyNames(r.prototype))"constructor"!==t&&Object.defineProperty(e.prototype,t,Object.getOwnPropertyDescriptor(r.prototype,t)||Object.create(null))}(d8,[d5]);let pe=()=>({union:pt,unionAll:pr,intersect:ps,intersectAll:pn,except:pa,exceptAll:pi}),pt=d7("union",!1),pr=d7("union",!0),ps=d7("intersect",!1),pn=d7("intersect",!0),pa=d7("except",!1),pi=d7("except",!0);class po{static [lk]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=lI(e,d2)?e:void 0,this.dialectConfig=lI(e,d2)?void 0:e}$with=(e,t)=>{let r=this;return{as:s=>("function"==typeof s&&(s=s(r)),new Proxy(new lY(s.getSQL(),t??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new d4({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let t=this;return{select:function(r){return new d3({fields:r??void 0,session:void 0,dialect:t.getDialect(),withList:e})},selectDistinct:function(e){return new d3({fields:e??void 0,session:void 0,dialect:t.getDialect(),distinct:!0})},selectDistinctOn:function(e,r){return new d3({fields:r??void 0,session:void 0,dialect:t.getDialect(),distinct:{on:e}})}}}select(e){return new d3({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new d3({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,t){return new d3({fields:t??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new d2(this.dialectConfig)),this.dialect}}class pl{constructor(e,t,r,s){this.table=e,this.session=t,this.dialect=r,this.withList=s}static [lk]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new pu(this.table,uR(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}}class pu extends d5{constructor(e,t,r,s,n){super(),this.session=r,this.dialect=s,this.config={set:t,table:e,withList:n,joins:[]},this.tableName=uD(e),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{}}static [lk]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let t=uD(e);return"string"==typeof t&&(this.joinsNotNullableMap[t]=!0),this.config.from=e,this}getTableLikeFields(e){return lI(e,dS)?e[l7.Symbol.Columns]:lI(e,lG)?e._.selectedFields:e[l0].selectedFields}createJoin(e){return(t,r)=>{let s=uD(t);if("string"==typeof s&&this.config.joins.some(e=>e.alias===s))throw Error(`Alias "${s}" is already used in this query`);if("function"==typeof r){let e=this.config.from&&!lI(this.config.from,un)?this.getTableLikeFields(this.config.from):void 0;r=r(new Proxy(this.config.table[l7.Symbol.Columns],new d4({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),e&&new Proxy(e,new d4({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:r,table:t,joinType:e,alias:s}),"string"==typeof s)switch(e){case"left":this.joinsNotNullableMap[s]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[s]=!0;break;case"inner":this.joinsNotNullableMap[s]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([e])=>[e,!1])),this.joinsNotNullableMap[s]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[l7.Symbol.Columns]),this.config.from)){let t=uD(this.config.from);if("string"==typeof t&&this.config.from&&!lI(this.config.from,un)){let r=this.getTableLikeFields(this.config.from);e[t]=r}for(let t of this.config.joins){let r=uD(t.table);if("string"==typeof r&&!lI(t.table,un)){let s=this.getTableLikeFields(t.table);e[r]=s}}}return this.config.returningFields=e,this.config.returning=u$(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){let t=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return t.joinsNotNullableMap=this.joinsNotNullableMap,t}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new d4({alias:this.config.table[lO],sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class pc{constructor(e,t,r,s,n){this.table=e,this.session=t,this.dialect=r,this.withList=s,this.overridingSystemValue_=n}static [lk]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(0===(e=Array.isArray(e)?e:[e]).length)throw Error("values() must be called with at least one value");let t=e.map(e=>{let t={},r=this.table[l7.Symbol.Columns];for(let s of Object.keys(e)){let n=e[s];t[s]=lI(n,un)?n:new ul(n,r[s])}return t});return new pd(this.table,t,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let t="function"==typeof e?e(new po):e;if(!lI(t,un)&&!uj(this.table[l2],t._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new pd(this.table,t,this.session,this.dialect,this.withList,!0)}}class pd extends d5{constructor(e,t,r,s,n,a,i){super(),this.session=r,this.dialect=s,this.config={table:e,values:t,withList:n,select:a,overridingSystemValue_:i}}static [lk]="PgInsert";config;returning(e=this.config.table[l7.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=u$(e),this}onConflictDoNothing(e={}){if(void 0===e.target)this.config.onConflict=uu`do nothing`;else{let t="";t=Array.isArray(e.target)?e.target.map(e=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(e))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let r=e.where?uu` where ${e.where}`:void 0;this.config.onConflict=uu`(${uu.raw(t)})${r} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let t=e.where?uu` where ${e.where}`:void 0,r=e.targetWhere?uu` where ${e.targetWhere}`:void 0,s=e.setWhere?uu` where ${e.setWhere}`:void 0,n=this.dialect.buildUpdateSet(this.config.table,uR(this.config.table,e.set)),a="";return a=Array.isArray(e.target)?e.target.map(e=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(e))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=uu`(${uu.raw(a)})${r} do update set ${n}${t}${s}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return lX.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>lX.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new d4({alias:this.config.table[lO],sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class pp extends d5{constructor(e,t,r,s){super(),this.session=t,this.dialect=r,this.config={table:e,withList:s}}static [lk]="PgDelete";config;where(e){return this.config.where=e,this}returning(e=this.config.table[l7.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=u$(e),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return lX.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>lX.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new d4({alias:this.config.table[lO],sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class ph extends un{constructor(e){super(ph.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=ph.buildCount(e.source,e.filters)}sql;token;static [lk]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,t){return uu`(select count(*) from ${e}${uu.raw(" where ").if(t)}${t})`}static buildCount(e,t){return uu`select count(*) as count from ${e}${uu.raw(" where ").if(t)}${t};`}setToken(e){return this.token=e,this}then(e,t){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,t)}catch(e){return this.then(void 0,e)}finally(e){return this.then(t=>(e?.(),t),t=>{throw e?.(),t})}}class pm{constructor(e,t,r,s,n,a,i){this.fullSchema=e,this.schema=t,this.tableNamesMap=r,this.table=s,this.tableConfig=n,this.dialect=a,this.session=i}static [lk]="PgRelationalQueryBuilder";findMany(e){return new pf(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new pf(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}}class pf extends d5{constructor(e,t,r,s,n,a,i,o,l){super(),this.fullSchema=e,this.schema=t,this.tableNamesMap=r,this.table=s,this.tableConfig=n,this.dialect=a,this.session=i,this.config=o,this.mode=l}static [lk]="PgRelationalQuery";_prepare(e){return lX.startActiveSpan("drizzle.prepareQuery",()=>{let{query:t,builtQuery:r}=this._toSQL();return this.session.prepareQuery(r,void 0,e,!0,(e,r)=>{let s=e.map(e=>(function e(t,r,s,n,a=e=>e){let i={};for(let[o,l]of n.entries())if(l.isJson){let n=r.relations[l.tsKey],u=s[o],c="string"==typeof u?JSON.parse(u):u;i[l.tsKey]=lI(n,dY)?c&&e(t,t[l.relationTableTsKey],c,l.selection,a):c.map(r=>e(t,t[l.relationTableTsKey],r,l.selection,a))}else{let e;let t=a(s[o]),r=l.field;e=lI(r,lP)?r:lI(r,un)?r.decoder:r.sql.decoder,i[l.tsKey]=null===t?null:e.mapFromDriverValue(t)}return i})(this.schema,this.tableConfig,e,t.selection,r));return"first"===this.mode?s[0]:s})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),t=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:t}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return lX.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}}class pg extends d5{constructor(e,t,r,s){super(),this.execute=e,this.sql=t,this.query=r,this.mapBatchResult=s}static [lk]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,t){return t?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}}class py extends d5{constructor(e,t,r){super(),this.session=t,this.dialect=r,this.config={view:e}}static [lk]="PgRefreshMaterializedView";config;concurrently(){if(void 0!==this.config.withNoData)throw Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(void 0!==this.config.concurrently)throw Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...t}=this.dialect.sqlToQuery(this.getSQL());return t}_prepare(e){return lX.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>lX.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))}class pv{constructor(e,t,r){if(this.dialect=e,this.session=t,this._=r?{schema:r.schema,fullSchema:r.fullSchema,tableNamesMap:r.tableNamesMap,session:t}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:t},this.query={},this._.schema)for(let[s,n]of Object.entries(this._.schema))this.query[s]=new pm(r.fullSchema,this._.schema,this._.tableNamesMap,r.fullSchema[s],n,e,t)}static [lk]="PgDatabase";query;$with=(e,t)=>{let r=this;return{as:s=>("function"==typeof s&&(s=s(new po(r.dialect))),new Proxy(new lY(s.getSQL(),t??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new d4({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,t){return new ph({source:e,filters:t,session:this.session})}with(...e){let t=this;return{select:function(r){return new d3({fields:r??void 0,session:t.session,dialect:t.dialect,withList:e})},selectDistinct:function(r){return new d3({fields:r??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:!0})},selectDistinctOn:function(r,s){return new d3({fields:s??void 0,session:t.session,dialect:t.dialect,withList:e,distinct:{on:r}})},update:function(r){return new pl(r,t.session,t.dialect,e)},insert:function(r){return new pc(r,t.session,t.dialect,e)},delete:function(r){return new pp(r,t.session,t.dialect,e)}}}select(e){return new d3({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new d3({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,t){return new d3({fields:t??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new pl(e,this.session,this.dialect)}insert(e){return new pc(e,this.session,this.dialect)}delete(e){return new pp(e,this.session,this.dialect)}refreshMaterializedView(e){return new py(e,this.session,this.dialect)}authToken;execute(e){let t="string"==typeof e?uu.raw(e):e.getSQL(),r=this.dialect.sqlToQuery(t),s=this.session.prepareQuery(r,void 0,void 0,!1);return new pg(()=>s.execute(void 0,this.authToken),t,r,e=>s.mapResult(e,!0))}transaction(e,t){return this.session.transaction(e,t)}}class pb{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,t){return e}setToken(e){return this.authToken=e,this}static [lk]="PgPreparedQuery";joinsNotNullableMap}class pw{constructor(e){this.dialect=e}static [lk]="PgSession";execute(e,t){return lX.startActiveSpan("drizzle.operation",()=>lX.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(t).execute(void 0,t))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,t){return Number((await this.execute(e,t))[0].count)}}class p_ extends pv{constructor(e,t,r,s=0){super(e,t,r),this.schema=r,this.nestedIndex=s}static [lk]="PgTransaction";rollback(){throw new uI}getTransactionConfigSQL(e){let t=[];return e.isolationLevel&&t.push(`isolation level ${e.isolationLevel}`),e.accessMode&&t.push(e.accessMode),"boolean"==typeof e.deferrable&&t.push(e.deferrable?"deferrable":"not deferrable"),uu.raw(t.join(" "))}setTransaction(e){return this.session.execute(uu`set transaction ${this.getTransactionConfigSQL(e)}`)}}let{Pool:pS,types:px}=lT;class pT extends pb{constructor(e,t,r,s,n,a,i,o){super({sql:t,params:r}),this.client=e,this.params=r,this.logger=s,this.fields=n,this._isResponseInArrayMode=i,this.customResultMapper=o,this.rawQueryConfig={name:a,text:t,types:{getTypeParser:(e,t)=>e===px.builtins.TIMESTAMPTZ||e===px.builtins.TIMESTAMP||e===px.builtins.DATE||e===px.builtins.INTERVAL?e=>e:px.getTypeParser(e,t)}},this.queryConfig={name:a,text:t,rowMode:"array",types:{getTypeParser:(e,t)=>e===px.builtins.TIMESTAMPTZ||e===px.builtins.TIMESTAMP||e===px.builtins.DATE||e===px.builtins.INTERVAL?e=>e:px.getTypeParser(e,t)}}}static [lk]="NodePgPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){return lX.startActiveSpan("drizzle.execute",async()=>{let t=ud(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,t);let{fields:r,rawQueryConfig:s,client:n,queryConfig:a,joinsNotNullableMap:i,customResultMapper:o}=this;if(!r&&!o)return lX.startActiveSpan("drizzle.driver.execute",async e=>(e?.setAttributes({"drizzle.query.name":s.name,"drizzle.query.text":s.text,"drizzle.query.params":JSON.stringify(t)}),n.query(s,t)));let l=await lX.startActiveSpan("drizzle.driver.execute",e=>(e?.setAttributes({"drizzle.query.name":a.name,"drizzle.query.text":a.text,"drizzle.query.params":JSON.stringify(t)}),n.query(a,t)));return lX.startActiveSpan("drizzle.mapResponse",()=>o?o(l.rows):l.rows.map(e=>(function(e,t,r){let s={},n=e.reduce((e,{path:n,field:a},i)=>{let o;o=lI(a,lP)?a:lI(a,un)?a.decoder:a.sql.decoder;let l=e;for(let[e,u]of n.entries())if(e<n.length-1)u in l||(l[u]={}),l=l[u];else{let e=t[i],c=l[u]=null===e?null:o.mapFromDriverValue(e);if(r&&lI(a,lP)&&2===n.length){let e=n[0];e in s?"string"==typeof s[e]&&s[e]!==a.table[lO]&&(s[e]=!1):s[e]=null===c&&a.table[lO]}}return e},{});if(r&&Object.keys(s).length>0)for(let[e,t]of Object.entries(s))"string"!=typeof t||r[t]||(n[e]=null);return n})(r,e,i)))})}all(e={}){return lX.startActiveSpan("drizzle.execute",()=>{let t=ud(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,t),lX.startActiveSpan("drizzle.driver.execute",e=>(e?.setAttributes({"drizzle.query.name":this.rawQueryConfig.name,"drizzle.query.text":this.rawQueryConfig.text,"drizzle.query.params":JSON.stringify(t)}),this.client.query(this.rawQueryConfig,t).then(e=>e.rows)))})}isResponseInArrayMode(){return this._isResponseInArrayMode}}class pk extends pw{constructor(e,t,r,s={}){super(t),this.client=e,this.schema=r,this.options=s,this.logger=s.logger??new lN}static [lk]="NodePgSession";logger;prepareQuery(e,t,r,s,n){return new pT(this.client,e.sql,e.params,this.logger,t,r,s,n)}async transaction(e,t){let r=this.client instanceof pS?new pk(await this.client.connect(),this.dialect,this.schema,this.options):this,s=new pI(this.dialect,r,this.schema);await s.execute(uu`begin${t?uu` ${s.getTransactionConfigSQL(t)}`:void 0}`);try{let t=await e(s);return await s.execute(uu`commit`),t}catch(e){throw await s.execute(uu`rollback`),e}finally{this.client instanceof pS&&r.client.release()}}async count(e){return Number((await this.execute(e)).rows[0].count)}}class pI extends p_{static [lk]="NodePgTransaction";async transaction(e){let t=`sp${this.nestedIndex+1}`,r=new pI(this.dialect,this.session,this.schema,this.nestedIndex+1);await r.execute(uu.raw(`savepoint ${t}`));try{let s=await e(r);return await r.execute(uu.raw(`release savepoint ${t}`)),s}catch(e){throw await r.execute(uu.raw(`rollback to savepoint ${t}`)),e}}}class pE{constructor(e,t,r={}){this.client=e,this.dialect=t,this.options=r}static [lk]="NodePgDriver";createSession(e){return new pk(this.client,this.dialect,e,{logger:this.options.logger})}}class pA extends pv{static [lk]="NodePgDatabase"}function pN(e,t={}){let r,s;let n=new d2({casing:t.casing});if(!0===t.logger?r=new lA:!1!==t.logger&&(r=t.logger),t.schema){let e=function(e,t){1===Object.keys(e).length&&"default"in e&&!lI(e.default,l7)&&(e=e.default);let r={},s={},n={};for(let[a,i]of Object.entries(e))if(lI(i,l7)){let e=ue(i),t=s[e];for(let s of(r[e]=a,n[a]={tsName:a,dbName:i[l7.Symbol.Name],schema:i[l7.Symbol.Schema],columns:i[l7.Symbol.Columns],relations:t?.relations??{},primaryKey:t?.primaryKey??[]},Object.values(i[l7.Symbol.Columns])))s.primary&&n[a].primaryKey.push(s);let o=i[l7.Symbol.ExtraConfigBuilder]?.(i[l7.Symbol.ExtraConfigColumns]);if(o)for(let e of Object.values(o))lI(e,dT)&&n[a].primaryKey.push(...e.columns)}else if(lI(i,dG)){let e;let a=ue(i.table),o=r[a];for(let[r,l]of Object.entries(i.config(t(i.table))))if(o){let t=n[o];t.relations[r]=l,e&&t.primaryKey.push(...e)}else a in s||(s[a]={relations:{},primaryKey:e}),s[a].relations[r]=l}return{tables:n,tableNamesMap:r}}(t.schema,d0);s={fullSchema:t.schema,schema:e.tables,tableNamesMap:e.tableNamesMap}}let a=new pE(e,n,{logger:r}).createSession(s),i=new pA(n,a,s);return i.$client=e,i}function pP(...e){if("string"==typeof e[0])return pN(new lT.Pool({connectionString:e[0]}),e[1]);if(function(e){if("object"!=typeof e||null===e||"Object"!==e.constructor.name)return!1;if("logger"in e){let t=typeof e.logger;return"boolean"===t||"object"===t&&"function"==typeof e.logger.logQuery||"undefined"===t}if("schema"in e){let t=typeof e.logger;return"object"===t||"undefined"===t}if("casing"in e){let t=typeof e.logger;return"string"===t||"undefined"===t}if("mode"in e)return"default"===e.mode&&"planetscale"===e.mode&&void 0===e.mode;if("connection"in e){let t=typeof e.connection;return"string"===t||"object"===t||"undefined"===t}if("client"in e){let t=typeof e.client;return"object"===t||"function"===t||"undefined"===t}return 0===Object.keys(e).length}(e[0])){let{connection:t,client:r,...s}=e[0];return r?pN(r,s):pN(new lT.Pool("string"==typeof t?{connectionString:t}:t),s)}return pN(e[0],e[1])}(pP||(pP={})).mock=function(e){return pN({},e)};let pC=pP(globalThis.pool??new lT.Pool({host:li.pg.host,port:li.pg.port,user:li.pg.username,password:li.pg.password,database:li.pg.database}),{casing:"snake_case"}),pO={user:"usr",blog:"blg",org:"org",org_member:"mem"},p$=e=>[pO[e],lx()].join("_"),pj=e=>({id:di({length:34}).$defaultFn(()=>p$(e)).primaryKey(),createdAt:uH({mode:"date",withTimezone:!0}).defaultNow(),updatedAt:uH({mode:"date",withTimezone:!0}).defaultNow().$onUpdateFn(()=>new Date)}),pR=dx("users",{...pj("user"),email:di({length:255}).notNull().unique(),name:di({length:255}),verified:cl().notNull().default(!1)}),pq=lH("member_role",["OWNER","ADMIN","EDITOR","VIEWER"],void 0),pD=dx("organization",{...pj("org"),name:di().notNull(),slug:di().notNull().unique(),description:di(),logo:di({length:255}).notNull()}),pM=dx("organization_member",{...pj("org_member"),userId:di({length:34}).notNull().references(()=>pR.id),organizationId:di({length:34}).notNull().references(()=>pD.id),role:pq().notNull(),profilePicture:di({length:255}),bio:di({length:255}),displayName:di({length:255})}),pL=lH("blog_status",["DRAFT","PUBLISHED"],void 0),pF=dx("blog",{...pj("blog"),publishedDate:uH({mode:"string",withTimezone:!0}),organizationId:di({length:34}).references(()=>pD.id),authorId:di({length:34}).notNull().references(()=>pM.id),title:ds().notNull(),slug:di({length:255}).notNull(),image:di({length:255}),body:uO().array(),content:ds().default(""),tags:ds().array().default([]),likes:cI().default(0),status:pL().default("DRAFT")}),pz=dx("blog_metadata",{blogId:di({length:34}).unique().notNull().references(()=>pF.id),description:ds().notNull(),keywords:ds(),ogTitle:ds(),ogDescription:ds(),ogImage:ds(),ogUrl:ds()});function pB(e){return uu`count(${e||uu.raw("*")})`.mapWith(Number)}l=({one:e})=>({blog_metadata:e(pz)}),new dG(pF,e=>Object.fromEntries(Object.entries(l(e)).map(([e,t])=>[e,t.withFieldName(e)]))),function(e){async function t(e){return(await pC.insert(pF).values(e).returning())[0]}async function r({id:e,...t}){let[r]=await pC.update(pF).set({...t,updatedAt:new Date}).where(dE(pF.id,e)).returning();return r}async function s(t){let[r]=await pC.select({...e.columns,metadata:uu`
										json_object(
												'ogUrl', ${pz.ogUrl},
												'ogImage', ${pz.ogImage},
												'ogTitle', ${pz.ogTitle},
												'ogDescription', ${pz.ogDescription},
												'keywords', ${pz.keywords},
												'description', ${pz.description},
												'blogId', ${pz.blogId}
										)
								`.as("metadata")}).from(pF).where(dE(pF.id,t)).limit(1).then(e=>e.map(e=>({...e,metadata:JSON.parse(e.metadata)})));return r}async function n(t){let r=pC.select({...e.columns}).from(pF).$dynamic();t.slug&&(r=r.innerJoin(pz,dE(pF.id,pz.blogId)).where(dE(pF.slug,t.slug)));let[s]=await r.limit(1);return s}async function a(e){await pC.delete(pF).where(dE(pF.id,e))}e.columns=uq(pF),e.create=t,e.update=r,e.findById=s,e.findOne=n,e.findAll=async({filter:t,sort:r})=>{let s=pC.select({...e.columns,author:uu`
										json_object(
												'id', ${pM.id},
												'organizationId', ${pM.organizationId},
												'userId', ${pM.userId},
												'role', ${pM.role},
												'createdAt', ${pM.createdAt},
												'updatedAt', ${pM.updatedAt}
										)
								`.as("author")}).from(pF).innerJoin(pM,dE(pF.authorId,pM.id)).$dynamic();return t?.status&&(s=s.where(dE(pF.status,t.status))),t?.userId&&(s=s.where(dE(pM.userId,t.userId))),t?.organizationId&&(s=s.where(dE(pF.organizationId,t.organizationId))),t?.search?.length&&(s=s.where(dP(dV(pF.title,t.search),dV(pF.slug,t.search)))),r?.title&&(s=s.orderBy(("asc"===r.title?dQ:dW)(pF.title))),r?.status&&(s=s.orderBy(("asc"===r.status?dQ:dW)(pF.status))),r?.slug&&(s=s.orderBy(("asc"===r.slug?dQ:dW)(pF.slug))),r?.createdAt&&(s=s.orderBy(("asc"===r.createdAt?dQ:dW)(pF.createdAt))),r?.updatedAt&&(s=s.orderBy(("asc"===r.updatedAt?dQ:dW)(pF.updatedAt))),r?.authorName&&(s=s.orderBy(("asc"===r.authorName?dQ:dW)(pM.displayName))),(await s).map(e=>({...e,author:JSON.parse(e.author)}))},e.count=async e=>{let t=pC.select({count:pB()}).from(pF).$dynamic();e?.status&&(t=t.where(dE(pF.status,e.status))),e?.userId&&(t=t.innerJoin(pM,dE(pM.id,pF.authorId)).where(dE(pM.userId,e.userId))),e?.organizationId&&(t=t.where(dE(pF.organizationId,e.organizationId))),e?.search?.length&&(t=t.where(dP(dV(pF.title,e.search),dV(pF.slug,e.search))));let r=(await t)[0];return r?.count??0},e.remove=a}(J||(J={}));let pZ=sz.object({organizationId:sz.string(),title:sz.string().min(2,{message:"Title must be at least 2 characters long"}),slug:sz.string().min(2,{message:"Slug must be at least 2 characters long"}).regex(/^[a-z0-9]+(?:-[a-z0-9]+)*$/,{message:"Slug can only contain lowercase letters, numbers, and hyphens. Hyphens cannot be at the start or end."}),image:sz.instanceof(File).optional()});var pU=function(e){return e.DRAFT="DRAFT",e.PUBLISHED="PUBLISHED",e}({});let pJ=sz.object({status:sz.nativeEnum(pU).optional(),userId:sz.string().optional(),search:sz.string().optional(),organizationId:sz.string().optional()}),pV=sz.object({title:sz.enum(["asc","desc"]).optional(),status:sz.enum(["asc","desc"]).optional(),slug:sz.enum(["asc","desc"]).optional(),createdAt:sz.enum(["asc","desc"]).optional(),updatedAt:sz.enum(["asc","desc"]).optional(),authorName:sz.enum(["asc","desc"]).optional()}),pK=sz.object({filter:pJ.optional(),sort:pV.optional()}),pQ=sz.object({title:sz.string().min(2,{message:"Title must be at least 2 characters long"}).optional(),slug:sz.string().min(2,{message:"Slug must be at least 2 characters long"}).regex(/^[a-z0-9]+(?:-[a-z0-9]+)*$/,{message:"Slug can only contain lowercase letters, numbers, and hyphens. Hyphens cannot be at the start or end."}).optional(),image:sz.instanceof(File).optional(),body:sz.array(sz.any().optional()).optional(),content:sz.string().optional()}),pW=require("@aws-sdk/client-s3"),pH=new pW.S3Client({region:"us-east-1"}),pG=async(e,t)=>await pH.send(new pW.PutObjectCommand({Bucket:li.bucket.name,Key:e,Body:t,ContentType:t.type,ACL:"public-read"})),pY=async e=>await pH.send(new pW.DeleteObjectCommand({Bucket:li.bucket.name,Key:e})),pX=async(e,t)=>{let r;let s=e.var.user,n=e.req.param("id");try{r=(await pC.select(J.columns).from(pF).innerJoin(pD,dE(pD.id,pF.organizationId)).innerJoin(pM,dE(pM.organizationId,pD.id)).where(dN(dE(pF.id,n),dE(pM.userId,s.id))))[0]}catch(e){throw console.error(e),new na(500,{message:"Something went wrong!"})}if(!r)throw new na(403,{message:"You are not a member of this organization"});e.set("blog",r),await t()},p0=async(e,t)=>{let r;let s=e.var.user,n=await e.req.parseBody(),a=n.organizationId??n.id;if("string"!=typeof a)throw new na(400,{message:"organizationId is required in request body"});try{let e=(await pC.select({...uq(pD),member:uu`
						json_object(
							'id', ${pM.id},
							'organizationId', ${pM.organizationId},
							'userId', ${pM.userId},
							'role', ${pM.role},
							'createdAt', ${pM.createdAt},
							'updatedAt', ${pM.updatedAt}
						)
					`.as("member")}).from(pD).innerJoin(pM,dE(pD.id,pM.organizationId)).where(dN(dE(pD.id,a),dE(pM.userId,s.id))))[0];e&&(r={...e,member:JSON.parse(e.member)})}catch(e){throw console.error(e),new na(500,{message:"Something went wrong!"})}if(!r)throw new na(403,{message:"You are not a member of this organization"});e.set("organization",r),await t()},p1=new eL;p1.post("/",nd("form",pZ),lv,p0,async e=>{let t=e.var.organization.member,r=e.req.valid("form"),s={organizationId:r.organizationId,authorId:t.id,title:r.title,slug:r.title};if(r.image){let t="blogs/"+encodeURI(lx()+"-"+r.slug);s.image=e.env.NEXT_PUBLIC_S3_DOMAIN+"/"+t,await pG(t,r.image)}let n=await J.create(s);if(!n)throw new na(400,{message:"Failed to create blog"});return await pC.insert(pz).values({blogId:n.id,description:""}),e.json(n,201)}),p1.get("/",nc("query",(e,t)=>{let r=pK.extend({filter:pJ.extend({organizationId:sz.string()})}).safeParse({filter:"string"==typeof e.filter?JSON.parse(e.filter):{},sort:"string"==typeof e.sort?JSON.parse(e.sort):{}});return r.success?r.data:t.json(r.error,400)}),async e=>{let t=e.req.valid("query"),r=await J.findAll({...t,filter:{...t.filter}});return e.json(r)}),p1.get("/count",lv,nd("query",pJ),async e=>{let t=e.req.valid("query"),r=e.var.user.id,s=await J.count({...t,userId:r});return e.json({count:s})}),p1.put("/placeholder-images",lv,nd("form",sz.object({file:sz.instanceof(File)})),async e=>{let t=e.req.valid("form"),r="blogs/placeholder-images"+encodeURI(lx());return await pG(r,t.file),e.json({url:e.env.NEXT_PUBLIC_S3_DOMAIN+"/"+r})}),p1.get("/:id",nd("param",sz.object({id:sz.string()})),async e=>{let t=e.req.valid("param").id,r=await J.findById(t);return e.json(r)}),p1.patch("/:id",nc("form",(e,t)=>{let r=pQ.safeParse({...e,body:Array.isArray(e.body)?e.body.map(e=>JSON.parse(e)):void 0,tags:"string"==typeof e.tags?JSON.parse(e.tags):void 0});return r.success?r.data:t.json(r.error,400)}),lv,pX,async e=>{let t=e.req.param("id"),{image:r,...s}=e.req.valid("form"),n={...s,id:t};if(r){let t="blogs/"+encodeURI(lx()+"-"+s.slug);n.image=e.env.NEXT_PUBLIC_S3_DOMAIN+"/"+t,await pG(t,r)}let a=await J.update(n);if(!a)throw new na(400,{message:"Failed to create blog"});return e.json(a)}),function(e){async function t(e){return(await pC.insert(pD).values(e).returning())[0]}async function r({id:e,...t}){let[r]=await pC.update(pD).set({...t,updatedAt:new Date}).where(dE(pD.id,e)).returning();return r}async function s(e){let[t]=await pC.select().from(pD).where(dE(pD.id,e)).limit(1);return t}async function n(e){let[t]=await pC.select().from(pD).where(dE(pD.slug,e)).limit(1);return t}async function a(e){let t=pC.select({...uq(pD)}).from(pD).$dynamic();return e.userId&&(t=t.innerJoin(pM,dE(pM.organizationId,pD.id)).where(dE(pM.userId,e.userId))),t}async function i(e){await pC.delete(pD).where(dE(pD.id,e))}e.tableName=pD[lO],e.create=t,e.update=r,e.findById=s,e.findBySlug=n,e.findAll=a,e.count=async e=>{let t=pC.select({count:pB()}).from(pD).$dynamic();e.userId&&(t=t.innerJoin(pM,dE(pM.organizationId,pD.id)).where(dE(pM.userId,e.userId)));let r=(await t)[0];return r?.count??0},e.remove=i}(V||(V={})),function(e){async function t(e){return(await pC.insert(pM).values(e).returning())[0]}async function r({id:e,...t}){let[r]=await pC.update(pM).set({...t,updatedAt:new Date}).where(dE(pM.id,e)).returning();return r}async function s(e){let[t]=await pC.select().from(pM).where(dE(pM.id,e)).limit(1);return t}async function n(e){let t=pC.select({...uq(pM)}).from(pM).$dynamic();e.organizationId&&t.where(dE(pM.organizationId,e.organizationId)),e.userId&&t.where(dE(pM.userId,e.userId));let[r]=await t.limit(1);return r}async function a(e){if(Object.values(e).every(e=>!e))throw Error("At least one filter must be provided");let t=pC.delete(pM).$dynamic();e.id&&(t=t.where(dE(pM.id,e.id))),e.organizationId&&(t=t.where(dE(pM.organizationId,e.organizationId))),await t}e.tableName=pM[lO],e.create=t,e.update=r,e.findAll=async e=>{let t=pC.select({...uq(pM)}).from(pM).$dynamic();return e.organizationId&&t.where(dE(pM.organizationId,e.organizationId)),e.userId&&t.where(dE(pM.userId,e.userId)),await t},e.findById=s,e.findOne=n,e.remove=a}(K||(K={}));let p2=sz.object({name:sz.string().min(2,{message:"Organization name must be at least 2 characters."}),slug:sz.string().min(2).regex(/^[a-z0-9]+(?:-[a-z0-9]+)*$/,{message:"Slug must contain only lowercase letters, numbers, and hyphens."}),logo:sz.instanceof(File)}),p4=sz.object({name:sz.string().min(2,{message:"Organization name must be at least 2 characters."}),slug:sz.string().min(2).regex(/^[a-z0-9]+(?:-[a-z0-9]+)*$/,{message:"Slug must contain only lowercase letters, numbers, and hyphens."}),logo:sz.instanceof(File)}).partial().extend({id:sz.string()}),p9=new eL().use(lv);p9.get("/",async e=>e.json(await V.findAll({userId:e.var.user.id}))),p9.get("/count",async({var:{user:e},json:t})=>{try{return t({count:await V.count({userId:e.id})})}catch(e){throw new na(500,{message:"Failed to count organizations",cause:e})}}),p9.post("/",nd("form",p2),async e=>{try{let t=e.req.valid("form"),r=e.var.user,s=encodeURI(`organization/${lx()}-${t.slug}`),n=e.env.NEXT_PUBLIC_S3_DOMAIN+"/"+s;await pG(s,t.logo);let a=await V.create({name:t.name,slug:t.slug,logo:n});if(!a)throw new na(500,{message:"Failed to create organization"});return await K.create({userId:r.id,organizationId:a.id,role:"ADMIN",displayName:r.name}),e.json(a)}catch(e){throw new na(500,{message:"Failed to create organization",cause:e})}}),p9.patch("/",p0,nd("form",p4),async e=>{try{let{logo:t,...r}=e.req.valid("form"),s={...r},n=e.var.organization;if(t&&t.size>0){let r=`organization/${lx()}-${n.slug}`;if(n.logo){let e=n.logo.split(".com/").pop();e&&await pY(e)}s.logo=e.env.NEXT_PUBLIC_S3_DOMAIN+"/"+r,await pG(r,t)}let a=await V.update(s);if(!a)throw new na(500,{message:"Failed to update organization"});return e.json(a)}catch(e){throw new na(500,{message:"Failed to create organization",cause:e})}});let p5=new eL().use(lv);p5.get("/",async e=>e.json(e.var.user));let p3=(o=new eL().basePath("/api").use((e=>{let t={origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[],...e},r=(e=>"string"==typeof e?"*"===e?()=>e:t=>e===t?t:null:"function"==typeof e?e:t=>e.includes(t)?t:null)(t.origin);return async function(e,s){function n(t,r){e.res.headers.set(t,r)}let a=r(e.req.header("origin")||"",e);if(a&&n("Access-Control-Allow-Origin",a),"*"!==t.origin&&n("Vary",e.req.header("Vary")||"Origin"),t.credentials&&n("Access-Control-Allow-Credentials","true"),t.exposeHeaders?.length&&n("Access-Control-Expose-Headers",t.exposeHeaders.join(",")),"OPTIONS"===e.req.method){null!=t.maxAge&&n("Access-Control-Max-Age",t.maxAge.toString()),t.allowMethods?.length&&n("Access-Control-Allow-Methods",t.allowMethods.join(","));let r=t.allowHeaders;if(!r?.length){let t=e.req.header("Access-Control-Request-Headers");t&&(r=t.split(/\s*,\s*/))}return r?.length&&(n("Access-Control-Allow-Headers",r.join(",")),e.res.headers.append("Vary","Access-Control-Request-Headers")),e.res.headers.delete("Content-Length"),e.res.headers.delete("Content-Type"),new Response(null,{headers:e.res.headers,status:204,statusText:"No Content"})}await s()}})({origin:["https://dash.plobbo.com","http://localhost:3001"],allowMethods:["POST","GET","OPTIONS","PUT","PATCH","DELETE"],credentials:!0})).route("/profile",p5).route("/organizations",p9).route("/blogs",p1).route("/ai",lb),e=>o.fetch(e)),p6=p3,p8=p3,p7=p3,he=p3,ht=p3,hr=new W.AppRouteRouteModule({definition:{kind:H.RouteKind.APP_ROUTE,page:"/api/[[...route]]/route",pathname:"/api/[[...route]]",filename:"route",bundlePath:"app/api/[[...route]]/route"},resolvedPagePath:"/home/sudarsh/dev/keizer/plobbo/apps/www/src/app/api/[[...route]]/route.ts",nextConfigOutput:"standalone",userland:Q}),{workAsyncStorage:hs,workUnitAsyncStorage:hn,serverHooks:ha}=hr;function hi(){return(0,G.patchFetch)({workAsyncStorage:hs,workUnitAsyncStorage:hn})}},7032:()=>{},408:()=>{},1271:(e,t,r)=>{"use strict";e.exports=r(4870)},6036:e=>{"use strict";let t="undefined"!=typeof Buffer,r=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,s=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function n(e,n,i){null==i&&null!==n&&"object"==typeof n&&(i=n,n=void 0),t&&Buffer.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));let o=JSON.parse(e,n);if(null===o||"object"!=typeof o)return o;let l=i&&i.protoAction||"error",u=i&&i.constructorAction||"error";if("ignore"===l&&"ignore"===u)return o;if("ignore"!==l&&"ignore"!==u){if(!1===r.test(e)&&!1===s.test(e))return o}else if("ignore"!==l&&"ignore"===u){if(!1===r.test(e))return o}else if(!1===s.test(e))return o;return a(o,{protoAction:l,constructorAction:u,safe:i&&i.safe})}function a(e,{protoAction:t="error",constructorAction:r="error",safe:s}={}){let n=[e];for(;n.length;){let e=n;for(let a of(n=[],e)){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(a,"__proto__")){if(!0===s)return null;if("error"===t)throw SyntaxError("Object contains forbidden prototype property");delete a.__proto__}if("ignore"!==r&&Object.prototype.hasOwnProperty.call(a,"constructor")&&Object.prototype.hasOwnProperty.call(a.constructor,"prototype")){if(!0===s)return null;if("error"===r)throw SyntaxError("Object contains forbidden prototype property");delete a.constructor}for(let e in a){let t=a[e];t&&"object"==typeof t&&n.push(t)}}}return e}function i(e,t,r){let s=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return n(e,t,r)}finally{Error.stackTraceLimit=s}}e.exports=i,e.exports.default=i,e.exports.parse=i,e.exports.safeParse=function(e,t){let r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return n(e,t,{safe:!0})}catch(e){return null}finally{Error.stackTraceLimit=r}},e.exports.scan=a}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[79],()=>r(8232));module.exports=s})();